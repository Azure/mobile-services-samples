//! Copyright (c) Microsoft Corporation. All rights reserved. AzureMobileServices v1.2.6
!function(global){function require(name){name&&name.length>2&&"."==name[0]&&"/"==name[1]&&(name=name.slice(2));var existing=$__modules__[name];if("function"==typeof existing){var exports={};return $__modules__[name]=exports,existing(exports),exports}if("object"==typeof existing)return existing;throw"Unknown module "+name}var $__fileVersion__="1.2.21201.0",$__modules__={};$__modules__.Resources={},$__modules__.Resources["de-DE"]={Validate_NotNullError:"{0} darf nicht null sein.",Validate_NotNullOrEmptyError:"{0} darf nicht null oder leer sein.",Validate_InvalidId:'"{0}" ist ungültig.',Validate_TypeCheckError:"Es wird erwartet, dass {0} ein Wert vom Typ {1} und nicht {2} ist.",Validate_LengthUnexpected:"Es wird erwartet, dass {0} die Länge {1} und nicht {2} aufweist.",Validate_InvalidUserParameter:"{0} enthält einen ungültigen benutzerdefinierten Abfragezeichenfolge-Parameter: {1}. Benutzerdefinierte Abfragezeichenfolge-Parameter dürfen nicht mit '$' beginnen.",Extensions_DefaultErrorMessage:"Unerwarteter Fehler.",Extensions_ConnectionFailureMessage:"Unerwarteter Verbindungsfehler.",MobileServiceTable_ReadMismatchedQueryTables:"Die Ergebnisse einer Abfrage für die Tabelle '{1}' können nicht über die Tabelle '{0}' abgerufen werden.",MobileServiceTable_InsertIdAlreadySet:"Der Einfügevorgang kann nicht erfolgen, wenn das Element '{0}'bereits festgelegt ist.",MobileServiceLogin_AuthenticationProviderNotSupported:"Nicht unterstützter Authentifizierungsanbietername. Bitte geben Sie einen Namen {0} an.",MobileServiceLogin_LoginErrorResponse:"Es kann kein Anmeldevorgang gestartet werden, weil aktuell bereits eine Anmeldung ausgeführt wird.",MobileServiceLogin_InvalidResponseFormat:"Ungültiges Format der Authentifizierungsantwort.",MobileServiceLogin_InvalidProvider:"Der erste Parameter muss der Name des Authentifizierungsanbieters oder ein Authentifizierungstoken eines Microsoft-Kontos sein.",MobileServiceTable_NotSingleObject:"Das Objekt konnte nicht aus der Antwort {0} abgerufen werden.",Push_ConflictWithReservedName:"Der Vorlagenname verursacht einen Konflikt mit dem reservierten Namen '{0}'.",Push_InvalidTemplateName:'Der Vorlagenname darf nicht das Zeichen ";" oder ":" enthalten.',Push_NotSupportedXMLFormatAsBodyTemplateWin8:'"bodyTemplate" weist kein zulässiges XML-Format auf. Der erste Knoten von "bodyTemplate" sollte ein Badge, eine Kachel oder ein Popup sein. Dies gilt nicht für eine wns/raw-Vorlage, die aus gültigem XML bestehen muss.',Push_BodyTemplateMustBeXml:"Gültiges XML ist für jede Vorlage ohne einen formatierten Header erforderlich.",Push_TagNoCommas:'Tags dürfen nicht das Zeichen "," enthalten.'},$__modules__.Resources["en-US"]={Validate_NotNullError:"{0} cannot be null.",Validate_NotNullOrEmptyError:"{0} cannot be null or empty.",Validate_InvalidId:"{0} is not valid.",Validate_TypeCheckError:"{0} is expected to be a value of type {1}, not {2}.",Validate_LengthUnexpected:"{0} is expected to have length {1}, not {2}.",Validate_InvalidUserParameter:"{0} contains an invalid user-defined query string parameter: {1}. User-defined query string parameters must not begin with a '$'.",Extensions_DefaultErrorMessage:"Unexpected failure.",Extensions_ConnectionFailureMessage:"Unexpected connection failure.",MobileServiceTable_ReadMismatchedQueryTables:"Cannot get the results of a query for table '{1}' via table '{0}'.",MobileServiceTable_InsertIdAlreadySet:"Cannot insert if the {0} member is already set.",MobileServiceLogin_AuthenticationProviderNotSupported:"Unsupported authentication provider name. Please specify one of {0}.",MobileServiceLogin_LoginErrorResponse:"Cannot start a login operation because login is already in progress.",MobileServiceLogin_InvalidResponseFormat:"Invalid format of the authentication response.",MobileServiceLogin_InvalidProvider:"The first parameter must be the name of the autentication provider or a Microsoft Account authentication token.",MobileServiceTable_NotSingleObject:"Could not get object from response {0}.",Push_ConflictWithReservedName:"Template name conflicts with reserved name '{0}'.",Push_InvalidTemplateName:"Template name can't contain ';' or ':'.",Push_NotSupportedXMLFormatAsBodyTemplateWin8:"The bodyTemplate is not in accepted XML format. The first node of the bodyTemplate should be Badge/Tile/Toast, except for the wns/raw template, which need to be a valid XML.",Push_BodyTemplateMustBeXml:"Valid XML is required for any template without a raw header.",Push_TagNoCommas:"Tags must not contain ','."},$__modules__.Resources["es-ES"]={Validate_NotNullError:"{0} no puede ser nulo.",Validate_NotNullOrEmptyError:"{0} no puede ser nulo ni estar vacío.",Validate_InvalidId:"{0} no es válido.",Validate_TypeCheckError:"Se espera que {0} sea un valor del tipo {1}, no {2}.",Validate_LengthUnexpected:"Se espera que {0} tenga una longitud {1}, no {2}.",Validate_InvalidUserParameter:"{0} contiene un parámetro de cadena de consulta definido por el usuario: {1}. Los parámetros de cadena de consulta definidos por el usuario no deben comenzar por '$'.",Extensions_DefaultErrorMessage:"Error inesperado.",Extensions_ConnectionFailureMessage:"Error de conexión inesperado.",MobileServiceTable_ReadMismatchedQueryTables:"No se pueden obtener los resultados de una consulta para la tabla '{1}' mediante la tabla '{0}'.",MobileServiceTable_InsertIdAlreadySet:"No se puede insertar si el miembro {0} ya se ha establecido.",MobileServiceLogin_AuthenticationProviderNotSupported:"Nombre de proveedor de autenticación no admitido. Especifique uno de {0}.",MobileServiceLogin_LoginErrorResponse:"No se puede iniciar una operación de inicio de sesión porque el inicio de sesión ya está en curso.",MobileServiceLogin_InvalidResponseFormat:"Formato no válido de la respuesta de autenticación.",MobileServiceLogin_InvalidProvider:"El primer parámetro debe ser el nombre del proveedor de autenticación o un token de autenticación de la cuenta Microsoft.",MobileServiceTable_NotSingleObject:"No se puede obtener el objeto de la respuesta {0}.",Push_ConflictWithReservedName:"El nombre de la plantilla entra en conflicto con el nombre reservado '{0}'.",Push_InvalidTemplateName:"El nombre de la plantilla no puede contener ';' ni ':'.",Push_NotSupportedXMLFormatAsBodyTemplateWin8:"El objeto bodyTemplate no es un formato XML aceptado. El primer nodo del objeto bodyTemplate debe ser Badge/Tile/Toast, excepto para la plantilla wns o sin formato, que debe tener un formato XML válido.",Push_BodyTemplateMustBeXml:"Se requiere XML válido para todas las plantillas sin encabezado sin formato.",Push_TagNoCommas:"Las etiquetas no deben contener ','."},$__modules__.Resources["fr-FR"]={Validate_NotNullError:"{0} ne peut pas avoir une valeur null.",Validate_NotNullOrEmptyError:"{0} ne peut pas avoir une valeur null ou être vide.",Validate_InvalidId:"{0} n’est pas valide.",Validate_TypeCheckError:"{0} doit être une valeur de type {1}, et non {2}.",Validate_LengthUnexpected:"{0} doit avoir une longueur de {1}, et non {2}.",Validate_InvalidUserParameter:"{0} contient un paramètre de chaîne de requête défini par l’utilisateur non valide : {1}. Les paramètres de chaîne de requête définis par l’utilisateur ne doivent pas commencer par « $ ».",Extensions_DefaultErrorMessage:"Échec inattendu.",Extensions_ConnectionFailureMessage:"Échec de connexion inattendu.",MobileServiceTable_ReadMismatchedQueryTables:"Impossible d’obtenir les résultats d’une requête pour la table « {1} » via la table « {0} ».",MobileServiceTable_InsertIdAlreadySet:"Insertion impossible si le membre {0} est déjà défini.",MobileServiceLogin_AuthenticationProviderNotSupported:"Le nom du fournisseur d’authentification n’est pas pris en charge. Veuillez en spécifier un de {0}.",MobileServiceLogin_LoginErrorResponse:"Impossible de démarrer une opération d’ouverture de session, car une ouverture de session est déjà en cours.",MobileServiceLogin_InvalidResponseFormat:"Le format de la réponse d’authentification n’est pas valide.",MobileServiceLogin_InvalidProvider:"Le premier paramètre doit correspondre au nom du fournisseur d’autentification ou à un jeton d’authentification de compte Microsoft.",MobileServiceTable_NotSingleObject:"Impossible d’obtenir un objet de la réponse {0}.",Push_ConflictWithReservedName:"Le nom de modèle entre en conflit avec le nom réservé '{0}'.",Push_InvalidTemplateName:"Le nom du modèle ne peut contenir ni ';' ni ':'.",Push_NotSupportedXMLFormatAsBodyTemplateWin8:"Le bodyTemplate n'est pas dans un format XML accepté. Le premier nœud de bodyTemplate doit être Badge/Tile/Toast, sauf le modèle wns/raw, qui doit être un XML valide.",Push_BodyTemplateMustBeXml:"XML valide est nécessaire pour tout modèle sans un en-tête brut.",Push_TagNoCommas:"Les balises ne doivent pas contenir ','."},$__modules__.Resources["it-IT"]={Validate_NotNullError:"{0} non può essere null.",Validate_NotNullOrEmptyError:"{0} non può essere null o vuoto.",Validate_InvalidId:"{0} non valido.",Validate_TypeCheckError:"{0} deve essere un valore di tipo {1}, non {2}.",Validate_LengthUnexpected:"{0} deve avere una lunghezza {1}, non {2}.",Validate_InvalidUserParameter:"{0} contiene un parametro di stringa di query definito dall'utente non valido: {1}. Questi parametri non devono iniziare con '$'.",Extensions_DefaultErrorMessage:"Errore imprevisto.",Extensions_ConnectionFailureMessage:"Errore di connessione imprevisto.",MobileServiceTable_ReadMismatchedQueryTables:"Impossibile ottenere i risultati di una query per la tabella '{1}' tramite la tabella '{0}'.",MobileServiceTable_InsertIdAlreadySet:"Impossibile eseguire l'inserimento se il membro {0} è già impostato.",MobileServiceLogin_AuthenticationProviderNotSupported:"Nome provider di autenticazione non supportato. Specificare un nome di {0}.",MobileServiceLogin_LoginErrorResponse:"Impossibile avviare l'accesso perché l'operazione è già in corso.",MobileServiceLogin_InvalidResponseFormat:"Formato della risposta di autenticazione non valido.",MobileServiceLogin_InvalidProvider:"Il primo parametro deve essere il nome di un provider di autenticazione o un token di autenticazione dell'account Microsoft.",MobileServiceTable_NotSingleObject:"Impossibile ottenere un oggetto dalla risposta {0}.",Push_ConflictWithReservedName:"Nome modello in conflitto con il nome riservato '{0}'.",Push_InvalidTemplateName:"Il nome modello non può contenere ';' o ':'.",Push_NotSupportedXMLFormatAsBodyTemplateWin8:"Formato XML di bodyTemplate non accettato. Il primo nodo di bodyTemplate deve essere Badge/Tile/Toast, ad eccezione del modello wns/raw, che devono essere in formato XML valido.",Push_BodyTemplateMustBeXml:"Per i modelli che non dispongono di un'intestazione non elaborata è necessario un XML valido.",Push_TagNoCommas:"I tag non devono contenere ','."},$__modules__.Resources["ja-JP"]={Validate_NotNullError:"{0} を null にすることはできません。",Validate_NotNullOrEmptyError:"{0} を null または空にすることはできません。",Validate_InvalidId:"{0} は無効です。",Validate_TypeCheckError:"{0} は、{2} ではなく型 {1} の値であることが想定されています。",Validate_LengthUnexpected:"{0} は、{2} ではなく長さ {1} であることが想定されています。",Validate_InvalidUserParameter:"{0} には無効なユーザー定義クエリ文字列パラメーター {1} が含まれています。ユーザー定義クエリ文字列パラメーターの先頭を '$' にすることはできません。",Extensions_DefaultErrorMessage:"予期しないエラー。",Extensions_ConnectionFailureMessage:"予期しない接続エラー。",MobileServiceTable_ReadMismatchedQueryTables:"テーブル '{0}' を介してテーブル '{1}' のクエリの結果を取得することはできません。",MobileServiceTable_InsertIdAlreadySet:"{0} メンバーが既に設定されている場合は、挿入できません。",MobileServiceLogin_AuthenticationProviderNotSupported:"サポートされていない認証プロバイダーの名前です。{0} のいずれかを指定してください。",MobileServiceLogin_LoginErrorResponse:"ログインが既に進行中であるため、ログイン処理を開始できません。",MobileServiceLogin_InvalidResponseFormat:"認証の応答の形式が正しくありません。",MobileServiceLogin_InvalidProvider:"最初のパラメーターは、認証プロバイダーまたは Microsoft アカウントの認証トークンの名前である必要があります。",MobileServiceTable_NotSingleObject:"応答 {0} からオブジェクトを取得できません。",Push_ConflictWithReservedName:"テンプレート名が予約された名前 '{0}' と競合します。",Push_InvalidTemplateName:'テンプレート名に ";" または ":" を含めることはできません。',Push_NotSupportedXMLFormatAsBodyTemplateWin8:"bodyTemplate は許可される XML 形式ではありません。有効な XML である必要がある wns/raw テンプレートを除き、bodyTemplate の最初のノードは Badge/Tile/Toast である必要があります。",Push_BodyTemplateMustBeXml:"生のヘッダーのないテンプレートには、有効な XML が必要です。",Push_TagNoCommas:"タグに ',' を含めることはできません。"},$__modules__.Resources["ko-KR"]={Validate_NotNullError:"{0}은(는) null일 수 없습니다.",Validate_NotNullOrEmptyError:"{0}은(는) null이거나 비어 있을 수 없습니다.",Validate_InvalidId:"{0}이(가) 잘못되었습니다.",Validate_TypeCheckError:"{0}은(는) {2}이(가) 아닌 유형 {1}의 값이어야 합니다.",Validate_LengthUnexpected:"{0}에는 {2}이(가) 아닌 길이 {1}이(가) 필요합니다.",Validate_InvalidUserParameter:"{0}에 잘못된 사용자 정의 쿼리 문자열 매개 변수 {1}이(가) 포함됩니다. 사용자 정의 쿼리 문자열 매개 변수는 '$'로 시작할 수 없습니다.",Extensions_DefaultErrorMessage:"예상치 못한 오류입니다.",Extensions_ConnectionFailureMessage:"예상치 못한 연결 오류입니다.",MobileServiceTable_ReadMismatchedQueryTables:"테이블 '{0}'을(를) 통해 테이블 '{1}'의 쿼리 결과를 가져올 수 없습니다.",MobileServiceTable_InsertIdAlreadySet:"구성원 {0}이(가) 이미 설정된 경우에는 삽입할 수 없습니다.",MobileServiceLogin_AuthenticationProviderNotSupported:"지원되지 않는 인증 공급자 이름입니다. {0} 중 하나를 지정하십시오.",MobileServiceLogin_LoginErrorResponse:"로그인이 이미 진행 중이므로 로그인 작업을 시작할 수 없습니다.",MobileServiceLogin_InvalidResponseFormat:"잘못된 형식의 인증 응답입니다.",MobileServiceLogin_InvalidProvider:"첫 번째 매개 변수는 인증 공급자의 이름이거나 Microsoft 계정 인증 토큰이어야 합니다.",MobileServiceTable_NotSingleObject:"응답 {0}에서 개체를 가져올 수 없습니다.",Push_ConflictWithReservedName:"템플릿 이름이 예약된 이름 '{0}'과(와) 충돌합니다.",Push_InvalidTemplateName:"템플릿 이름에 ';' 또는 ':'을 포함할 수 없습니다.",Push_NotSupportedXMLFormatAsBodyTemplateWin8:"bodyTemplate이 허용되는 XML 형식이 아닙니다. wns/원시 템플릿을 제외한 bodyTemplate의 첫 번째 노드는 Badge/Tile/Toast여야 하며, 이는 올바른 XML이어야 합니다.",Push_BodyTemplateMustBeXml:"원시 헤더가 없는 템플릿에 올바른 XML이 필요합니다.",Push_TagNoCommas:"태그에 ','를 포함하지 않아야 합니다."},$__modules__.Resources["ru-RU"]={Validate_NotNullError:"{0} не может иметь значение NULL.",Validate_NotNullOrEmptyError:"{0} не может иметь значение NULL или пустое значение.",Validate_InvalidId:"{0} не является действительным.",Validate_TypeCheckError:"Ожидается значение {0} типа {1}, а не {2}.",Validate_LengthUnexpected:"Ожидается длина {0}, равная {1}, а не {2}.",Validate_InvalidUserParameter:"{0} содержит недопустимый параметр пользовательской строки запроса: {1}. Параметры пользовательской строки запроса не должны начинаться с '$'.",Extensions_DefaultErrorMessage:"Непредвиденный сбой.",Extensions_ConnectionFailureMessage:"Непредвиденный сбой подключения.",MobileServiceTable_ReadMismatchedQueryTables:'Не удается получить результаты запроса таблицы "{1}" посредством таблицы "{0}".',MobileServiceTable_InsertIdAlreadySet:"Вставка невозможна, если элемент {0} уже задан.",MobileServiceLogin_AuthenticationProviderNotSupported:"Неподдерживаемое имя поставщика проверки подлинности. Укажите одно из следующих: {0}.",MobileServiceLogin_LoginErrorResponse:"Не удается начать операцию входа, так как он уже выполняется.",MobileServiceLogin_InvalidResponseFormat:"Недопустимый формат ответа проверки подлинности.",MobileServiceLogin_InvalidProvider:"Первым параметром должно быть имя поставщика проверки подлинности или маркер проверки подлинности учетной записи Майкрософт.",MobileServiceTable_NotSingleObject:"Не удалось получить объект из ответа: {0}.",Push_ConflictWithReservedName:'Имя шаблона конфликтует с зарезервированным именем "{0}".',Push_InvalidTemplateName:'Имя шаблона не может содержать символы ";" или ":".',Push_NotSupportedXMLFormatAsBodyTemplateWin8:"Шаблон текста в формате XML не принимается. Первым узлом bodyTemplate должен быть Badge/Tile/Toast, за исключением шаблона wns/raw, который должен быть представлен в действительном формате XML.",Push_BodyTemplateMustBeXml:"В заголовке raw любого шаблона должен быть указан допустимый XML.",Push_TagNoCommas:'Теги не должны содержать символ ",".'},$__modules__.Resources["zh-CN"]={Validate_NotNullError:"{0} 不能为 Null。",Validate_NotNullOrEmptyError:"{0} 不能为 Null 或为空。",Validate_InvalidId:"{0} 无效。",Validate_TypeCheckError:"{0} 应为 {1} 类型的值，而不是 {2} 类型的值。",Validate_LengthUnexpected:"{0} 的长度应为 {1}，而不是 {2}。",Validate_InvalidUserParameter:'{0} 包含无效的用户定义的查询字符串参数: {1}。用户定义的查询字符串参数不能以 "$" 开头。',Extensions_DefaultErrorMessage:"意外失败。",Extensions_ConnectionFailureMessage:"意外的连接失败。",MobileServiceTable_ReadMismatchedQueryTables:"无法通过表“{0}”获取表“{1}”的查询结果。",MobileServiceTable_InsertIdAlreadySet:"如果已设置 {0} 成员，则无法插入。",MobileServiceLogin_AuthenticationProviderNotSupported:"身份验证提供程序名称不受支持。请从 {0} 中指定一个。",MobileServiceLogin_LoginErrorResponse:"无法启动登录操作，因为登录已在进行中。",MobileServiceLogin_InvalidResponseFormat:"身份验证响应的格式无效。",MobileServiceLogin_InvalidProvider:"第一个参数必须是身份验证提供程序的名称或 Microsoft 帐户身份验证令牌。",MobileServiceTable_NotSingleObject:"无法从响应 {0} 获取对象。",Push_ConflictWithReservedName:"模板名称与保留名称“{0}”冲突。",Push_InvalidTemplateName:"模板名称不能包含“;”或“:”。",Push_NotSupportedXMLFormatAsBodyTemplateWin8:"bodyTemplate 不是接受的 XML 格式。bodyTemplate 的第一个节点应为 Badge/Tile/Toast，但 wns/raw 模板除外，此模板应为有效的 XML。",Push_BodyTemplateMustBeXml:"不含 raw 标头的任何模板都必须为有效的 XML 格式。",Push_TagNoCommas:"标记不得包含“,”。"},$__modules__.Resources["zh-TW"]={Validate_NotNullError:"{0} 不能為 Null。",Validate_NotNullOrEmptyError:"{0} 不能為 Null 或空。",Validate_InvalidId:"{0} 無效。",Validate_TypeCheckError:"{0} 預期為類型 {1} 的值，而非 {2}。",Validate_LengthUnexpected:"{0} 預期長度為 {1}，而非 {2}。",Validate_InvalidUserParameter:"{0} 包含無效的使用者定義查詢字串參數: {1}。使用者定義查詢字串參數不能以 '$' 開頭。",Extensions_DefaultErrorMessage:"未預期的失敗。",Extensions_ConnectionFailureMessage:"未預期的連線失敗。",MobileServiceTable_ReadMismatchedQueryTables:"無法透過表格 '{0}' 取得表格 '{1}' 的查詢結果。",MobileServiceTable_InsertIdAlreadySet:"如果已設定 {0} 成員，則無法插入。",MobileServiceLogin_AuthenticationProviderNotSupported:"不支援的驗證提供者名稱。請指定其中一個 {0}。",MobileServiceLogin_LoginErrorResponse:"無法開始登入作業，因為登入作業已在進行中。",MobileServiceLogin_InvalidResponseFormat:"無效的驗證回應格式。",MobileServiceLogin_InvalidProvider:"第一個參數必須為驗證提供者名稱或 Microsoft 帳戶驗證 Token。",MobileServiceTable_NotSingleObject:"無法從回應 {0} 中取得物件。",Push_ConflictWithReservedName:"範本名稱與保留的名稱 '{0}' 衝突。",Push_InvalidTemplateName:"範本名稱不能包含 ';' 或 ':'。",Push_NotSupportedXMLFormatAsBodyTemplateWin8:"bodyTemplate 的 XML 格式不受支援。bodyTemplate 的第一個節點應該是 Badge/Tile/Toast，wns/raw 除外，其應該有有有效的 XML。",Push_BodyTemplateMustBeXml:"任何沒有原始標頭的範本都需要有效的 XML。",Push_TagNoCommas:"標籤不能包含 ','。"},$__modules__.Extensions=function(exports){function classOf(value){return Object.prototype.toString.call(value).slice(8,-1).toLowerCase()}var Validate=require("Validate"),Platform=require("Platform"),_=exports;exports.isNull=function(value){return null===value||void 0===value},exports.isNullOrZero=function(value){return null===value||void 0===value||0===value||""===value},exports.isNullOrEmpty=function(value){return _.isNull(value)||0===value.length},exports.format=function(message){if(Validate.isString(message,"message"),!_.isNullOrEmpty(message)&&arguments.length>1)for(var i=1;i<arguments.length;i++)for(var pattern="{"+(i-1)+"}";-1!==message.indexOf(pattern);)message=message.replace(pattern,arguments[i]);return message},exports.has=function(value,key){return Validate.notNull(key,"key"),Validate.isString(key,"key"),!_.isNull(value)&&value.hasOwnProperty(key)},exports.hasProperty=function(object,properties){for(var i=0;i<properties.length;i++)if(_.has(object,properties[i]))return!0;return!1},exports.extend=function(target,members){for(var member in members)members.hasOwnProperty(member)&&(target[member]=members[member]);return target},exports.isObject=function(value){return _.isNull(value)||"object"==typeof value&&!_.isDate(value)},exports.isValidId=function(value){if(_.isNullOrZero(value))return!1;if(_.isString(value)){if(0===value.length||value.length>255||0===value.trim().length)return!1;var ex=/[+"\/?`\\]|[\u0000-\u001F]|[\u007F-\u009F]|^\.{1,2}$/;return null!==value.match(ex)?!1:!0}return _.isNumber(value)?value>0:!1},exports.isString=function(value){return _.isNull(value)||"string"==typeof value},exports.isNumber=function(value){return!_.isNull(value)&&"number"==typeof value},exports.isBool=function(value){return!_.isNull(value)&&"boolean"==typeof value},exports.isDate=function(value){return!_.isNull(value)&&"date"==classOf(value)},exports.toJson=function(value){return Platform.toJson(value)},exports.fromJson=function(value){var jsonValue=null;return _.isNullOrEmpty(value)||(jsonValue=JSON.parse(value,function(k,v){if(_.isString(v)&&!_.isNullOrEmpty(v)){var date=exports.tryParseIsoDateString(v);if(!_.isNull(date))return date}return v})),jsonValue},exports.createUniqueInstallationId=function(){var pad4=function(str){return"0000".substring(str.length)+str},hex4=function(){return pad4(Math.floor(65536*Math.random()).toString(16))};return hex4()+hex4()+"-"+hex4()+"-"+hex4()+"-"+hex4()+"-"+hex4()+hex4()+hex4()},exports.mapProperties=function(instance,action){var results=[];if(!_.isNull(instance)){var key=null;for(key in instance)results.push(action(key,instance[key]))}return results},exports.pad=function(value,length,ch){Validate.notNull(value,"value"),Validate.isInteger(length,"length"),Validate.isString(ch,"ch"),Validate.notNullOrEmpty(ch,"ch"),Validate.length(ch,1,"ch");for(var text=value.toString();text.length<length;)text=ch+text;return text},exports.trimEnd=function(text,ch){Validate.isString(text,"text"),Validate.notNull(text,"text"),Validate.isString(ch,"ch"),Validate.notNullOrEmpty("ch","ch"),Validate.length(ch,1,"ch");for(var end=text.length-1;end>=0&&text[end]===ch;)end--;return end>=0?text.substr(0,end+1):""},exports.trimStart=function(text,ch){Validate.isString(text,"text"),Validate.notNull(text,"text"),Validate.isString(ch,"ch"),Validate.notNullOrEmpty(ch,"ch"),Validate.length(ch,1,"ch");for(var start=0;start<text.length&&text[start]===ch;)start++;return start<text.length?text.substr(start,text.length-start):""},exports.compareCaseInsensitive=function(first,second){return _.isString(first)&&!_.isNullOrEmpty(first)&&(first=first.toUpperCase()),_.isString(first)&&!_.isNullOrEmpty(second)&&(second=second.toUpperCase()),first===second},exports.url={separator:"/",combinePathSegments:function(){var segments=[],i=0;for(Validate.notNullOrEmpty(arguments,"arguments"),i=0;i<arguments.length;i++){var segment=arguments[i];Validate.isString(segment,_.format("argument[{0}]",i)),0!==i&&(segment=_.trimStart(segment||"",_.url.separator)),i<arguments.length-1&&(segment=_.trimEnd(segment||"",_.url.separator)),segments.push(segment)}return segments.reduce(function(a,b){return a+_.url.separator+b})},getQueryString:function(parameters){Validate.notNull(parameters,"parameters"),Validate.isObject(parameters,"parameters");var pairs=[];for(var parameter in parameters){var value=parameters[parameter];exports.isObject(value)&&(value=exports.toJson(value)),pairs.push(encodeURIComponent(parameter)+"="+encodeURIComponent(value))}return pairs.join("&")},combinePathAndQuery:function(path,queryString){return Validate.notNullOrEmpty(path,"path"),Validate.isString(path,"path"),_.isNullOrEmpty(queryString)?path:(Validate.isString(queryString,"queryString"),path.indexOf("?")>=0?path+"&"+exports.trimStart(queryString,"?"):path+"?"+exports.trimStart(queryString,"?"))},isAbsoluteUrl:function(url){if(_.isNullOrEmpty(url))return!1;var start=url.substring(0,7).toLowerCase();return"http://"==start||"https:/"==start}},exports.tryParseIsoDateString=function(text){return Platform.tryParseIsoDateString(text)},exports.createError=function(exceptionOrMessage,request){var error={message:Platform.getResourceString("Extensions_DefaultErrorMessage")};if(error.toString=function(){return error.message},request)if(error.request=request,0===request.status)error.message=Platform.getResourceString("Extensions_ConnectionFailureMessage");else{var isText=!1;if(request.getResponseHeader){var contentType=request.getResponseHeader("Content-Type");contentType&&(isText=contentType.toLowerCase().indexOf("text")>=0)}try{var response=JSON.parse(request.responseText);error.message="string"==typeof response?response:response.error||response.description||request.statusText||Platform.getResourceString("Extensions_DefaultErrorMessage")}catch(ex){error.message=isText?request.responseText:request.statusText||Platform.getResourceString("Extensions_DefaultErrorMessage")}}else _.isString(exceptionOrMessage)&&!_.isNullOrEmpty(exceptionOrMessage)?error.message=exceptionOrMessage:_.isNull(exceptionOrMessage)||(error.exception=exceptionOrMessage);return error}},$__modules__.MobileServiceClient=function(exports){function MobileServiceClient(applicationUrl,applicationKey){Validate.isString(applicationUrl,"applicationUrl"),Validate.notNullOrEmpty(applicationUrl,"applicationUrl"),Validate.isString(applicationKey,"applicationKey"),this.applicationUrl=applicationUrl,this.applicationKey=applicationKey||null;var sdkInfo=Platform.getSdkInfo(),osInfo=Platform.getOperatingSystemInfo(),sdkVersion=sdkInfo.fileVersion.split(".").slice(0,2).join(".");this.version="ZUMO/"+sdkVersion+" (lang="+sdkInfo.language+"; os="+osInfo.name+"; os_version="+osInfo.version+"; arch="+osInfo.architecture+"; version="+sdkInfo.fileVersion+")",this.currentUser=null,this._serviceFilter=null,this._login=new MobileServiceLogin(this),this.getTable=function(tableName){return Validate.isString(tableName,"tableName"),Validate.notNullOrEmpty(tableName,"tableName"),new MobileServiceTable(tableName,this)},Push&&(this.push=new Push(this))}function getApplicationInstallationId(){var applicationInstallationId=null,path="MobileServices.Installation.config",contents=Platform.readSetting(path);if(!_.isNull(contents))try{var config=_.fromJson(contents);applicationInstallationId=config.applicationInstallationId}catch(ex){}if(_.isNullOrEmpty(applicationInstallationId)){applicationInstallationId=_.createUniqueInstallationId();var configText=_.toJson({applicationInstallationId:applicationInstallationId});Platform.writeSetting(path,configText)}return applicationInstallationId}var Push,_=require("Extensions"),Validate=require("Validate"),Platform=require("Platform"),MobileServiceTable=require("MobileServiceTable").MobileServiceTable,MobileServiceLogin=require("MobileServiceLogin").MobileServiceLogin;try{Push=require("Push").Push}catch(e){}var _zumoFeatures={JsonApiCall:"AJ",GenericApiCall:"AG",AdditionalQueryParameters:"QS",OptimisticConcurrency:"OC",TableRefreshCall:"RF",TableReadRaw:"TR",TableReadQuery:"TQ"},_zumoFeaturesHeaderName="X-ZUMO-FEATURES";exports.MobileServiceClient=MobileServiceClient,Platform.addToMobileServicesClientNamespace({MobileServiceClient:MobileServiceClient}),MobileServiceClient.prototype.withFilter=function(serviceFilter){Validate.notNull(serviceFilter,"serviceFilter");var client=new MobileServiceClient(this.applicationUrl,this.applicationKey);client.currentUser=this.currentUser;var existingFilter=this._serviceFilter;return client._serviceFilter=_.isNull(existingFilter)?serviceFilter:function(req,next,callback){var composed=function(req,callback){existingFilter(req,next,callback)};serviceFilter(req,composed,callback)},client},MobileServiceClient.prototype._request=function(method,uriFragment,content,ignoreFilters,headers,features,callback){_.isNull(callback)&&"function"==typeof features&&(callback=features,features=null),_.isNull(callback)&&"function"==typeof headers&&(callback=headers,headers=null),_.isNull(callback)&&"function"==typeof ignoreFilters&&(callback=ignoreFilters,ignoreFilters=!1),_.isNull(callback)&&"function"==typeof content&&(callback=content,content=null),Validate.isString(method,"method"),Validate.notNullOrEmpty(method,"method"),Validate.isString(uriFragment,"uriFragment"),Validate.notNull(uriFragment,"uriFragment"),Validate.notNull(callback,"callback");var options={type:method.toUpperCase()};options.url=_.url.isAbsoluteUrl(uriFragment)?uriFragment:_.url.combinePathSegments(this.applicationUrl,uriFragment),options.headers={},_.isNull(headers)||_.extend(options.headers,headers),options.headers["X-ZUMO-INSTALLATION-ID"]=MobileServiceClient._applicationInstallationId,_.isNullOrEmpty(this.applicationKey)||(options.headers["X-ZUMO-APPLICATION"]=this.applicationKey),this.currentUser&&!_.isNullOrEmpty(this.currentUser.mobileServiceAuthenticationToken)&&(options.headers["X-ZUMO-AUTH"]=this.currentUser.mobileServiceAuthenticationToken),_.isNull(MobileServiceClient._userAgent)||(options.headers["User-Agent"]=MobileServiceClient._userAgent),_.isNullOrEmpty["X-ZUMO-VERSION"]||(options.headers["X-ZUMO-VERSION"]=this.version),_.isNull(options.headers[_zumoFeaturesHeaderName])&&features&&features.length&&(options.headers[_zumoFeaturesHeaderName]=features.join(",")),_.isNull(content)?options.data=null:(options.data=_.isString(content)?content:_.toJson(content),_.hasProperty(options.headers,["Content-Type","content-type","CONTENT-TYPE","Content-type"])||(options.headers["Content-Type"]="application/json"));var handler=function(error,response){_.isNull(error)?!_.isNull(response)&&(response.status>=400||0===response.status)&&(error=_.createError(null,response),response=null):error=_.createError(error),callback(error,response)};_.isNull(this._serviceFilter)||ignoreFilters?Platform.webRequest(options,handler):this._serviceFilter(options,Platform.webRequest,handler)},MobileServiceClient.prototype.loginWithOptions=Platform.async(function(provider,options,callback){this._login.loginWithOptions(provider,options,callback)}),MobileServiceClient.prototype.login=Platform.async(function(provider,token,useSingleSignOn,callback){this._login.login(provider,token,useSingleSignOn,callback)}),MobileServiceClient.prototype.logout=function(){this.currentUser=null},MobileServiceClient.prototype.invokeApi=Platform.async(function(apiName,options,callback){Validate.isString(apiName,"apiName"),_.isNull(callback)&&"function"==typeof options&&(callback=options,options=null),Validate.notNull(callback,"callback");var parameters,method,body,headers;_.isNull(options)||(parameters=options.parameters,_.isNull(parameters)||Validate.isValidParametersObject(options.parameters),method=options.method,body=options.body,headers=options.headers),_.isNull(method)&&(method="POST");var urlFragment=_.url.combinePathSegments("api",apiName);if(!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);urlFragment=_.url.combinePathAndQuery(urlFragment,queryString)}var features=[];_.isNullOrEmpty(body)||features.push(_.isString(body)?_zumoFeatures.GenericApiCall:_zumoFeatures.JsonApiCall),_.isNull(parameters)||features.push(_zumoFeatures.AdditionalQueryParameters),this._request(method,urlFragment,body,null,headers,features,function(error,response){if(_.isNull(error)){var contentType;if("undefined"!=typeof response.getResponseHeader&&(contentType=response.getResponseHeader("Content-Type")),contentType)-1!==contentType.toLowerCase().indexOf("json")&&(response.result=_.fromJson(response.responseText));else try{response.result=_.fromJson(response.responseText)}catch(e){}callback(null,response)}else callback(error,null)})}),MobileServiceClient._applicationInstallationId=getApplicationInstallationId(),MobileServiceClient._userAgent=Platform.getUserAgent(),MobileServiceClient._zumoFeatures=_zumoFeatures},$__modules__.MobileServiceTable=function(exports){function MobileServiceTable(tableName,client){this.getTableName=function(){return tableName},this.getMobileServiceClient=function(){return client},this.systemProperties=0}function removeSystemProperties(instance){var copy={};for(var property in instance)"__"!==property.substr(0,2)&&(copy[property]=instance[property]);return copy}function addSystemProperties(parameters,properties,querystring){if(properties===MobileServiceSystemProperties.None||"string"==typeof querystring&&querystring.toLowerCase().indexOf("__systemproperties")>=0)return parameters;if(parameters=parameters||{},!_.isNull(parameters.__systemProperties))return parameters;if(properties===MobileServiceSystemProperties.All)parameters.__systemProperties="*";else{var options=[];MobileServiceSystemProperties.CreatedAt&properties&&options.push(MobileServiceSystemColumns.CreatedAt),MobileServiceSystemProperties.UpdatedAt&properties&&options.push(MobileServiceSystemColumns.UpdatedAt),MobileServiceSystemProperties.Version&properties&&options.push(MobileServiceSystemColumns.Version),parameters.__systemProperties=options.join(",")
}return parameters}function getItemFromResponse(response){var result=_.fromJson(response.responseText);if(response.getResponseHeader){var eTag=response.getResponseHeader("ETag");_.isNullOrEmpty(eTag)||(result.__version=getVersionFromEtag(eTag))}return result}function setServerItemIfPreconditionFailed(error){error.request&&412===error.request.status&&(error.serverInstance=_.fromJson(error.request.responseText))}function getEtagFromVersion(version){var result=version.replace(/\"/g,'\\"');return'"'+result+'"'}function getVersionFromEtag(etag){var len=etag.length,result=etag;return len>1&&'"'===etag[0]&&'"'===etag[len-1]&&(result=etag.substr(1,len-2)),result.replace(/\\\"/g,'"')}function addQueryParametersFeaturesIfApplicable(features,userQueryParameters){var hasQueryParameters=!1;if(userQueryParameters)if(Array.isArray(userQueryParameters))hasQueryParameters=userQueryParameters.length>0;else if(_.isObject(userQueryParameters))for(var k in userQueryParameters){hasQueryParameters=!0;break}return hasQueryParameters&&features.push(WindowsAzure.MobileServiceClient._zumoFeatures.AdditionalQueryParameters),features}var _=require("Extensions"),Validate=require("Validate"),Platform=require("Platform"),Query=require("Query").Query,idPropertyName="id",tableRouteSeperatorName="tables",idNames=["ID","Id","id","iD"],nextLinkRegex=/^(.*?);\s*rel\s*=\s*(\w+)\s*$/,MobileServiceSystemProperties={None:0,CreatedAt:1,UpdatedAt:2,Version:4,All:65535},MobileServiceSystemColumns={CreatedAt:"__createdAt",UpdatedAt:"__updatedAt",Version:"__version"};Platform.addToMobileServicesClientNamespace({MobileServiceTable:{SystemProperties:MobileServiceSystemProperties}}),exports.MobileServiceTable=MobileServiceTable,MobileServiceTable.prototype._read=function(query,parameters,callback){_.isNull(callback)&&(_.isNull(parameters)&&"function"==typeof query?(callback=query,query=null,parameters=null):"function"==typeof parameters&&(callback=parameters,parameters=null,!_.isNull(query)&&_.isObject(query)&&!_.isString(query)&&_.isNull(query.toOData)&&(parameters=query,query=null))),query&&_.isString(query)&&Validate.notNullOrEmpty(query,"query"),_.isNull(parameters)||Validate.isValidParametersObject(parameters,"parameters"),Validate.notNull(callback,"callback");var tableName=this.getTableName(),queryString=null,projection=null,features=[];if(_.isString(query))queryString=query,_.isNullOrEmpty(query)||features.push(WindowsAzure.MobileServiceClient._zumoFeatures.TableReadRaw);else if(_.isObject(query)&&!_.isNull(query.toOData)&&query.getComponents){features.push(WindowsAzure.MobileServiceClient._zumoFeatures.TableReadQuery);var components=query.getComponents();if(projection=components.projection,components.table){if(tableName!==components.table){var message=_.format(Platform.getResourceString("MobileServiceTable_ReadMismatchedQueryTables"),tableName,components.table);return void callback(_.createError(message),null)}var oDataQuery=query.toOData();queryString=oDataQuery.replace(new RegExp("^/"+components.table),"")}}if(addQueryParametersFeaturesIfApplicable(features,parameters),parameters=addSystemProperties(parameters,this.systemProperties,queryString),!_.isNull(parameters)){var userDefinedQueryString=_.url.getQueryString(parameters);_.isNullOrEmpty(queryString)?queryString=userDefinedQueryString:queryString+="&"+userDefinedQueryString}var urlFragment=queryString;_.url.isAbsoluteUrl(urlFragment)||(urlFragment=_.url.combinePathSegments(tableRouteSeperatorName,tableName),_.isNull(queryString)||(urlFragment=_.url.combinePathAndQuery(urlFragment,queryString))),this.getMobileServiceClient()._request("GET",urlFragment,null,!1,null,features,function(error,response){var values=null;if(_.isNull(error)){if(values=_.fromJson(response.responseText),values&&!Array.isArray(values)&&"undefined"!=typeof values.count&&"undefined"!=typeof values.results&&(values.results.totalCount=values.count,values=values.results),null!==projection){var i=0;for(i=0;i<values.length;i++)values[i]=projection.call(values[i])}if(Array.isArray(values)&&response.getResponseHeader&&_.isNull(values.nextLink))try{var link=response.getResponseHeader("Link");if(!_.isNullOrEmpty(link)){var result=nextLinkRegex.exec(link);result&&3===result.length&&"next"==result[2]&&(values.nextLink=result[1])}}catch(ex){}}callback(error,values)})},MobileServiceTable.prototype.read=Platform.async(MobileServiceTable.prototype._read),MobileServiceTable.prototype.insert=Platform.async(function(instance,parameters,callback){_.isNull(callback)&&"function"==typeof parameters&&(callback=parameters,parameters=null),Validate.notNull(instance,"instance"),_.isNull(parameters)||Validate.isValidParametersObject(parameters),Validate.notNull(callback,"callback");for(var i in idNames){var id=instance[idNames[i]];if(!_.isNullOrZero(id)){if(!_.isString(id))throw _.format(Platform.getResourceString("MobileServiceTable_InsertIdAlreadySet"),idPropertyName);if(idNames[i]!==idPropertyName)throw _.format(Platform.getResourceString("MobileServiceTable_InsertIdAlreadySet"),idPropertyName);Validate.isValidId(id,idPropertyName)}}var features=addQueryParametersFeaturesIfApplicable([],parameters),urlFragment=_.url.combinePathSegments(tableRouteSeperatorName,this.getTableName());if(parameters=addSystemProperties(parameters,this.systemProperties),!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);urlFragment=_.url.combinePathAndQuery(urlFragment,queryString)}this.getMobileServiceClient()._request("POST",urlFragment,instance,!1,null,features,function(error,response){if(_.isNull(error)){var result=getItemFromResponse(response);result=Platform.allowPlatformToMutateOriginal(instance,result),callback(null,result)}else callback(error,null)})}),MobileServiceTable.prototype.update=Platform.async(function(instance,parameters,callback){var version,serverInstance,headers={},features=[];_.isNull(callback)&&"function"==typeof parameters&&(callback=parameters,parameters=null),Validate.notNull(instance,"instance"),Validate.isValidId(instance[idPropertyName],"instance."+idPropertyName),_.isNull(parameters)||Validate.isValidParametersObject(parameters,"parameters"),Validate.notNull(callback,"callback"),_.isString(instance[idPropertyName])?(version=instance.__version,serverInstance=removeSystemProperties(instance)):serverInstance=instance,_.isNullOrEmpty(version)||(headers["If-Match"]=getEtagFromVersion(version),features.push(WindowsAzure.MobileServiceClient._zumoFeatures.OptimisticConcurrency)),features=addQueryParametersFeaturesIfApplicable(features,parameters),parameters=addSystemProperties(parameters,this.systemProperties);var urlFragment=_.url.combinePathSegments(tableRouteSeperatorName,this.getTableName(),encodeURIComponent(instance[idPropertyName].toString()));if(!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);urlFragment=_.url.combinePathAndQuery(urlFragment,queryString)}this.getMobileServiceClient()._request("PATCH",urlFragment,serverInstance,!1,headers,features,function(error,response){if(_.isNull(error)){var result=getItemFromResponse(response);result=Platform.allowPlatformToMutateOriginal(instance,result),callback(null,result)}else setServerItemIfPreconditionFailed(error),callback(error)})}),MobileServiceTable.prototype.refresh=Platform.async(function(instance,parameters,callback){if(_.isNull(callback)&&"function"==typeof parameters&&(callback=parameters,parameters=null),Validate.notNull(instance,"instance"),!_.isValidId(instance[idPropertyName],idPropertyName)){if("string"==typeof instance[idPropertyName]&&""!==instance[idPropertyName])throw _.format(Platform.getResourceString("Validate_InvalidId"),idPropertyName);return void callback(null,instance)}_.isNull(parameters)||Validate.isValidParametersObject(parameters,"parameters"),Validate.notNull(callback,"callback");var urlFragment=_.url.combinePathSegments(tableRouteSeperatorName,this.getTableName());if("string"==typeof instance[idPropertyName]){var id=encodeURIComponent(instance[idPropertyName]).replace(/\'/g,"%27%27");urlFragment=_.url.combinePathAndQuery(urlFragment,"?$filter=id eq '"+id+"'")}else urlFragment=_.url.combinePathAndQuery(urlFragment,"?$filter=id eq "+encodeURIComponent(instance[idPropertyName].toString()));if(!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);urlFragment=_.url.combinePathAndQuery(urlFragment,queryString)}var features=[WindowsAzure.MobileServiceClient._zumoFeatures.TableRefreshCall];features=addQueryParametersFeaturesIfApplicable(features,parameters),this.getMobileServiceClient()._request("GET",urlFragment,instance,!1,null,features,function(error,response){if(_.isNull(error)){var result=_.fromJson(response.responseText);if(Array.isArray(result)&&(result=result[0]),!result){var message=_.format(Platform.getResourceString("MobileServiceTable_NotSingleObject"),idPropertyName);callback(_.createError(message),null)}result=Platform.allowPlatformToMutateOriginal(instance,result),callback(null,result)}else callback(error,null)})}),MobileServiceTable.prototype.lookup=Platform.async(function(id,parameters,callback){_.isNull(callback)&&"function"==typeof parameters&&(callback=parameters,parameters=null),Validate.isValidId(id,idPropertyName),_.isNull(parameters)||Validate.isValidParametersObject(parameters),Validate.notNull(callback,"callback");var urlFragment=_.url.combinePathSegments(tableRouteSeperatorName,this.getTableName(),encodeURIComponent(id.toString())),features=addQueryParametersFeaturesIfApplicable([],parameters);if(parameters=addSystemProperties(parameters,this.systemProperties),!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);urlFragment=_.url.combinePathAndQuery(urlFragment,queryString)}this.getMobileServiceClient()._request("GET",urlFragment,null,!1,null,features,function(error,response){if(_.isNull(error)){var result=getItemFromResponse(response);callback(null,result)}else callback(error,null)})}),MobileServiceTable.prototype.del=Platform.async(function(instance,parameters,callback){_.isNull(callback)&&"function"==typeof parameters&&(callback=parameters,parameters=null),Validate.notNull(instance,"instance"),Validate.isValidId(instance[idPropertyName],"instance."+idPropertyName),Validate.notNull(callback,"callback");var headers={},features=[];_.isString(instance[idPropertyName])&&(_.isNullOrEmpty(instance.__version)||(headers["If-Match"]=getEtagFromVersion(instance.__version),features.push(WindowsAzure.MobileServiceClient._zumoFeatures.OptimisticConcurrency))),features=addQueryParametersFeaturesIfApplicable(features,parameters),parameters=addSystemProperties(parameters,this.systemProperties),_.isNull(parameters)||Validate.isValidParametersObject(parameters);var urlFragment=_.url.combinePathSegments(tableRouteSeperatorName,this.getTableName(),encodeURIComponent(instance[idPropertyName].toString()));if(!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);urlFragment=_.url.combinePathAndQuery(urlFragment,queryString)}this.getMobileServiceClient()._request("DELETE",urlFragment,null,!1,headers,features,function(error){_.isNull(error)||setServerItemIfPreconditionFailed(error),callback(error)})});for(var queryOperators=["where","select","orderBy","orderByDescending","skip","take","includeTotalCount"],copyOperator=function(operator){MobileServiceTable.prototype[operator]=function(){var table=this,query=new Query(table.getTableName());return query.read=Platform.async(function(parameters,callback){table._read(query,parameters,callback)}),query[operator].apply(query,arguments)}},i=0;i<queryOperators.length;i++)copyOperator(queryOperators[i])},$__modules__.MobileServiceLogin=function(exports){function MobileServiceLogin(client,ignoreFilters){_.isNull(ignoreFilters)&&(ignoreFilters=!0),Validate.notNull(client),Validate.isObject(client,"client"),this._loginState={inProcess:!1,cancelCallback:null},this.ignoreFilters=ignoreFilters,this.getMobileServiceClient=function(){return client},this.getLoginInProcess=function(){return this._loginState.inProcess}}function onLoginComplete(error,token,client,callback){var user=null;_.isNull(error)&&(!_.isNull(token)&&_.isObject(token)&&_.isObject(token.user)&&_.isString(token.authenticationToken)?(client.currentUser=token.user,client.currentUser.mobileServiceAuthenticationToken=token.authenticationToken,user=client.currentUser):error=Platform.getResourceString("MobileServiceLogin_InvalidResponseFormat")),_.isNull(callback)||callback(error,user)}function onLoginResponse(error,response,client,callback){var mobileServiceToken=null;if(_.isNull(error))try{mobileServiceToken=_.fromJson(response.responseText)}catch(e){error=e}onLoginComplete(error,mobileServiceToken,client,callback)}function loginWithProviderAndToken(login,provider,token,parameters,callback){var client=login.getMobileServiceClient();login._loginState={inProcess:!0,cancelCallback:null};var url=loginUrl+"/"+provider;if(!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);url=_.url.combinePathAndQuery(url,queryString)}client._request("POST",url,token,login.ignoreFilters,function(error,response){login._loginState={inProcess:!1,cancelCallback:null},onLoginResponse(error,response,client,callback)})}function loginWithLoginControl(login,provider,useSingleSignOn,parameters,callback){var client=login.getMobileServiceClient(),startUri=_.url.combinePathSegments(client.applicationUrl,loginUrl,provider),endUri=null;if(!_.isNull(parameters)){var queryString=_.url.getQueryString(parameters);startUri=_.url.combinePathAndQuery(startUri,queryString)}useSingleSignOn||(endUri=_.url.combinePathSegments(client.applicationUrl,loginUrl,loginDone)),login._loginState={inProcess:!0,cancelCallback:null};var platformResult=Platform.login(startUri,endUri,function(error,mobileServiceToken){login._loginState={inProcess:!1,cancelCallback:null},onLoginComplete(error,mobileServiceToken,client,callback)});login._loginState.inProcess&&platformResult&&platformResult.cancelCallback&&(login._loginState.cancelCallback=platformResult.cancelCallback)}var _=require("Extensions"),Validate=require("Validate"),Platform=require("Platform"),loginUrl="login",loginDone="done";exports.MobileServiceLogin=MobileServiceLogin,Platform.addToMobileServicesClientNamespace({MobileServiceLogin:MobileServiceLogin}),MobileServiceLogin.prototype.loginWithOptions=function(provider,options,callback){Validate.isString(provider,"provider"),Validate.notNull(provider,"provider"),_.isNull(callback)&&(_.isNull(options)||"function"!=typeof options?Validate.notNull(null,"callback"):(callback=options,options=null)),!options&&this._isAuthToken(provider)?this.loginWithMobileServiceToken(provider,callback):(options=options||{},this.loginWithProvider(provider,options.token,options.useSingleSignOn,options.parameters,callback))},MobileServiceLogin.prototype.login=function(provider,token,useSingleSignOn,callback){_.isNull(callback)&&(_.isNull(useSingleSignOn)||"function"!=typeof useSingleSignOn?_.isNull(token)||"function"!=typeof token||(callback=token,useSingleSignOn=null,token=null):(callback=useSingleSignOn,useSingleSignOn=null)),_.isNull(useSingleSignOn)&&(_.isBool(token)?(useSingleSignOn=token,token=null):useSingleSignOn=!1),_.isNull(token)&&this._isAuthToken(provider)&&(token=provider,provider=null),_.isNull(provider)&&(Validate.notNull(token),Validate.isString(token)),_.isNull(token)&&(Validate.notNull(provider),Validate.isString(provider),provider=provider.toLowerCase()),_.isNull(provider)?this.loginWithMobileServiceToken(token,callback):("windowsazureactivedirectory"===provider.toLowerCase()&&(provider="aad"),this.loginWithProvider(provider,token,useSingleSignOn,{},callback))},MobileServiceLogin.prototype._isAuthToken=function(value){return value&&_.isString(value)&&3===value.split(".").length},MobileServiceLogin.prototype.loginWithMobileServiceToken=function(authenticationToken,callback){var self=this,client=self.getMobileServiceClient();Validate.isString(authenticationToken,"authenticationToken"),Validate.notNullOrEmpty(authenticationToken,"authenticationToken"),client._request("POST",loginUrl,{authenticationToken:authenticationToken},self.ignoreFilters,function(error,response){onLoginResponse(error,response,client,callback)})},MobileServiceLogin.prototype.loginWithProvider=function(provider,token,useSingleSignOn,parameters,callback){if(Validate.isString(provider,"provider"),_.isNull(token)||Validate.isObject(token,"token"),this._loginState.inProcess){var didCancel=this._loginState.cancelCallback&&this._loginState.cancelCallback();if(!didCancel)throw Platform.getResourceString("MobileServiceLogin_LoginErrorResponse")}provider=provider.toLowerCase(),_.isNull(token)?loginWithLoginControl(this,provider,useSingleSignOn,parameters,callback):loginWithProviderAndToken(this,provider,token,parameters,callback)}},$__modules__.RegistrationManager=function(exports){function RegistrationManager(mobileServicesClient,platform,storageKey){Validate.notNull(mobileServicesClient,"mobileServicesClient"),this._platform=platform||"wns",this._pushHttpClient=new PushHttpClient(mobileServicesClient),this._storageManager=new LocalStorageManager(storageKey||mobileServicesClient.applicationUrl)}var _=require("Extensions"),Validate=require("Validate"),Platform=require("Platform"),LocalStorageManager=require("LocalStorageManager").LocalStorageManager,PushHttpClient=require("PushHttpClient").PushHttpClient;exports.RegistrationManager=RegistrationManager,RegistrationManager.NativeRegistrationName=LocalStorageManager.NativeRegistrationName,RegistrationManager.prototype.upsertRegistration=Platform.async(function(registration,finalCallback){Validate.notNull(registration,"registration"),Validate.notNull(finalCallback,"callback");var self=this,expiredRegistration=function(callback){createRegistration(function(error){return error?void callback(error):void upsertRegistration(!1,callback)})},upsertRegistration=function(retry,callback){self._pushHttpClient.upsertRegistration(registration,function(error){return retry&&error&&error.request&&410===error.request.status?void expiredRegistration(callback):(error||(self._storageManager.pushHandle=registration.deviceId),void callback(error))})},createRegistration=function(callback){self._pushHttpClient.createRegistrationId(function(error,registrationId){return error?void callback(error):(registration.registrationId=registrationId,self._storageManager.updateRegistrationWithName(registration.templateName||LocalStorageManager.NativeRegistrationName,registration.registrationId,registration.deviceId),void callback())})},firstRegistration=function(callback){var name=registration.templateName||LocalStorageManager.NativeRegistrationName,cachedRegistrationId=self._storageManager.getRegistrationIdWithName(name);_.isNullOrEmpty(cachedRegistrationId)?createRegistration(function(error){return error?void callback(error):void upsertRegistration(!0,callback)}):(registration.registrationId=cachedRegistrationId,upsertRegistration(!0,callback))};this._storageManager.isRefreshNeeded?this._refreshRegistrations(this._storageManager.pushHandle||registration.deviceId,function(error){return error?void finalCallback(error):void firstRegistration(finalCallback)}):firstRegistration(finalCallback)}),RegistrationManager.prototype.deleteRegistrationWithName=Platform.async(function(registrationName,callback){var cachedRegistrationId=this._storageManager.getRegistrationIdWithName(registrationName),self=this;return _.isNullOrEmpty(cachedRegistrationId)?void callback():void this._pushHttpClient.unregister(cachedRegistrationId,function(error){error||self._storageManager.deleteRegistrationWithName(registrationName),callback(error)})}),RegistrationManager.prototype.deleteAllRegistrations=Platform.async(function(pushHandle,callback){var self=this,currentHandle=this._storageManager.pushHandle,deleteRegistrations=function(error,deleteCallback){if(error)return void deleteCallback(error);var registrationIds=self._storageManager.getRegistrationIds(),remaining=registrationIds.length,errors=[];return 0===remaining?(self._storageManager.deleteAllRegistrations(),void deleteCallback()):void registrationIds.map(function(registrationId){self._pushHttpClient.unregister(registrationId,function(error){remaining--,error&&errors.push(error),0>=remaining&&(0===errors.length?(self._storageManager.deleteAllRegistrations(),deleteCallback()):deleteCallback(_.createError("Failed to delete registrations for "+pushHandle)))})})};Validate.notNull(pushHandle,"pushHandle"),this._refreshRegistrations(currentHandle||pushHandle,function(error){_.isNullOrEmpty(currentHandle)||pushHandle===currentHandle?deleteRegistrations(error,callback):deleteRegistrations(error,function(){self._refreshRegistrations(pushHandle,function(error){deleteRegistrations(error,callback)})})})}),RegistrationManager.prototype.listRegistrations=Platform.async(function(pushHandle,callback){Validate.notNullOrEmpty(pushHandle),this._pushHttpClient.listRegistrations(pushHandle,this._platform,callback)}),RegistrationManager.prototype._refreshRegistrations=function(pushHandle,callback){var self=this;Validate.notNull(pushHandle,"pushHandle"),Validate.notNull(callback,"callback"),this._pushHttpClient.listRegistrations(pushHandle,this._platform,function(error,registrations){error||self._storageManager.updateAllRegistrations(registrations,pushHandle),callback(error)})}},$__modules__.LocalStorageManager=function(exports){function LocalStorageManager(storageKey){this._registrations={},this._storageKey="MobileServices.Push."+storageKey,this._isRefreshNeeded=!1,Object.defineProperty(this,"isRefreshNeeded",{get:function(){return this._isRefreshNeeded}}),this._pushHandle=null,Object.defineProperty(this,"pushHandle",{get:function(){return _.isNull(this._pushHandle)?"":this._pushHandle},set:function(value){Validate.notNullOrEmpty(value,"pushHandle"),this._pushHandle!==value&&(this._pushHandle=value,this._flushToSettings())}}),this._initializeRegistrationInfoFromStorage()}var _=require("Extensions"),Validate=require("Validate"),Platform=require("Platform"),Constants={Version:"v1.1.0",Keys:{Version:"Version",PushHandle:"ChannelUri",Registrations:"Registrations",NativeRegistration:"$Default"}};exports.LocalStorageManager=LocalStorageManager,LocalStorageManager.NativeRegistrationName=Constants.Keys.NativeRegistration,LocalStorageManager.prototype.getRegistrationIds=function(){var result=[];for(var name in this._registrations)this._registrations.hasOwnProperty(name)&&result.push(this._registrations[name]);return result},LocalStorageManager.prototype.getRegistrationIdWithName=function(registrationName){return Validate.notNullOrEmpty(registrationName,"registrationName"),this._registrations[registrationName]},LocalStorageManager.prototype.updateAllRegistrations=function(registrations,pushHandle){Validate.notNull(pushHandle,"pushHandle"),registrations||(registrations=[]),this._registrations={};for(var i=0;i<registrations.length;i++){var name=registrations[i].templateName;_.isNullOrEmpty(name)&&(name=Constants.Keys.NativeRegistration),this._registrations[name]=registrations[i].registrationId}this._pushHandle=pushHandle,this._flushToSettings(),this._isRefreshNeeded=!1},LocalStorageManager.prototype.updateRegistrationWithName=function(registrationName,registrationId,pushHandle){Validate.notNullOrEmpty(registrationName,"registrationName"),Validate.notNullOrEmpty(registrationId,"registrationId"),Validate.notNullOrEmpty(pushHandle,"pushHandle"),this._registrations[registrationName]=registrationId,this._pushHandle=pushHandle,this._flushToSettings()},LocalStorageManager.prototype.deleteRegistrationWithName=function(registrationName){Validate.notNullOrEmpty(registrationName,"registrationName"),this._registrations.hasOwnProperty(registrationName)&&(delete this._registrations[registrationName],this._flushToSettings())},LocalStorageManager.prototype.deleteAllRegistrations=function(){this._registrations={},this._flushToSettings()},LocalStorageManager.prototype._flushToSettings=function(){var forStorage={};forStorage[Constants.Keys.Version]=Constants.Version,forStorage[Constants.Keys.PushHandle]=this._pushHandle,forStorage[Constants.Keys.Registrations]=this._registrations,Platform.writeSetting(this._storageKey,JSON.stringify(forStorage))},LocalStorageManager.prototype._initializeRegistrationInfoFromStorage=function(){this._registrations={};try{var data=JSON.parse(Platform.readSetting(this._storageKey));if(this._pushHandle=data[Constants.Keys.PushHandle],!this._pushHandle)return void(this._isRefreshNeeded=!0);var version=data[Constants.Keys.Version]||"";if(this._isRefreshNeeded=Constants.Version!==version.toLowerCase(),this._isRefreshNeeded)return;this._registrations=data[Constants.Keys.Registrations]}catch(err){this._isRefreshNeeded=!0}}},$__modules__.PushHttpClient=function(exports){function PushHttpClient(mobileServicesClient){this.mobileServicesClient=mobileServicesClient}var noCacheHeader=(require("Platform"),{"If-Modified-Since":"Mon, 27 Mar 1972 00:00:00 GMT"});exports.PushHttpClient=PushHttpClient,PushHttpClient.prototype.listRegistrations=function(pushHandle,platform,callback){this.mobileServicesClient._request("GET","/push/registrations?platform="+encodeURIComponent(platform)+"&deviceId="+encodeURIComponent(pushHandle),null,null,noCacheHeader,function(error,request){error?callback(error):callback(null,JSON.parse(request.responseText))})},PushHttpClient.prototype.unregister=function(registrationId,callback){this.mobileServicesClient._request("DELETE","/push/registrations/"+encodeURIComponent(registrationId),null,null,noCacheHeader,function(error){return error&&error.request&&404===error.request.status?void callback():void callback(error)})},PushHttpClient.prototype.createRegistrationId=function(callback){this.mobileServicesClient._request("POST","/push/registrationIds",null,null,noCacheHeader,function(error,request){if(error)return void callback(error);var locationHeader=request.getResponseHeader("Location");callback(null,locationHeader.slice(locationHeader.lastIndexOf("/")+1))})},PushHttpClient.prototype.upsertRegistration=function(registration,callback){this.mobileServicesClient._request("PUT","/push/registrations/"+encodeURIComponent(registration.registrationId),registration,null,noCacheHeader,callback)}},$__modules__.Validate=function(exports){var _=require("Extensions"),Platform=require("Platform");exports.notNull=function(value,name){if(_.isNull(value))throw _.format(Platform.getResourceString("Validate_NotNullError"),name||"Value")},exports.notNullOrEmpty=function(value,name){if(_.isNullOrEmpty(value))throw _.format(Platform.getResourceString("Validate_NotNullOrEmptyError"),name||"Value")},exports.notNullOrZero=function(value,name){if(_.isNullOrZero(value))throw _.format(Platform.getResourceString("Validate_NotNullOrEmptyError"),name||"Value")},exports.isValidId=function(value,name){if(!_.isValidId(value))throw _.format(Platform.getResourceString("Validate_InvalidId"),name||"id")},exports.isDate=function(value,name){if(exports.notNull(value,name),!_.isDate(value))throw _.format(Platform.getResourceString("Validate_TypeCheckError"),name||"Value","Date",typeof value)},exports.isNumber=function(value,name){if(exports.notNull(value,name),!_.isNumber(value))throw _.format(Platform.getResourceString("Validate_TypeCheckError"),name||"Value","Number",typeof value)},exports.isValidParametersObject=function(value,name){exports.notNull(value,name),exports.isObject(value,name);for(var parameter in value)if(0===parameter.indexOf("$"))throw _.format(Platform.getResourceString("Validate_InvalidUserParameter"),name,parameter)},exports.isInteger=function(value,name){if(exports.notNull(value,name),exports.isNumber(value,name),parseInt(value,10)!==parseFloat(value))throw _.format(Platform.getResourceString("Validate_TypeCheckError"),name||"Value","number",typeof value)},exports.isString=function(value,name){if(!_.isString(value))throw _.format(Platform.getResourceString("Validate_TypeCheckError"),name||"Value","string",typeof value)},exports.isObject=function(value,name){if(!_.isObject(value))throw _.format(Platform.getResourceString("Validate_TypeCheckError"),name||"Value","object",typeof value)},exports.isArray=function(value,name){if(!Array.isArray(value))throw _.format(Platform.getResourceString("Validate_TypeCheckError"),name||"Value","array",typeof value)},exports.length=function(value,length,name){if(exports.notNull(value,name),exports.isInteger(length,"length"),value.length!==length)throw _.format(Platform.getResourceString("Validate_LengthUnexpected"),name||"Value",length,value.length)}},$__modules__.JavaScript=function(exports){(function(){var JS,JavaScript,JavaScriptToQueryVisitor,PartialEvaluator,esprima;esprima=require("esprima"),JS=require("./JavaScriptNodes"),PartialEvaluator=require("./PartialEvaluator").PartialEvaluator,JavaScriptToQueryVisitor=require("./JavaScriptToQueryVisitor").JavaScriptToQueryVisitor,exports.JavaScript=JavaScript=function(){function JavaScript(){}return JavaScript.transformConstraint=function(func,env){var context,translator;return context=JavaScript.getExpression(func,env),context.expression=PartialEvaluator.evaluate(context),translator=new JavaScriptToQueryVisitor(context),translator.visit(context.expression)},JavaScript.getProjectedFields=function(){return[]},JavaScript.getExpression=function(func,env){var environment,expr,i,name,names,program,source,_i,_len,_ref,_ref1,_ref10,_ref11,_ref12,_ref13,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;if(source="var _$$_stmt_$$_ = "+func+";",program=esprima.parse(source,{range:!0}),expr="Program"===(null!=program?program.type:void 0)&&1===(null!=program&&null!=(_ref=program.body)?_ref.length:void 0)&&"VariableDeclaration"===(null!=(_ref1=program.body[0])?_ref1.type:void 0)&&1===(null!=(_ref2=program.body[0])&&null!=(_ref3=_ref2.declarations)?_ref3.length:void 0)&&"VariableDeclarator"===(null!=(_ref4=program.body[0].declarations[0])?_ref4.type:void 0)&&"FunctionExpression"===(null!=(_ref5=program.body[0].declarations[0])&&null!=(_ref6=_ref5.init)?_ref6.type:void 0)&&"BlockStatement"===(null!=(_ref7=program.body[0].declarations[0].init)&&null!=(_ref8=_ref7.body)?_ref8.type:void 0)&&1===(null!=(_ref9=program.body[0].declarations[0].init.body)&&null!=(_ref10=_ref9.body)?_ref10.length:void 0)&&"ReturnStatement"===(null!=(_ref11=program.body[0].declarations[0].init.body.body[0])?_ref11.type:void 0)&&(null!=(_ref12=program.body[0].declarations[0].init.body.body[0])?_ref12.argument:void 0),!expr)throw"Expected a predicate with a single return statement, not "+func;if(names=null!=(_ref13=program.body[0].declarations[0].init.params)?_ref13.map(function(p){return p.name}):void 0,names.length>env.length)throw"Expected value(s) for parameter(s) "+names.slice(env.length);if(env.length>names.length)throw"Expected parameter(s) for value(s) "+env.slice(names.length);for(environment={},i=_i=0,_len=names.length;_len>_i;i=++_i)name=names[i],environment[name]=env[i];return{source:source,expression:expr,environment:environment}},JavaScript}()}).call(this)},$__modules__.JavaScriptNodes=function(exports){(function(){var ArrayExpression,ArrayPattern,AssignmentExpression,BinaryExpression,BlockStatement,BreakStatement,CallExpression,CatchClause,ConditionalExpression,ContinueStatement,DebuggerStatement,Declaration,DoWhileStatement,EmptyStatement,Expression,ExpressionStatement,ForInStatement,ForStatement,Function,FunctionDeclaration,FunctionExpression,Identifier,IfStatement,JavaScriptNode,JavaScriptVisitor,LabeledStatement,Literal,LogicalExpression,MemberExpression,NewExpression,Node,ObjectExpression,ObjectPattern,Pattern,Program,ReturnStatement,SequenceExpression,Statement,SwitchCase,SwitchStatement,ThisExpression,ThrowStatement,TryStatement,UnaryExpression,UpdateExpression,VariableDeclaration,VariableDeclarator,Visitor,WhileStatement,WithStatement,_ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);
return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};_ref=require("./Node"),Node=_ref.Node,Visitor=_ref.Visitor,exports.JavaScriptNode=JavaScriptNode=function(_super){function JavaScriptNode(){JavaScriptNode.__super__.constructor.call(this)}return __extends(JavaScriptNode,_super),JavaScriptNode}(Node),exports.JavaScriptVisitor=JavaScriptVisitor=function(_super){function JavaScriptVisitor(){JavaScriptVisitor.__super__.constructor.call(this)}return __extends(JavaScriptVisitor,_super),JavaScriptVisitor.prototype.JavaScriptNode=function(node){return node},JavaScriptVisitor}(Visitor),exports.Program=Program=function(_super){function Program(elements){this.elements=elements,Program.__super__.constructor.call(this)}return __extends(Program,_super),Program}(JavaScriptNode),JavaScriptVisitor.prototype.Program=function(node){return node=this.JavaScriptNode(node),node.elements=this.visit(node.elements),node},exports.Function=Function=function(_super){function Function(id,params,body){this.id=id,this.params=params,this.body=body,Function.__super__.constructor.call(this)}return __extends(Function,_super),Function}(JavaScriptNode),JavaScriptVisitor.prototype.Function=function(node){return node=this.JavaScriptNode(node),node.id=this.visit(node.id),node.params=this.visit(node.params),node.body=this.visit(node.body),node},exports.Statement=Statement=function(_super){function Statement(){Statement.__super__.constructor.call(this)}return __extends(Statement,_super),Statement}(JavaScriptNode),JavaScriptVisitor.prototype.Statement=function(node){return node=this.JavaScriptNode(node)},exports.EmptyStatement=EmptyStatement=function(_super){function EmptyStatement(){EmptyStatement.__super__.constructor.call(this)}return __extends(EmptyStatement,_super),EmptyStatement}(JavaScriptNode),JavaScriptVisitor.prototype.EmptyStatement=function(node){return node=this.JavaScriptNode(node)},exports.BlockStatement=BlockStatement=function(_super){function BlockStatement(body){this.body=body,BlockStatement.__super__.constructor.call(this)}return __extends(BlockStatement,_super),BlockStatement}(Statement),JavaScriptVisitor.prototype.BlockStatement=function(node){return node=this.Statement(node),node.body=this.visit(node.body),node},exports.ExpressionStatement=ExpressionStatement=function(_super){function ExpressionStatement(){ExpressionStatement.__super__.constructor.call(this)}return __extends(ExpressionStatement,_super),ExpressionStatement}(Statement),JavaScriptVisitor.prototype.ExpressionStatement=function(node){return node=this.Statement(node)},exports.IfStatement=IfStatement=function(_super){function IfStatement(test,consequent,alternate){this.test=test,this.consequent=consequent,this.alternate=alternate,IfStatement.__super__.constructor.call(this)}return __extends(IfStatement,_super),IfStatement}(Statement),JavaScriptVisitor.prototype.IfStatement=function(node){return node=this.Statement(node),node.test=this.visit(node.test),node.consequent=this.visit(node.consequent),node.alternate=this.visit(node.alternate),node},exports.LabeledStatement=LabeledStatement=function(_super){function LabeledStatement(label,body){this.label=label,this.body=body,LabeledStatement.__super__.constructor.call(this)}return __extends(LabeledStatement,_super),LabeledStatement}(Statement),JavaScriptVisitor.prototype.LabeledStatement=function(node){return node=this.Statement(node),node.label=this.visit(node.label),node.body=this.visit(node.body),node},exports.BreakStatement=BreakStatement=function(_super){function BreakStatement(label){this.label=label,BreakStatement.__super__.constructor.call(this)}return __extends(BreakStatement,_super),BreakStatement}(Statement),JavaScriptVisitor.prototype.BreakStatement=function(node){return node=this.Statement(node),node.label=this.visit(node.label),node},exports.ContinueStatement=ContinueStatement=function(_super){function ContinueStatement(label){this.label=label,ContinueStatement.__super__.constructor.call(this)}return __extends(ContinueStatement,_super),ContinueStatement}(Statement),JavaScriptVisitor.prototype.ContinueStatement=function(node){return node=this.Statement(node),node.label=this.visit(node.label),node},exports.WithStatement=WithStatement=function(_super){function WithStatement(object,body){this.object=object,this.body=body,WithStatement.__super__.constructor.call(this)}return __extends(WithStatement,_super),WithStatement}(Statement),JavaScriptVisitor.prototype.WithStatement=function(node){return node=this.Statement(node),node.object=this.visit(node.object),node.body=this.visit(node.body),node},exports.SwitchStatement=SwitchStatement=function(_super){function SwitchStatement(discriminant,cases){this.discriminant=discriminant,this.cases=cases,SwitchStatement.__super__.constructor.call(this)}return __extends(SwitchStatement,_super),SwitchStatement}(Statement),JavaScriptVisitor.prototype.SwitchStatement=function(node){return node=this.Statement(node),node.discriminant=this.visit(node.discriminant),node.cases=this.visit(node.cases),node},exports.ReturnStatement=ReturnStatement=function(_super){function ReturnStatement(argument){this.argument=argument,ReturnStatement.__super__.constructor.call(this)}return __extends(ReturnStatement,_super),ReturnStatement}(Statement),JavaScriptVisitor.prototype.ReturnStatement=function(node){return node=this.Statement(node),node.argument=this.visit(node.argument),node},exports.ThrowStatement=ThrowStatement=function(_super){function ThrowStatement(argument){this.argument=argument,ThrowStatement.__super__.constructor.call(this)}return __extends(ThrowStatement,_super),ThrowStatement}(Statement),JavaScriptVisitor.prototype.ThrowStatement=function(node){return node=this.Statement(node),node.argument=this.visit(node.argument),node},exports.TryStatement=TryStatement=function(_super){function TryStatement(block,handlers,finalizer){this.block=block,this.handlers=handlers,this.finalizer=finalizer,TryStatement.__super__.constructor.call(this)}return __extends(TryStatement,_super),TryStatement}(Statement),JavaScriptVisitor.prototype.TryStatement=function(node){return node=this.Statement(node),node.block=this.visit(node.block),node.handlers=this.visit(node.handlers),node.finalizer=this.visit(node.finalizer),node},exports.WhileStatement=WhileStatement=function(_super){function WhileStatement(test,body){this.test=test,this.body=body,WhileStatement.__super__.constructor.call(this)}return __extends(WhileStatement,_super),WhileStatement}(Statement),JavaScriptVisitor.prototype.WhileStatement=function(node){return node=this.Statement(node),node.test=this.visit(node.test),node.body=this.visit(node.body),node},exports.DoWhileStatement=DoWhileStatement=function(_super){function DoWhileStatement(body,test){this.body=body,this.test=test,DoWhileStatement.__super__.constructor.call(this)}return __extends(DoWhileStatement,_super),DoWhileStatement}(Statement),JavaScriptVisitor.prototype.DoWhileStatement=function(node){return node=this.Statement(node),node.body=this.visit(node.body),node.test=this.visit(node.test),node},exports.ForStatement=ForStatement=function(_super){function ForStatement(init,test,update,body){this.init=init,this.test=test,this.update=update,this.body=body,ForStatement.__super__.constructor.call(this)}return __extends(ForStatement,_super),ForStatement}(Statement),JavaScriptVisitor.prototype.ForStatement=function(node){return node=this.Statement(node),node.init=this.visit(node.init),node.test=this.visit(node.test),node.update=this.visit(node.update),node.body=this.visit(node.body),node},exports.ForInStatement=ForInStatement=function(_super){function ForInStatement(left,right,body){this.left=left,this.right=right,this.body=body,ForInStatement.__super__.constructor.call(this)}return __extends(ForInStatement,_super),ForInStatement}(Statement),JavaScriptVisitor.prototype.ForInStatement=function(node){return node=this.Statement(node),node.left=this.visit(node.left),node.right=this.visit(node.right),node.body=this.visit(node.body),node},exports.DebuggerStatement=DebuggerStatement=function(_super){function DebuggerStatement(){DebuggerStatement.__super__.constructor.call(this)}return __extends(DebuggerStatement,_super),DebuggerStatement}(Statement),JavaScriptVisitor.prototype.DebuggerStatement=function(node){return node=this.Statement(node)},exports.Declaration=Declaration=function(_super){function Declaration(){Declaration.__super__.constructor.call(this)}return __extends(Declaration,_super),Declaration}(Statement),JavaScriptVisitor.prototype.Declaration=function(node){return node=this.Statement(node)},exports.FunctionDeclaration=FunctionDeclaration=function(_super){function FunctionDeclaration(id,params,body){this.id=id,this.params=params,this.body=body,FunctionDeclaration.__super__.constructor.call(this)}return __extends(FunctionDeclaration,_super),FunctionDeclaration}(Declaration),JavaScriptVisitor.prototype.FunctionDeclaration=function(node){return node=this.Declaration(node),node.id=this.visit(node.id),node.params=this.visit(node.params),node.body=this.visit(node.body),node},exports.VariableDeclaration=VariableDeclaration=function(_super){function VariableDeclaration(declarations,kind){this.declarations=declarations,this.kind=kind,VariableDeclaration.__super__.constructor.call(this)}return __extends(VariableDeclaration,_super),VariableDeclaration}(Declaration),JavaScriptVisitor.prototype.VariableDeclaration=function(node){return node=this.Declaration(node),node.declarations=this.visit(node.declarations),node},exports.VariableDeclarator=VariableDeclarator=function(_super){function VariableDeclarator(id,init){this.id=id,this.init=init,VariableDeclarator.__super__.constructor.call(this)}return __extends(VariableDeclarator,_super),VariableDeclarator}(JavaScriptNode),JavaScriptVisitor.prototype.VariableDeclarator=function(node){return node=this.JavaScriptNode(node),node.id=this.visit(node.id),node.init=this.visit(node.init),node},exports.Expression=Expression=function(_super){function Expression(){return Expression.__super__.constructor.apply(this,arguments)}return __extends(Expression,_super),Expression.prototype.constuctor=function(){return Expression.__super__.constuctor.call(this)},Expression}(JavaScriptNode),JavaScriptVisitor.prototype.Expression=function(node){return node=this.JavaScriptNode(node)},exports.ThisExpression=ThisExpression=function(_super){function ThisExpression(){ThisExpression.__super__.constructor.call(this)}return __extends(ThisExpression,_super),ThisExpression}(Expression),JavaScriptVisitor.prototype.ThisExpression=function(node){return node=this.Expression(node)},exports.ArrayExpression=ArrayExpression=function(_super){function ArrayExpression(elements){this.elements=elements,ArrayExpression.__super__.constructor.call(this)}return __extends(ArrayExpression,_super),ArrayExpression}(Expression),JavaScriptVisitor.prototype.ArrayExpression=function(node){return node=this.Expression(node),node.elements=this.visit(node.elements),node},exports.ObjectExpression=ObjectExpression=function(_super){function ObjectExpression(properties){this.properties=properties,ObjectExpression.__super__.constructor.call(this)}return __extends(ObjectExpression,_super),ObjectExpression}(Expression),JavaScriptVisitor.prototype.ObjectExpression=function(node){var setter,_i,_len,_ref1;for(node=this.Expression(node),_ref1=node.properties,_i=0,_len=_ref1.length;_len>_i;_i++)setter=_ref1[_i],setter.key=this.visit(setter.key),setter.value=this.visit(setter.value);return node},exports.FunctionExpression=FunctionExpression=function(_super){function FunctionExpression(id,params,body){this.id=id,this.params=params,this.body=body,FunctionExpression.__super__.constructor.call(this)}return __extends(FunctionExpression,_super),FunctionExpression}(Expression),JavaScriptVisitor.prototype.FunctionExpression=function(node){return node=this.Expression(node),node.id=this.visit(node.id),node.params=this.visit(node.params),node.body=this.visit(node.body),node},exports.SequenceExpression=SequenceExpression=function(_super){function SequenceExpression(expressions){this.expressions=expressions,SequenceExpression.__super__.constructor.call(this)}return __extends(SequenceExpression,_super),SequenceExpression}(Expression),JavaScriptVisitor.prototype.SequenceExpression=function(node){return node=this.Expression(node),node.expressions=this.visit(node.expressions),node},exports.UnaryExpression=UnaryExpression=function(_super){function UnaryExpression(operator,prefix,argument){this.operator=operator,this.prefix=prefix,this.argument=argument,UnaryExpression.__super__.constructor.call(this)}return __extends(UnaryExpression,_super),UnaryExpression}(Expression),JavaScriptVisitor.prototype.UnaryExpression=function(node){return node=this.Expression(node),node.argument=this.visit(node.argument),node},exports.BinaryExpression=BinaryExpression=function(_super){function BinaryExpression(operator,left,right){this.operator=operator,this.left=left,this.right=right,BinaryExpression.__super__.constructor.call(this)}return __extends(BinaryExpression,_super),BinaryExpression}(Expression),JavaScriptVisitor.prototype.BinaryExpression=function(node){return node=this.Expression(node),node.left=this.visit(node.left),node.right=this.visit(node.right),node},exports.AssignmentExpression=AssignmentExpression=function(_super){function AssignmentExpression(operator,left,right){this.operator=operator,this.left=left,this.right=right,AssignmentExpression.__super__.constructor.call(this)}return __extends(AssignmentExpression,_super),AssignmentExpression}(Expression),JavaScriptVisitor.prototype.AssignmentExpression=function(node){return node=this.Expression(node),node.left=this.visit(node.left),node.right=this.visit(node.right),node},exports.UpdateExpression=UpdateExpression=function(_super){function UpdateExpression(operator,argument,prefix){this.operator=operator,this.argument=argument,this.prefix=prefix,UpdateExpression.__super__.constructor.call(this)}return __extends(UpdateExpression,_super),UpdateExpression}(Expression),JavaScriptVisitor.prototype.UpdateExpression=function(node){return node=this.Expression(node),node.argument=this.visit(node.argument),node},exports.LogicalExpression=LogicalExpression=function(_super){function LogicalExpression(operator,left,right){this.operator=operator,this.left=left,this.right=right,LogicalExpression.__super__.constructor.call(this)}return __extends(LogicalExpression,_super),LogicalExpression}(Expression),JavaScriptVisitor.prototype.LogicalExpression=function(node){return node=this.Expression(node),node.left=this.visit(node.left),node.right=this.visit(node.right),node},exports.ConditionalExpression=ConditionalExpression=function(_super){function ConditionalExpression(test,alternate,consequent){this.test=test,this.alternate=alternate,this.consequent=consequent,ConditionalExpression.__super__.constructor.call(this)}return __extends(ConditionalExpression,_super),ConditionalExpression}(Expression),JavaScriptVisitor.prototype.ConditionalExpression=function(node){return node=this.Expression(node),node.test=this.visit(node.test),node.alternate=this.visit(node.alternate),node.consequent=this.visit(node.consequent),node},exports.NewExpression=NewExpression=function(_super){function NewExpression(callee,_arguments){this.callee=callee,this.arguments=_arguments,NewExpression.__super__.constructor.call(this)}return __extends(NewExpression,_super),NewExpression}(Expression),JavaScriptVisitor.prototype.NewExpression=function(node){return node=this.Expression(node),node.callee=this.visit(node.callee),node.arguments=this.visit(node.arguments),node},exports.CallExpression=CallExpression=function(_super){function CallExpression(callee,_arguments){this.callee=callee,this.arguments=_arguments,CallExpression.__super__.constructor.call(this)}return __extends(CallExpression,_super),CallExpression}(Expression),JavaScriptVisitor.prototype.CallExpression=function(node){return node=this.Expression(node),node.callee=this.visit(node.callee),node.arguments=this.visit(node.arguments),node},exports.MemberExpression=MemberExpression=function(_super){function MemberExpression(object,property,computed){this.object=object,this.property=property,this.computed=computed,MemberExpression.__super__.constructor.call(this)}return __extends(MemberExpression,_super),MemberExpression}(Expression),JavaScriptVisitor.prototype.MemberExpression=function(node){return node=this.Expression(node),node.object=this.visit(node.object),node.property=this.visit(node.property),node},exports.Pattern=Pattern=function(_super){function Pattern(){Pattern.__super__.constructor.call(this)}return __extends(Pattern,_super),Pattern}(JavaScriptNode),JavaScriptVisitor.prototype.Pattern=function(node){return node=this.JavaScriptNode(node)},exports.ObjectPattern=ObjectPattern=function(_super){function ObjectPattern(properties){this.properties=properties,ObjectPattern.__super__.constructor.call(this)}return __extends(ObjectPattern,_super),ObjectPattern}(Pattern),JavaScriptVisitor.prototype.ObjectPattern=function(node){var setter,_i,_len,_ref1;for(node=this.Pattern(node),_ref1=node.properties,_i=0,_len=_ref1.length;_len>_i;_i++)setter=_ref1[_i],setter.key=this.visit(setter.key),setter.value=this.visit(setter.value);return node},exports.ArrayPattern=ArrayPattern=function(_super){function ArrayPattern(elements){this.elements=elements,ArrayPattern.__super__.constructor.call(this)}return __extends(ArrayPattern,_super),ArrayPattern}(Pattern),JavaScriptVisitor.prototype.ArrayPattern=function(node){return node=this.Pattern(node),node.elements=this.visit(node.elements),node},exports.SwitchCase=SwitchCase=function(_super){function SwitchCase(test,consequent){this.test=test,this.consequent=consequent,SwitchCase.__super__.constructor.call(this)}return __extends(SwitchCase,_super),SwitchCase}(JavaScriptNode),JavaScriptVisitor.prototype.SwitchCase=function(node){return node=this.JavaScriptNode(node),node.test=this.visit(node.test),node.consequent=this.visit(node.consequent),node},exports.CatchClause=CatchClause=function(_super){function CatchClause(param,body){this.param=param,this.body=body,CatchClause.__super__.constructor.call(this)}return __extends(CatchClause,_super),CatchClause}(JavaScriptNode),JavaScriptVisitor.prototype.CatchClause=function(node){return node=this.JavaScriptNode(node),node.param=this.visit(node.param),node.body=this.visit(node.body),node},exports.Identifier=Identifier=function(_super){function Identifier(name){this.name=name,Identifier.__super__.constructor.call(this)}return __extends(Identifier,_super),Identifier}(JavaScriptNode),JavaScriptVisitor.prototype.Identifier=function(node){return node=this.JavaScriptNode(node)},exports.Literal=Literal=function(_super){function Literal(value){this.value=value,Literal.__super__.constructor.call(this)}return __extends(Literal,_super),Literal}(Expression),JavaScriptVisitor.prototype.Literal=function(node){return node=this.Expression(node)}}).call(this)},$__modules__.JavaScriptToQueryVisitor=function(exports){(function(){var JS,JavaScriptToQueryVisitor,Q,_,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};_=require("./Utilities"),JS=require("./JavaScriptNodes"),Q=require("./QueryNodes"),exports.JavaScriptToQueryVisitor=JavaScriptToQueryVisitor=function(_super){function JavaScriptToQueryVisitor(context){this.context=context}return __extends(JavaScriptToQueryVisitor,_super),JavaScriptToQueryVisitor.prototype.getSource=function(node){var _ref,_ref1;return this.context.source.slice(null!=node&&null!=(_ref=node.range)?_ref[0]:void 0,+((null!=node&&null!=(_ref1=node.range)?_ref1[1]:void 0)-1)+1||9e9)},JavaScriptToQueryVisitor.prototype.invalid=function(node){throw"The expression '"+this.getSource(node)+"'' is not supported."},JavaScriptToQueryVisitor.prototype.translateUnary=function(node,mapping){var op,value;return op=mapping[node.operator],op?(value=this.visit(node.argument),new Q.UnaryExpression(op,value)):null},JavaScriptToQueryVisitor.prototype.translateBinary=function(node,mapping){var left,op,right;return op=mapping[node.operator],op?(left=this.visit(node.left),right=this.visit(node.right),new Q.BinaryExpression(op,left,right)):null},JavaScriptToQueryVisitor.prototype.visit=function(node){var visited;return visited=JavaScriptToQueryVisitor.__super__.visit.call(this,node),node===visited&&this.invalid(node),visited},JavaScriptToQueryVisitor.prototype.MemberExpression=function(node){var expr;return expr=function(){var _ref,_ref1,_ref2,_ref3;return"ThisExpression"===(null!=node&&null!=(_ref=node.object)?_ref.type:void 0)&&"Identifier"===(null!=node&&null!=(_ref1=node.property)?_ref1.type:void 0)?new Q.MemberExpression(node.property.name):"MemberExpression"===(null!=node&&null!=(_ref2=node.object)?_ref2.type:void 0)&&"ThisExpression"===(null!=(_ref3=node.object.object)?_ref3.type:void 0)&&"Identifier"===node.property.type&&"length"===node.property.name?new Q.InvocationExpression(Q.Methods.Length,new Q.MemberExpression(node.object.property.name)):void 0}(),null!=expr?expr:JavaScriptToQueryVisitor.__super__.MemberExpression.call(this,node)},JavaScriptToQueryVisitor.prototype.Literal=function(node){return new Q.ConstantExpression(node.value)},JavaScriptToQueryVisitor.prototype.UnaryExpression=function(node){var mapping,_ref;return"+"===node.operator?this.visit(node.argument):(mapping={"!":Q.UnaryOperators.Not,"-":Q.UnaryOperators.Negate},null!=(_ref=this.translateUnary(node,mapping))?_ref:JavaScriptToQueryVisitor.__super__.UnaryExpression.call(this,node))},JavaScriptToQueryVisitor.prototype.UpdateExpression=function(node){var mapping,_ref;return mapping={"++":Q.UnaryOperators.Increment,"--":Q.UnaryOperators.Decrement},null!=(_ref=this.translateUnary(node,mapping))?_ref:JavaScriptToQueryVisitor.__super__.UpdateExpression.call(this,node)},JavaScriptToQueryVisitor.prototype.LogicalExpression=function(node){var mapping,_ref;return mapping={"&&":Q.BinaryOperators.And,"||":Q.BinaryOperators.Or},null!=(_ref=this.translateBinary(node,mapping))?_ref:JavaScriptToQueryVisitor.__super__.LogicalExpression.call(this,node)},JavaScriptToQueryVisitor.prototype.BinaryExpression=function(node){var k,left,mapping,properties,v,value,_ref;return mapping={"+":Q.BinaryOperators.Add,"-":Q.BinaryOperators.Subtract,"*":Q.BinaryOperators.Multiply,"/":Q.BinaryOperators.Divide,"%":Q.BinaryOperators.Modulo,">":Q.BinaryOperators.GreaterThan,">=":Q.BinaryOperators.GreaterThanOrEqual,"<":Q.BinaryOperators.LessThan,"<=":Q.BinaryOperators.LessThanOrEqual,"!=":Q.BinaryOperators.NotEqual,"!==":Q.BinaryOperators.NotEqual,"==":Q.BinaryOperators.Equal,"===":Q.BinaryOperators.Equal},function(){var _ref1,_ref2;return null!=(_ref=this.translateBinary(node,mapping))?_ref:"in"===node.operator&&"Literal"===(null!=(_ref1=node.right)?_ref1.type:void 0)&&_.isArray(null!=(_ref2=node.right)?_ref2.value:void 0)?node.right.value.length>0?(left=this.visit(node.left),Q.QueryExpression.groupClauses(Q.BinaryOperators.Or,function(){var _i,_len,_ref3,_results;for(_ref3=node.right.value,_results=[],_i=0,_len=_ref3.length;_len>_i;_i++){if(value=_ref3[_i],_.isObject(value)){if(properties=function(){var _results1;_results1=[];for(k in value)v=value[k],_results1.push(v);return _results1}(),1!==(null!=properties?properties.length:void 0))throw"in operator requires comparison objects with a single field, not "+value+" ("+JSON.stringify(value)+"), for expression '"+this.getSource(node)+"'";value=properties[0]}_results.push(new Q.BinaryExpression(Q.BinaryOperators.Equal,left,new Q.ConstantExpression(value)))}return _results}.call(this))):new Q.BinaryExpression(Q.BinaryOperators.Equal,new Q.ConstantExpression(!0),new Q.ConstantExpression(!1)):JavaScriptToQueryVisitor.__super__.BinaryExpression.call(this,node)}.call(this)},JavaScriptToQueryVisitor.prototype.CallExpression=function(node){var expr,func,getSingleArg,getTwoArgs,member,method,_ref;return getSingleArg=function(_this){return function(name){var _ref;if(1!==(null!=(_ref=node.arguments)?_ref.length:void 0))throw"Function "+name+" expects one argument in expression '"+_this.getSource(node)+"'";return _this.visit(node.arguments[0])}}(this),getTwoArgs=function(_this){return function(member,name){var _ref;if(2!==(null!=(_ref=node.arguments)?_ref.length:void 0))throw"Function "+name+" expects two arguments in expression '"+_this.getSource(node)+"'";return[member,_this.visit(node.arguments[0]),_this.visit(node.arguments[1])]}}(this),func=null!=node&&null!=(_ref=node.callee)?_ref.value:void 0,expr=function(){var _ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7;if(func===Math.floor)return new Q.InvocationExpression(Q.Methods.Floor,[getSingleArg("floor")]);if(func===Math.ceil)return new Q.InvocationExpression(Q.Methods.Ceiling,[getSingleArg("ceil")]);if(func===Math.round)return new Q.InvocationExpression(Q.Methods.Round,[getSingleArg("round")]);if("MemberExpression"===node.callee.type&&(null!=(_ref1=node.callee.object)?_ref1.__hasThisExp:void 0)===!0){if(member="CallExpression"===(null!=node&&null!=(_ref2=node.callee)&&null!=(_ref3=_ref2.object)?_ref3.type:void 0)?this.visit(node.callee.object):new Q.MemberExpression(null!=(_ref4=node.callee.object)&&null!=(_ref5=_ref4.property)?_ref5.name:void 0),method=null!=(_ref6=node.callee)&&null!=(_ref7=_ref6.property)?_ref7.name:void 0,"toUpperCase"===method)return new Q.InvocationExpression(Q.Methods.ToUpperCase,[member]);if("toLowerCase"===method)return new Q.InvocationExpression(Q.Methods.ToLowerCase,[member]);if("trim"===method)return new Q.InvocationExpression(Q.Methods.Trim,[member]);if("indexOf"===method)return new Q.InvocationExpression(Q.Methods.IndexOf,[member,getSingleArg("indexOf")]);if("concat"===method)return new Q.InvocationExpression(Q.Methods.Concat,[member,getSingleArg("concat")]);if("substring"===method||"substr"===method)return new Q.InvocationExpression(Q.Methods.Substring,getTwoArgs(member,"substring"));if("replace"===method)return new Q.InvocationExpression(Q.Methods.Replace,getTwoArgs(member,"replace"));if("getFullYear"===method||"getUTCFullYear"===method)return new Q.InvocationExpression(Q.Methods.Year,[member]);if("getYear"===method)return new Q.BinaryExpression(Q.BinaryOperators.Subtract,new Q.InvocationExpression(Q.Methods.Year,[member]),new Q.ConstantExpression(1900));if("getMonth"===method||"getUTCMonth"===method)return new Q.BinaryExpression(Q.BinaryOperators.Subtract,new Q.InvocationExpression(Q.Methods.Month,[member]),new Q.ConstantExpression(1));if("getDate"===method||"getUTCDate"===method)return new Q.InvocationExpression(Q.Methods.Day,[member])}}.call(this),null!=expr?expr:JavaScriptToQueryVisitor.__super__.CallExpression.call(this,node)},JavaScriptToQueryVisitor}(JS.JavaScriptVisitor)}).call(this)},$__modules__.Node=function(exports){(function(){var Node,Visitor,_;_=require("./Utilities"),exports.Node=Node=function(){function Node(){this.type=_.functionName(this.constructor)}return Node.prototype.type="Node",Node}(),exports.Visitor=Visitor=function(){function Visitor(){}return Visitor.prototype.visit=function(node){var element,_i,_len,_results;if(_.isArray(node)){for(_results=[],_i=0,_len=node.length;_len>_i;_i++)element=node[_i],_results.push(this.visit(element));return _results}if(null!=node?node.type:void 0){if(_.isFunction(this[node.type]))return this[node.type](node);throw"Unsupported expression "+this.getSource(node)}return node},Visitor.prototype.getSource=function(){return null},Visitor}()}).call(this)},$__modules__.ODataProvider=function(exports){(function(){var ODataFilterQueryVisitor,ODataProvider,Q,Query,_,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};_=require("./Utilities"),Q=require("./QueryNodes"),Query=require("./Query").Query,exports.ODataProvider=ODataProvider=function(){function ODataProvider(){}return ODataProvider.prototype.toQuery=function(query){var odata,s,url;return odata=this.toOData(query,!0),url="/"+odata.table,s="?",odata.filters&&(url+=""+s+"$filter="+odata.filters,s="&"),odata.orderClauses&&(url+=""+s+"$orderby="+odata.orderClauses,s="&"),odata.skip&&(url+=""+s+"$skip="+odata.skip,s="&"),(odata.take||0===odata.take)&&(url+=""+s+"$top="+odata.take,s="&"),odata.selections&&(url+=""+s+"$select="+odata.selections,s="&"),odata.includeTotalCount&&(url+=""+s+"$inlinecount=allpages"),url},ODataProvider.prototype.toOData=function(query,encodeForUri){var asc,components,name,odata,order,orderClauses,ordering,_ref,_ref1;return null==encodeForUri&&(encodeForUri=!1),components=null!=(_ref=null!=query?query.getComponents():void 0)?_ref:{},ordering=function(){var _ref1,_results;_ref1=null!=components?components.ordering:void 0,_results=[];for(name in _ref1)asc=_ref1[name],_results.push(asc?name:""+name+" desc");return _results}(),orderClauses=function(){var _i,_len,_ref1,_results;for(_ref1=null!=components?components.orderClauses:void 0,_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)order=_ref1[_i],_results.push(order.ascending?order.name:""+order.name+" desc");return _results}(),odata={table:null!=components?components.table:void 0,filters:ODataFilterQueryVisitor.convert(components.filters,encodeForUri),ordering:null!=ordering?ordering.toString():void 0,orderClauses:null!=orderClauses?orderClauses.toString():void 0,skip:null!=components?components.skip:void 0,take:null!=components?components.take:void 0,selections:null!=components&&null!=(_ref1=components.selections)?_ref1.toString():void 0,includeTotalCount:null!=components?components.includeTotalCount:void 0}},ODataProvider.prototype.fromOData=function(table,filters,ordering,skip,take,selections,includeTotalCount){var direction,field,item,query,_i,_j,_len,_len1,_ref,_ref1,_ref2,_ref3;for(query=new Query(table),filters&&query.where(filters),(skip||0===skip)&&query.skip(skip),(take||0===take)&&query.take(take),includeTotalCount&&query.includeTotalCount(),_ref1=null!=(_ref=null!=selections?selections.split(","):void 0)?_ref:[],_i=0,_len=_ref1.length;_len>_i;_i++)field=_ref1[_i],query.select(field.trim());for(_ref2=function(){var _k,_len1,_ref2,_ref3,_results;for(_ref3=null!=(_ref2=null!=ordering?ordering.split(","):void 0)?_ref2:[],_results=[],_k=0,_len1=_ref3.length;_len1>_k;_k++)item=_ref3[_k],_results.push(item.trim().split(" "));return _results}(),_j=0,_len1=_ref2.length;_len1>_j;_j++)_ref3=_ref2[_j],field=_ref3[0],direction=_ref3[1],"DESC"!==(null!=direction?direction.toUpperCase():void 0)?query.orderBy(field):query.orderByDescending(field);return query},ODataProvider}(),ODataFilterQueryVisitor=function(_super){function ODataFilterQueryVisitor(encodeForUri){this.encodeForUri=encodeForUri}return __extends(ODataFilterQueryVisitor,_super),ODataFilterQueryVisitor.convert=function(filters,encodeForUri){var visitor,_ref;return visitor=new ODataFilterQueryVisitor(encodeForUri),null!=(_ref=filters?visitor.visit(filters):void 0)?_ref:null},ODataFilterQueryVisitor.prototype.toOData=function(value){var text;if(_.isNumber(value)||_.isBoolean(value))return value.toString();if(_.isString(value))return value=value.replace(/'/g,"''"),null!=this.encodeForUri&&this.encodeForUri===!0&&(value=encodeURIComponent(value)),"'"+value+"'";if(_.isDate(value))return text=JSON.stringify(value),text.length>2&&(text=text.slice(1,+(text.length-2)+1||9e9)),text=text.replace(/(T\d{2}:\d{2}:\d{2})Z$/,function(all,time){var msec;return msec=String(value.getMilliseconds()+1e3).substring(1),""+time+"."+msec+"Z"}),"datetime'"+text+"'";if(value)throw"Unsupported literal value "+value;return"null"},ODataFilterQueryVisitor.prototype.ConstantExpression=function(node){return this.toOData(node.value)
},ODataFilterQueryVisitor.prototype.MemberExpression=function(node){return node.member},ODataFilterQueryVisitor.prototype.UnaryExpression=function(node){if(node.operator===Q.UnaryOperators.Not)return"not "+this.visit(node.operand);if(node.operator===Q.UnaryOperators.Negate)return"(0 sub "+this.visit(node.operand)+")";throw"Unsupported operator "+node.operator},ODataFilterQueryVisitor.prototype.BinaryExpression=function(node){var mapping,op;if(mapping={And:"and",Or:"or",Add:"add",Subtract:"sub",Multiply:"mul",Divide:"div",Modulo:"mod",GreaterThan:"gt",GreaterThanOrEqual:"ge",LessThan:"lt",LessThanOrEqual:"le",NotEqual:"ne",Equal:"eq"},op=mapping[node.operator])return"("+this.visit(node.left)+" "+op+" "+this.visit(node.right)+")";throw"Unsupported operator "+node.operator},ODataFilterQueryVisitor.prototype.InvocationExpression=function(node){var mapping,method;if(mapping={Length:"length",ToUpperCase:"toupper",ToLowerCase:"tolower",Trim:"trim",IndexOf:"indexof",Replace:"replace",Substring:"substring",Concat:"concat",Day:"day",Month:"month",Year:"year",Floor:"floor",Ceiling:"ceiling",Round:"round"},method=mapping[node.method])return""+method+"("+this.visit(node.args)+")";throw"Invocation of unsupported method "+node.method},ODataFilterQueryVisitor.prototype.LiteralExpression=function(node){var ch,inString,literal,parenBalance,_i,_len,_ref;for(literal="",parenBalance=0,inString=!1,_ref=node.queryString,_i=0,_len=_ref.length;_len>_i&&(ch=_ref[_i],!(0>parenBalance));_i++)if(inString)literal+=ch,inString="'"!==ch;else if("?"===ch){if(!node.args||node.args.length<=0)throw"Too few arguments for "+node.queryString+".";literal+=this.toOData(node.args.shift())}else"'"===ch?(literal+=ch,inString=!0):"("===ch?(parenBalance+=1,literal+=ch):")"===ch?(parenBalance-=1,literal+=ch):literal+=ch;if(node.args&&node.args.length>0)throw"Too many arguments for "+node.queryString;if(0!==parenBalance)throw"Unbalanced parentheses in "+node.queryString;return literal.trim().length>0?"("+literal+")":literal},ODataFilterQueryVisitor}(Q.QueryExpressionVisitor)}).call(this)},$__modules__.PartialEvaluator=function(exports){(function(){var IndependenceNominator,JS,PartialEvaluator,_,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};_=require("./Utilities"),JS=require("./JavaScriptNodes"),exports.PartialEvaluator=PartialEvaluator=function(_super){function PartialEvaluator(context){this.context=context}return __extends(PartialEvaluator,_super),PartialEvaluator.prototype.visit=function(node){var key,params,source,thunk,value,values,_ref,_ref1,_ref2,_ref3;return node.__independent&&"Literal"!==node.type&&node.type?"Identifier"===node.type&&this.context.environment[node.name]?new JS.Literal(this.context.environment[node.name]):(source=this.context.source.slice(null!=node&&null!=(_ref=node.range)?_ref[0]:void 0,+((null!=node&&null!=(_ref1=node.range)?_ref1[1]:void 0)-1)+1||9e9),params=null!=(_ref2=function(){var _ref3,_results;_ref3=this.context.environment,_results=[];for(key in _ref3)value=_ref3[key],_results.push(key);return _results}.call(this))?_ref2:[],values=null!=(_ref3=function(){var _ref4,_results;_ref4=this.context.environment,_results=[];for(key in _ref4)value=_ref4[key],_results.push(JSON.stringify(value));return _results}.call(this))?_ref3:[],thunk="(function("+params+") { return "+source+"; })("+values+")",value=eval(thunk),new JS.Literal(value)):PartialEvaluator.__super__.visit.call(this,node)},PartialEvaluator.evaluate=function(context){var evaluator,nominator;return nominator=new IndependenceNominator(context),nominator.visit(context.expression),evaluator=new PartialEvaluator(context),evaluator.visit(context.expression)},PartialEvaluator}(JS.JavaScriptVisitor),exports.IndependenceNominator=IndependenceNominator=function(_super){function IndependenceNominator(context){this.context=context}return __extends(IndependenceNominator,_super),IndependenceNominator.prototype.Literal=function(node){return IndependenceNominator.__super__.Literal.call(this,node),node.__independent=!0,node.__hasThisExp=!1,node},IndependenceNominator.prototype.ThisExpression=function(node){return IndependenceNominator.__super__.ThisExpression.call(this,node),node.__independent=!1,node.__hasThisExp=!0,node},IndependenceNominator.prototype.Identifier=function(node){return IndependenceNominator.__super__.Identifier.call(this,node),node.__independent=!0,node.__hasThisExp=!1,node},IndependenceNominator.prototype.MemberExpression=function(node){var _ref;return IndependenceNominator.__super__.MemberExpression.call(this,node),node.__hasThisExp=null!=(_ref=node.object)?_ref.__hasThisExp:void 0,node.__hasThisExp&&(node.__independent=!1,null!=node&&(node.property.__independent=!1)),node},IndependenceNominator.prototype.CallExpression=function(node){return IndependenceNominator.__super__.CallExpression.call(this,node),node.__hasThisExp=node.callee.__hasThisExp,node},IndependenceNominator.prototype.ObjectExpression=function(node){var independence,setter,_i,_j,_len,_len1,_ref,_ref1;for(IndependenceNominator.__super__.ObjectExpression.call(this,node),_ref=node.properties,_i=0,_len=_ref.length;_len>_i;_i++)setter=_ref[_i],setter.key.__independent=!1;for(independence=!0,_ref1=node.properties,_j=0,_len1=_ref1.length;_len1>_j;_j++)setter=_ref1[_j],independence&=setter.value.__independent;return node.__independent=independence?!0:!1,node},IndependenceNominator.prototype.visit=function(node){var independence,isIndependent,name,v,value,_i,_len;if(IndependenceNominator.__super__.visit.call(this,node),!Object.prototype.hasOwnProperty.call(node,"__independent")){independence=!0,isIndependent=function(node){var _ref;return _.isObject(node)?null!=(_ref=value.__independent)?_ref:!1:!0};for(name in node)if(value=node[name],_.isArray(value))for(_i=0,_len=value.length;_len>_i;_i++)v=value[_i],independence&=isIndependent(v);else _.isObject(value)&&(independence&=isIndependent(value));node.__independent=independence?!0:!1}return node},IndependenceNominator}(JS.JavaScriptVisitor)}).call(this)},$__modules__.Query=function(exports){(function(){var JavaScript,ODataProvider,Q,Query,_,__slice=[].slice;_=require("./Utilities"),Q=require("./QueryNodes"),JavaScript=require("./JavaScript").JavaScript,exports.Query=Query=function(){function Query(table,context){var _context,_filters,_includeTotalCount,_orderClauses,_ordering,_projection,_selections,_skip,_table,_take,_version;if(!table||!_.isString(table))throw"Expected the name of a table!";_table=table,_context=context,_filters=null,_projection=null,_selections=[],_ordering={},_orderClauses=[],_skip=null,_take=null,_includeTotalCount=!1,_version=0,this.getComponents=function(){return{filters:_filters,selections:_selections,projection:_projection,ordering:_ordering,orderClauses:_orderClauses,skip:_skip,take:_take,table:_table,context:_context,includeTotalCount:_includeTotalCount,version:_version}},this.setComponents=function(components){var ascending,name,property,_i,_len,_ref,_ref1,_ref10,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;if(_version++,_filters=null!=(_ref=null!=components?components.filters:void 0)?_ref:null,_selections=null!=(_ref1=null!=components?components.selections:void 0)?_ref1:[],_projection=null!=(_ref2=null!=components?components.projection:void 0)?_ref2:null,_skip=null!=(_ref3=null!=components?components.skip:void 0)?_ref3:null,_take=null!=(_ref4=null!=components?components.take:void 0)?_ref4:null,_includeTotalCount=null!=(_ref5=null!=components?components.includeTotalCount:void 0)?_ref5:!1,_table=null!=(_ref6=null!=components?components.table:void 0)?_ref6:null,_context=null!=(_ref7=null!=components?components.context:void 0)?_ref7:null,null!=components?components.orderClauses:void 0)for(_orderClauses=null!=(_ref8=null!=components?components.orderClauses:void 0)?_ref8:[],_ordering={},_i=0,_len=_orderClauses.length;_len>_i;_i++)_ref9=_orderClauses[_i],name=_ref9.name,ascending=_ref9.ascending,_ordering[name]=ascending;else{_ordering=null!=(_ref10=null!=components?components.ordering:void 0)?_ref10:{},_orderClauses=[];for(property in _ordering)_orderClauses.push({name:property,ascending:!!_ordering[property]})}return this},this.where=function(){var args,constraint,expr,name,value;return constraint=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],_version++,expr=function(){if(_.isFunction(constraint))return JavaScript.transformConstraint(constraint,args);if(_.isObject(constraint))return Q.QueryExpression.groupClauses(Q.BinaryOperators.And,function(){var _results;_results=[];for(name in constraint)value=constraint[name],_results.push(expr=new Q.BinaryExpression(Q.BinaryOperators.Equal,new Q.MemberExpression(name),new Q.ConstantExpression(value)));return _results}());if(_.isString(constraint))return new Q.LiteralExpression(constraint,args);throw"Expected a function, object, or string, not "+constraint}(),_filters=Q.QueryExpression.groupClauses(Q.BinaryOperators.And,[_filters,expr]),this},this.select=function(){var param,parameters,projectionOrParameter,_i,_len;if(projectionOrParameter=arguments[0],parameters=2<=arguments.length?__slice.call(arguments,1):[],_version++,_.isString(projectionOrParameter))for(_selections.push(projectionOrParameter),_i=0,_len=parameters.length;_len>_i;_i++){if(param=parameters[_i],!_.isString(param))throw"Expected string parameters, not "+param;_selections.push(param)}else{if(!_.isFunction(projectionOrParameter))throw"Expected a string or a function, not "+projectionOrParameter;_projection=projectionOrParameter,_selections=JavaScript.getProjectedFields(_projection)}return this},this.orderBy=function(){var order,param,parameters,replacement,_i,_j,_len,_len1;for(parameters=1<=arguments.length?__slice.call(arguments,0):[],_version++,_i=0,_len=parameters.length;_len>_i;_i++){if(param=parameters[_i],!_.isString(param))throw"Expected string parameters, not "+param;for(_ordering[param]=!0,replacement=!1,_j=0,_len1=_orderClauses.length;_len1>_j;_j++)order=_orderClauses[_j],order.name===param&&(replacement=!0,order.ascending=!0);replacement||_orderClauses.push({name:param,ascending:!0})}return this},this.orderByDescending=function(){var order,param,parameters,replacement,_i,_j,_len,_len1;for(parameters=1<=arguments.length?__slice.call(arguments,0):[],_version++,_i=0,_len=parameters.length;_len>_i;_i++){if(param=parameters[_i],!_.isString(param))throw"Expected string parameters, not "+param;for(_ordering[param]=!1,replacement=!1,_j=0,_len1=_orderClauses.length;_len1>_j;_j++)order=_orderClauses[_j],order.name===param&&(replacement=!0,order.ascending=!1);replacement||_orderClauses.push({name:param,ascending:!1})}return this},this.skip=function(count){if(_version++,!_.isNumber(count))throw"Expected a number, not "+count;return _skip=count,this},this.take=function(count){if(_version++,!_.isNumber(count))throw"Expected a number, not "+count;return _take=count,this},this.includeTotalCount=function(){return _version++,_includeTotalCount=!0,this}}return Query.registerProvider=function(name,provider){return Query.Providers[name]=provider,Query.prototype["to"+name]=function(){return null!=provider&&"function"==typeof provider.toQuery?provider.toQuery(this):void 0}},Query.Providers={},Query.Expressions=Q,Query}(),ODataProvider=require("./ODataProvider").ODataProvider,Query.registerProvider("OData",new ODataProvider)}).call(this)},$__modules__.QueryNodes=function(exports){(function(){var BinaryExpression,ConstantExpression,InvocationExpression,LiteralExpression,MemberExpression,Node,QueryExpression,QueryExpressionVisitor,UnaryExpression,Visitor,_ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};_ref=require("./Node"),Node=_ref.Node,Visitor=_ref.Visitor,exports.QueryExpression=QueryExpression=function(_super){function QueryExpression(){QueryExpression.__super__.constructor.call(this)}return __extends(QueryExpression,_super),QueryExpression.groupClauses=function(operator,clauses){var combine;return combine=function(left,right){return left?right?new BinaryExpression(operator,left,right):left:right},clauses.reduce(combine,null)},QueryExpression}(Node),exports.QueryExpressionVisitor=QueryExpressionVisitor=function(_super){function QueryExpressionVisitor(){QueryExpressionVisitor.__super__.constructor.call(this)}return __extends(QueryExpressionVisitor,_super),QueryExpressionVisitor.prototype.QueryExpression=function(node){return node},QueryExpressionVisitor}(Visitor),exports.ConstantExpression=ConstantExpression=function(_super){function ConstantExpression(value){this.value=value,ConstantExpression.__super__.constructor.call(this)}return __extends(ConstantExpression,_super),ConstantExpression}(QueryExpression),QueryExpressionVisitor.prototype.ConstantExpression=function(node){return this.QueryExpression(node)},exports.MemberExpression=MemberExpression=function(_super){function MemberExpression(member){this.member=member,MemberExpression.__super__.constructor.call(this)}return __extends(MemberExpression,_super),MemberExpression}(QueryExpression),QueryExpressionVisitor.prototype.MemberExpression=function(node){return this.QueryExpression(node)},exports.BinaryExpression=BinaryExpression=function(_super){function BinaryExpression(operator,left,right){this.operator=operator,this.left=left,this.right=right,BinaryExpression.__super__.constructor.call(this)}return __extends(BinaryExpression,_super),BinaryExpression}(QueryExpression),QueryExpressionVisitor.prototype.BinaryExpression=function(node){return node=this.QueryExpression(node),node.left=this.visit(node.left),node.right=this.visit(node.right),node},exports.BinaryOperators={And:"And",Or:"Or",Add:"Add",Subtract:"Subtract",Multiply:"Multiply",Divide:"Divide",Modulo:"Modulo",GreaterThan:"GreaterThan",GreaterThanOrEqual:"GreaterThanOrEqual",LessThan:"LessThan",LessThanOrEqual:"LessThanOrEqual",NotEqual:"NotEqual",Equal:"Equal"},exports.UnaryExpression=UnaryExpression=function(_super){function UnaryExpression(operator,operand){this.operator=operator,this.operand=operand,UnaryExpression.__super__.constructor.call(this)}return __extends(UnaryExpression,_super),UnaryExpression}(QueryExpression),QueryExpressionVisitor.prototype.UnaryExpression=function(node){return node=this.QueryExpression(node),node.operand=this.visit(node.operand),node},exports.UnaryOperators={Not:"Not",Negate:"Negate",Increment:"Increment",Decrement:"Decrement"},exports.InvocationExpression=InvocationExpression=function(_super){function InvocationExpression(method,args){this.method=method,this.args=args,InvocationExpression.__super__.constructor.call(this)}return __extends(InvocationExpression,_super),InvocationExpression}(QueryExpression),QueryExpressionVisitor.prototype.InvocationExpression=function(node){return node=this.QueryExpression(node),node.args=this.visit(node.args),node},exports.Methods={Length:"Length",ToUpperCase:"ToUpperCase",ToLowerCase:"ToLowerCase",Trim:"Trim",IndexOf:"IndexOf",Replace:"Replace",Substring:"Substring",Concat:"Concat",Day:"Day",Month:"Month",Year:"Year",Floor:"Floor",Ceiling:"Ceiling",Round:"Round"},exports.LiteralExpression=LiteralExpression=function(_super){function LiteralExpression(queryString,args){this.queryString=queryString,this.args=null!=args?args:[],LiteralExpression.__super__.constructor.call(this)}return __extends(LiteralExpression,_super),LiteralExpression}(QueryExpression),QueryExpressionVisitor.prototype.LiteralExpression=function(node){return this.QueryExpression(node)}}).call(this)},$__modules__.Utilities=function(exports){(function(){var classOf,__slice=[].slice;classOf=function(obj){return Object.prototype.toString.call(obj).slice(8,-1).toLowerCase()},null==Array.prototype.reduce&&(Array.prototype.reduce=function(){var accumulator,array,arrayLength,currentIndex,currentValue,moreArgs;if(accumulator=arguments[0],moreArgs=2<=arguments.length?__slice.call(arguments,1):[],array=this,arrayLength=array.length,currentIndex=0,currentValue=void 0,null==array)throw new TypeError("Object is null or undefined");if("function"!=typeof accumulator)throw new TypeError("First argument is not callable");if(0===moreArgs.length){if(0===arrayLength)throw new TypeError("Array length is 0 and no second argument");currentValue=array[0],currentIndex=1}else currentValue=moreArgs[0];for(;arrayLength>currentIndex;)currentIndex in array&&(currentValue=accumulator.call(void 0,currentValue,array[currentIndex],array)),++currentIndex;return currentValue}),null==Array.prototype.map&&(Array.prototype.map=function(callback,thisArg){var elem,index,inputArray,len,outputArray,_i,_len;if("undefined"==typeof this||null===this)throw new TypeError("this is null or not defined");if("function"!=typeof callback)throw new TypeError(callback+" is not a function");for(thisArg=thisArg?thisArg:void 0,inputArray=Object(this),len=inputArray.length>>>0,outputArray=new Array(len),index=_i=0,_len=inputArray.length;_len>_i;index=++_i)elem=inputArray[index],index in inputArray&&(outputArray[index]=callback.call(thisArg,elem,index,inputArray));return outputArray}),null==Array.isArray&&(Array.isArray=function(vArg){return"[object Array]"===Object.prototype.toString.call(vArg)}),exports.isObject=function(obj){return"object"===Object.prototype.toString.call(obj).slice(8,-1).toLowerCase()},exports.isString=function(obj){return"string"==typeof obj},exports.isFunction=function(obj){return"function"==typeof obj},exports.isArray=Array.isArray,exports.isNumber=function(obj){return"number"==typeof obj},exports.isBoolean=function(obj){return"boolean"==typeof obj},exports.isDate=function(obj){return"date"===classOf(obj)},exports.functionName=function(fn){var index,prefix,source;return"function"==typeof Function.prototype.name?Function.prototype.name.call(fn):(source=fn.toString(),prefix="function ",source.slice(0,+(prefix.length-1)+1||9e9)===prefix&&(index=source.indexOf("(",prefix.length),index>prefix.length)?source.slice(prefix.length,+(index-1)+1||9e9):null)}}).call(this)},$__modules__.esprima=function(exports){!function(root,factory){"use strict";"function"==typeof define&&define.amd?define(["exports"],factory):factory("undefined"!=typeof exports?exports:root.esprima={})}(this,function(exports){"use strict";function assert(condition,message){if(!condition)throw new Error("ASSERT: "+message)}function isDecimalDigit(ch){return ch>=48&&57>=ch}function isHexDigit(ch){return"0123456789abcdefABCDEF".indexOf(ch)>=0}function isOctalDigit(ch){return"01234567".indexOf(ch)>=0}function isWhiteSpace(ch){return 32===ch||9===ch||11===ch||12===ch||160===ch||ch>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(ch)>=0}function isLineTerminator(ch){return 10===ch||13===ch||8232===ch||8233===ch}function isIdentifierStart(ch){return 36===ch||95===ch||ch>=65&&90>=ch||ch>=97&&122>=ch||92===ch||ch>=128&&Regex.NonAsciiIdentifierStart.test(String.fromCharCode(ch))}function isIdentifierPart(ch){return 36===ch||95===ch||ch>=65&&90>=ch||ch>=97&&122>=ch||ch>=48&&57>=ch||92===ch||ch>=128&&Regex.NonAsciiIdentifierPart.test(String.fromCharCode(ch))}function isFutureReservedWord(id){switch(id){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}function isStrictModeReservedWord(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function isRestrictedWord(id){return"eval"===id||"arguments"===id}function isKeyword(id){if(strict&&isStrictModeReservedWord(id))return!0;switch(id.length){case 2:return"if"===id||"in"===id||"do"===id;case 3:return"var"===id||"for"===id||"new"===id||"try"===id||"let"===id;case 4:return"this"===id||"else"===id||"case"===id||"void"===id||"with"===id||"enum"===id;case 5:return"while"===id||"break"===id||"catch"===id||"throw"===id||"const"===id||"yield"===id||"class"===id||"super"===id;case 6:return"return"===id||"typeof"===id||"delete"===id||"switch"===id||"export"===id||"import"===id;case 7:return"default"===id||"finally"===id||"extends"===id;case 8:return"function"===id||"continue"===id||"debugger"===id;case 10:return"instanceof"===id;default:return!1}}function addComment(type,value,start,end,loc){var comment;assert("number"==typeof start,"Comment must have valid position"),state.lastCommentStart>=start||(state.lastCommentStart=start,comment={type:type,value:value},extra.range&&(comment.range=[start,end]),extra.loc&&(comment.loc=loc),extra.comments.push(comment),extra.attachComment&&(extra.leadingComments.push(comment),extra.trailingComments.push(comment)))}function skipSingleLineComment(offset){var start,loc,ch,comment;for(start=index-offset,loc={start:{line:lineNumber,column:index-lineStart-offset}};length>index;)if(ch=source.charCodeAt(index),++index,isLineTerminator(ch))return extra.comments&&(comment=source.slice(start+offset,index-1),loc.end={line:lineNumber,column:index-lineStart-1},addComment("Line",comment,start,index-1,loc)),13===ch&&10===source.charCodeAt(index)&&++index,++lineNumber,void(lineStart=index);extra.comments&&(comment=source.slice(start+offset,index),loc.end={line:lineNumber,column:index-lineStart},addComment("Line",comment,start,index,loc))}function skipMultiLineComment(){var start,loc,ch,comment;for(extra.comments&&(start=index-2,loc={start:{line:lineNumber,column:index-lineStart-2}});length>index;)if(ch=source.charCodeAt(index),isLineTerminator(ch))13===ch&&10===source.charCodeAt(index+1)&&++index,++lineNumber,++index,lineStart=index,index>=length&&throwError({},Messages.UnexpectedToken,"ILLEGAL");else if(42===ch){if(47===source.charCodeAt(index+1))return++index,++index,void(extra.comments&&(comment=source.slice(start+2,index-2),loc.end={line:lineNumber,column:index-lineStart},addComment("Block",comment,start,index,loc)));++index}else++index;throwError({},Messages.UnexpectedToken,"ILLEGAL")}function skipComment(){var ch,start;for(start=0===index;length>index;)if(ch=source.charCodeAt(index),isWhiteSpace(ch))++index;else if(isLineTerminator(ch))++index,13===ch&&10===source.charCodeAt(index)&&++index,++lineNumber,lineStart=index,start=!0;else if(47===ch)if(ch=source.charCodeAt(index+1),47===ch)++index,++index,skipSingleLineComment(2),start=!0;else{if(42!==ch)break;++index,++index,skipMultiLineComment()}else if(start&&45===ch){if(45!==source.charCodeAt(index+1)||62!==source.charCodeAt(index+2))break;index+=3,skipSingleLineComment(3)}else{if(60!==ch)break;if("!--"!==source.slice(index+1,index+4))break;++index,++index,++index,++index,skipSingleLineComment(4)}}function scanHexEscape(prefix){var i,len,ch,code=0;for(len="u"===prefix?4:2,i=0;len>i;++i){if(!(length>index&&isHexDigit(source[index])))return"";ch=source[index++],code=16*code+"0123456789abcdef".indexOf(ch.toLowerCase())}return String.fromCharCode(code)}function scanUnicodeCodePointEscape(){var ch,code,cu1,cu2;for(ch=source[index],code=0,"}"===ch&&throwError({},Messages.UnexpectedToken,"ILLEGAL");length>index&&(ch=source[index++],isHexDigit(ch));)code=16*code+"0123456789abcdef".indexOf(ch.toLowerCase());return(code>1114111||"}"!==ch)&&throwError({},Messages.UnexpectedToken,"ILLEGAL"),65535>=code?String.fromCharCode(code):(cu1=(code-65536>>10)+55296,cu2=(code-65536&1023)+56320,String.fromCharCode(cu1,cu2))}function getEscapedIdentifier(){var ch,id;for(ch=source.charCodeAt(index++),id=String.fromCharCode(ch),92===ch&&(117!==source.charCodeAt(index)&&throwError({},Messages.UnexpectedToken,"ILLEGAL"),++index,ch=scanHexEscape("u"),ch&&"\\"!==ch&&isIdentifierStart(ch.charCodeAt(0))||throwError({},Messages.UnexpectedToken,"ILLEGAL"),id=ch);length>index&&(ch=source.charCodeAt(index),isIdentifierPart(ch));)++index,id+=String.fromCharCode(ch),92===ch&&(id=id.substr(0,id.length-1),117!==source.charCodeAt(index)&&throwError({},Messages.UnexpectedToken,"ILLEGAL"),++index,ch=scanHexEscape("u"),ch&&"\\"!==ch&&isIdentifierPart(ch.charCodeAt(0))||throwError({},Messages.UnexpectedToken,"ILLEGAL"),id+=ch);return id}function getIdentifier(){var start,ch;for(start=index++;length>index;){if(ch=source.charCodeAt(index),92===ch)return index=start,getEscapedIdentifier();if(!isIdentifierPart(ch))break;++index}return source.slice(start,index)}function scanIdentifier(){var start,id,type;return start=index,id=92===source.charCodeAt(index)?getEscapedIdentifier():getIdentifier(),type=1===id.length?Token.Identifier:isKeyword(id)?Token.Keyword:"null"===id?Token.NullLiteral:"true"===id||"false"===id?Token.BooleanLiteral:Token.Identifier,{type:type,value:id,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanPunctuator(){var code2,ch2,ch3,ch4,start=index,code=source.charCodeAt(index),ch1=source[index];switch(code){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++index,extra.tokenize&&(40===code?extra.openParenToken=extra.tokens.length:123===code&&(extra.openCurlyToken=extra.tokens.length)),{type:Token.Punctuator,value:String.fromCharCode(code),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index};default:if(code2=source.charCodeAt(index+1),61===code2)switch(code){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return index+=2,{type:Token.Punctuator,value:String.fromCharCode(code)+String.fromCharCode(code2),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index};case 33:case 61:return index+=2,61===source.charCodeAt(index)&&++index,{type:Token.Punctuator,value:source.slice(start,index),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}}return ch4=source.substr(index,4),">>>="===ch4?(index+=4,{type:Token.Punctuator,value:ch4,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}):(ch3=ch4.substr(0,3),">>>"===ch3||"<<="===ch3||">>="===ch3?(index+=3,{type:Token.Punctuator,value:ch3,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}):(ch2=ch3.substr(0,2),ch1===ch2[1]&&"+-<>&|".indexOf(ch1)>=0||"=>"===ch2?(index+=2,{type:Token.Punctuator,value:ch2,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}):"<>=!+-*%&|^/".indexOf(ch1)>=0?(++index,{type:Token.Punctuator,value:ch1,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}):void throwError({},Messages.UnexpectedToken,"ILLEGAL")))}function scanHexLiteral(start){for(var number="";length>index&&isHexDigit(source[index]);)number+=source[index++];return 0===number.length&&throwError({},Messages.UnexpectedToken,"ILLEGAL"),isIdentifierStart(source.charCodeAt(index))&&throwError({},Messages.UnexpectedToken,"ILLEGAL"),{type:Token.NumericLiteral,value:parseInt("0x"+number,16),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanOctalLiteral(start){for(var number="0"+source[index++];length>index&&isOctalDigit(source[index]);)number+=source[index++];return(isIdentifierStart(source.charCodeAt(index))||isDecimalDigit(source.charCodeAt(index)))&&throwError({},Messages.UnexpectedToken,"ILLEGAL"),{type:Token.NumericLiteral,value:parseInt(number,8),octal:!0,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanNumericLiteral(){var number,start,ch;if(ch=source[index],assert(isDecimalDigit(ch.charCodeAt(0))||"."===ch,"Numeric literal must start with a decimal digit or a decimal point"),start=index,number="","."!==ch){if(number=source[index++],ch=source[index],"0"===number){if("x"===ch||"X"===ch)return++index,scanHexLiteral(start);if(isOctalDigit(ch))return scanOctalLiteral(start);ch&&isDecimalDigit(ch.charCodeAt(0))&&throwError({},Messages.UnexpectedToken,"ILLEGAL")}for(;isDecimalDigit(source.charCodeAt(index));)number+=source[index++];ch=source[index]}if("."===ch){for(number+=source[index++];isDecimalDigit(source.charCodeAt(index));)number+=source[index++];ch=source[index]}if("e"===ch||"E"===ch)if(number+=source[index++],ch=source[index],("+"===ch||"-"===ch)&&(number+=source[index++]),isDecimalDigit(source.charCodeAt(index)))for(;isDecimalDigit(source.charCodeAt(index));)number+=source[index++];else throwError({},Messages.UnexpectedToken,"ILLEGAL");return isIdentifierStart(source.charCodeAt(index))&&throwError({},Messages.UnexpectedToken,"ILLEGAL"),{type:Token.NumericLiteral,value:parseFloat(number),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanStringLiteral(){var quote,start,ch,code,unescaped,restore,startLineNumber,startLineStart,str="",octal=!1;for(startLineNumber=lineNumber,startLineStart=lineStart,quote=source[index],assert("'"===quote||'"'===quote,"String literal must starts with a quote"),start=index,++index;length>index;){if(ch=source[index++],ch===quote){quote="";break}if("\\"===ch)if(ch=source[index++],ch&&isLineTerminator(ch.charCodeAt(0)))++lineNumber,"\r"===ch&&"\n"===source[index]&&++index,lineStart=index;else switch(ch){case"u":case"x":"{"===source[index]?(++index,str+=scanUnicodeCodePointEscape()):(restore=index,unescaped=scanHexEscape(ch),unescaped?str+=unescaped:(index=restore,str+=ch));break;case"n":str+="\n";break;case"r":str+="\r";break;case"t":str+="	";break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="";break;default:isOctalDigit(ch)?(code="01234567".indexOf(ch),0!==code&&(octal=!0),length>index&&isOctalDigit(source[index])&&(octal=!0,code=8*code+"01234567".indexOf(source[index++]),"0123".indexOf(ch)>=0&&length>index&&isOctalDigit(source[index])&&(code=8*code+"01234567".indexOf(source[index++]))),str+=String.fromCharCode(code)):str+=ch}else{if(isLineTerminator(ch.charCodeAt(0)))break;str+=ch}}return""!==quote&&throwError({},Messages.UnexpectedToken,"ILLEGAL"),{type:Token.StringLiteral,value:str,octal:octal,startLineNumber:startLineNumber,startLineStart:startLineStart,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function testRegExp(pattern,flags){var value;try{value=new RegExp(pattern,flags)}catch(e){throwError({},Messages.InvalidRegExp)}return value}function scanRegExpBody(){var ch,str,classMarker,terminated,body;for(ch=source[index],assert("/"===ch,"Regular expression literal must start with a slash"),str=source[index++],classMarker=!1,terminated=!1;length>index;)if(ch=source[index++],str+=ch,"\\"===ch)ch=source[index++],isLineTerminator(ch.charCodeAt(0))&&throwError({},Messages.UnterminatedRegExp),str+=ch;else if(isLineTerminator(ch.charCodeAt(0)))throwError({},Messages.UnterminatedRegExp);else if(classMarker)"]"===ch&&(classMarker=!1);else{if("/"===ch){terminated=!0;break}"["===ch&&(classMarker=!0)}return terminated||throwError({},Messages.UnterminatedRegExp),body=str.substr(1,str.length-2),{value:body,literal:str}}function scanRegExpFlags(){var ch,str,flags,restore;for(str="",flags="";length>index&&(ch=source[index],isIdentifierPart(ch.charCodeAt(0)));)if(++index,"\\"===ch&&length>index)if(ch=source[index],"u"===ch){if(++index,restore=index,ch=scanHexEscape("u"))for(flags+=ch,str+="\\u";index>restore;++restore)str+=source[restore];else index=restore,flags+="u",str+="\\u";throwErrorTolerant({},Messages.UnexpectedToken,"ILLEGAL")}else str+="\\",throwErrorTolerant({},Messages.UnexpectedToken,"ILLEGAL");else flags+=ch,str+=ch;return{value:flags,literal:str}}function scanRegExp(){var start,body,flags,value;return lookahead=null,skipComment(),start=index,body=scanRegExpBody(),flags=scanRegExpFlags(),value=testRegExp(body.value,flags.value),extra.tokenize?{type:Token.RegularExpression,value:value,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}:{literal:body.literal+flags.literal,value:value,start:start,end:index}}function collectRegex(){var pos,loc,regex,token;return skipComment(),pos=index,loc={start:{line:lineNumber,column:index-lineStart}},regex=scanRegExp(),loc.end={line:lineNumber,column:index-lineStart},extra.tokenize||(extra.tokens.length>0&&(token=extra.tokens[extra.tokens.length-1],token.range[0]===pos&&"Punctuator"===token.type&&("/"===token.value||"/="===token.value)&&extra.tokens.pop()),extra.tokens.push({type:"RegularExpression",value:regex.literal,range:[pos,index],loc:loc})),regex
}function isIdentifierName(token){return token.type===Token.Identifier||token.type===Token.Keyword||token.type===Token.BooleanLiteral||token.type===Token.NullLiteral}function advanceSlash(){var prevToken,checkToken;if(prevToken=extra.tokens[extra.tokens.length-1],!prevToken)return collectRegex();if("Punctuator"===prevToken.type){if("]"===prevToken.value)return scanPunctuator();if(")"===prevToken.value)return checkToken=extra.tokens[extra.openParenToken-1],!checkToken||"Keyword"!==checkToken.type||"if"!==checkToken.value&&"while"!==checkToken.value&&"for"!==checkToken.value&&"with"!==checkToken.value?scanPunctuator():collectRegex();if("}"===prevToken.value){if(extra.tokens[extra.openCurlyToken-3]&&"Keyword"===extra.tokens[extra.openCurlyToken-3].type){if(checkToken=extra.tokens[extra.openCurlyToken-4],!checkToken)return scanPunctuator()}else{if(!extra.tokens[extra.openCurlyToken-4]||"Keyword"!==extra.tokens[extra.openCurlyToken-4].type)return scanPunctuator();if(checkToken=extra.tokens[extra.openCurlyToken-5],!checkToken)return collectRegex()}return FnExprTokens.indexOf(checkToken.value)>=0?scanPunctuator():collectRegex()}return collectRegex()}return"Keyword"===prevToken.type?collectRegex():scanPunctuator()}function advance(){var ch;return skipComment(),index>=length?{type:Token.EOF,lineNumber:lineNumber,lineStart:lineStart,start:index,end:index}:(ch=source.charCodeAt(index),isIdentifierStart(ch)?scanIdentifier():40===ch||41===ch||59===ch?scanPunctuator():39===ch||34===ch?scanStringLiteral():46===ch?isDecimalDigit(source.charCodeAt(index+1))?scanNumericLiteral():scanPunctuator():isDecimalDigit(ch)?scanNumericLiteral():extra.tokenize&&47===ch?advanceSlash():scanPunctuator())}function collectToken(){var loc,token,value;return skipComment(),loc={start:{line:lineNumber,column:index-lineStart}},token=advance(),loc.end={line:lineNumber,column:index-lineStart},token.type!==Token.EOF&&(value=source.slice(token.start,token.end),extra.tokens.push({type:TokenName[token.type],value:value,range:[token.start,token.end],loc:loc})),token}function lex(){var token;return token=lookahead,index=token.end,lineNumber=token.lineNumber,lineStart=token.lineStart,lookahead="undefined"!=typeof extra.tokens?collectToken():advance(),index=token.end,lineNumber=token.lineNumber,lineStart=token.lineStart,token}function peek(){var pos,line,start;pos=index,line=lineNumber,start=lineStart,lookahead="undefined"!=typeof extra.tokens?collectToken():advance(),index=pos,lineNumber=line,lineStart=start}function Position(){this.line=lineNumber,this.column=index-lineStart}function SourceLocation(){this.start=new Position,this.end=null}function WrappingSourceLocation(startToken){this.start=startToken.type===Token.StringLiteral?{line:startToken.startLineNumber,column:startToken.start-startToken.startLineStart}:{line:startToken.lineNumber,column:startToken.start-startToken.lineStart},this.end=null}function Node(){index=lookahead.start,lookahead.type===Token.StringLiteral?(lineNumber=lookahead.startLineNumber,lineStart=lookahead.startLineStart):(lineNumber=lookahead.lineNumber,lineStart=lookahead.lineStart),extra.range&&(this.range=[index,0]),extra.loc&&(this.loc=new SourceLocation)}function WrappingNode(startToken){extra.range&&(this.range=[startToken.start,0]),extra.loc&&(this.loc=new WrappingSourceLocation(startToken))}function peekLineTerminator(){var pos,line,start,found;return pos=index,line=lineNumber,start=lineStart,skipComment(),found=lineNumber!==line,index=pos,lineNumber=line,lineStart=start,found}function throwError(token,messageFormat){var error,args=Array.prototype.slice.call(arguments,2),msg=messageFormat.replace(/%(\d)/g,function(whole,index){return assert(index<args.length,"Message reference must be in range"),args[index]});throw"number"==typeof token.lineNumber?(error=new Error("Line "+token.lineNumber+": "+msg),error.index=token.start,error.lineNumber=token.lineNumber,error.column=token.start-lineStart+1):(error=new Error("Line "+lineNumber+": "+msg),error.index=index,error.lineNumber=lineNumber,error.column=index-lineStart+1),error.description=msg,error}function throwErrorTolerant(){try{throwError.apply(null,arguments)}catch(e){if(!extra.errors)throw e;extra.errors.push(e)}}function throwUnexpected(token){if(token.type===Token.EOF&&throwError(token,Messages.UnexpectedEOS),token.type===Token.NumericLiteral&&throwError(token,Messages.UnexpectedNumber),token.type===Token.StringLiteral&&throwError(token,Messages.UnexpectedString),token.type===Token.Identifier&&throwError(token,Messages.UnexpectedIdentifier),token.type===Token.Keyword){if(isFutureReservedWord(token.value))throwError(token,Messages.UnexpectedReserved);else if(strict&&isStrictModeReservedWord(token.value))return void throwErrorTolerant(token,Messages.StrictReservedWord);throwError(token,Messages.UnexpectedToken,token.value)}throwError(token,Messages.UnexpectedToken,token.value)}function expect(value){var token=lex();(token.type!==Token.Punctuator||token.value!==value)&&throwUnexpected(token)}function expectTolerant(value){if(extra.errors){var token=lookahead;token.type!==Token.Punctuator&&token.value!==value?throwErrorTolerant(token,Messages.UnexpectedToken,token.value):lex()}else expect(value)}function expectKeyword(keyword){var token=lex();(token.type!==Token.Keyword||token.value!==keyword)&&throwUnexpected(token)}function match(value){return lookahead.type===Token.Punctuator&&lookahead.value===value}function matchKeyword(keyword){return lookahead.type===Token.Keyword&&lookahead.value===keyword}function matchAssign(){var op;return lookahead.type!==Token.Punctuator?!1:(op=lookahead.value,"="===op||"*="===op||"/="===op||"%="===op||"+="===op||"-="===op||"<<="===op||">>="===op||">>>="===op||"&="===op||"^="===op||"|="===op)}function consumeSemicolon(){var line;return 59===source.charCodeAt(index)||match(";")?void lex():(line=lineNumber,skipComment(),void(lineNumber===line&&(lookahead.type===Token.EOF||match("}")||throwUnexpected(lookahead))))}function isLeftHandSide(expr){return expr.type===Syntax.Identifier||expr.type===Syntax.MemberExpression}function parseArrayInitialiser(){var elements=[],node=new Node;for(expect("[");!match("]");)match(",")?(lex(),elements.push(null)):(elements.push(parseAssignmentExpression()),match("]")||expect(","));return lex(),node.finishArrayExpression(elements)}function parsePropertyFunction(param,first){var previousStrict,body,node=new Node;return previousStrict=strict,body=parseFunctionSourceElements(),first&&strict&&isRestrictedWord(param[0].name)&&throwErrorTolerant(first,Messages.StrictParamName),strict=previousStrict,node.finishFunctionExpression(null,param,[],body)}function parseObjectPropertyKey(){var token,node=new Node;return token=lex(),token.type===Token.StringLiteral||token.type===Token.NumericLiteral?(strict&&token.octal&&throwErrorTolerant(token,Messages.StrictOctalLiteral),node.finishLiteral(token)):node.finishIdentifier(token.value)}function parseObjectProperty(){var token,key,id,value,param,node=new Node;return token=lookahead,token.type===Token.Identifier?(id=parseObjectPropertyKey(),"get"!==token.value||match(":")?"set"!==token.value||match(":")?(expect(":"),value=parseAssignmentExpression(),node.finishProperty("init",id,value)):(key=parseObjectPropertyKey(),expect("("),token=lookahead,token.type!==Token.Identifier?(expect(")"),throwErrorTolerant(token,Messages.UnexpectedToken,token.value),value=parsePropertyFunction([])):(param=[parseVariableIdentifier()],expect(")"),value=parsePropertyFunction(param,token)),node.finishProperty("set",key,value)):(key=parseObjectPropertyKey(),expect("("),expect(")"),value=parsePropertyFunction([]),node.finishProperty("get",key,value))):token.type!==Token.EOF&&token.type!==Token.Punctuator?(key=parseObjectPropertyKey(),expect(":"),value=parseAssignmentExpression(),node.finishProperty("init",key,value)):void throwUnexpected(token)}function parseObjectInitialiser(){var property,name,key,kind,properties=[],map={},toString=String,node=new Node;for(expect("{");!match("}");)property=parseObjectProperty(),name=property.key.type===Syntax.Identifier?property.key.name:toString(property.key.value),kind="init"===property.kind?PropertyKind.Data:"get"===property.kind?PropertyKind.Get:PropertyKind.Set,key="$"+name,Object.prototype.hasOwnProperty.call(map,key)?(map[key]===PropertyKind.Data?strict&&kind===PropertyKind.Data?throwErrorTolerant({},Messages.StrictDuplicateProperty):kind!==PropertyKind.Data&&throwErrorTolerant({},Messages.AccessorDataProperty):kind===PropertyKind.Data?throwErrorTolerant({},Messages.AccessorDataProperty):map[key]&kind&&throwErrorTolerant({},Messages.AccessorGetSet),map[key]|=kind):map[key]=kind,properties.push(property),match("}")||expectTolerant(",");return expect("}"),node.finishObjectExpression(properties)}function parseGroupExpression(){var expr;return expect("("),match(")")?(lex(),PlaceHolders.ArrowParameterPlaceHolder):(++state.parenthesisCount,expr=parseExpression(),expect(")"),expr)}function parsePrimaryExpression(){var type,token,expr,node;if(match("("))return parseGroupExpression();if(match("["))return parseArrayInitialiser();if(match("{"))return parseObjectInitialiser();if(type=lookahead.type,node=new Node,type===Token.Identifier)expr=node.finishIdentifier(lex().value);else if(type===Token.StringLiteral||type===Token.NumericLiteral)strict&&lookahead.octal&&throwErrorTolerant(lookahead,Messages.StrictOctalLiteral),expr=node.finishLiteral(lex());else if(type===Token.Keyword){if(matchKeyword("function"))return parseFunctionExpression();matchKeyword("this")?(lex(),expr=node.finishThisExpression()):throwUnexpected(lex())}else type===Token.BooleanLiteral?(token=lex(),token.value="true"===token.value,expr=node.finishLiteral(token)):type===Token.NullLiteral?(token=lex(),token.value=null,expr=node.finishLiteral(token)):match("/")||match("/=")?(expr=node.finishLiteral("undefined"!=typeof extra.tokens?collectRegex():scanRegExp()),peek()):throwUnexpected(lex());return expr}function parseArguments(){var args=[];if(expect("("),!match(")"))for(;length>index&&(args.push(parseAssignmentExpression()),!match(")"));)expectTolerant(",");return expect(")"),args}function parseNonComputedProperty(){var token,node=new Node;return token=lex(),isIdentifierName(token)||throwUnexpected(token),node.finishIdentifier(token.value)}function parseNonComputedMember(){return expect("."),parseNonComputedProperty()}function parseComputedMember(){var expr;return expect("["),expr=parseExpression(),expect("]"),expr}function parseNewExpression(){var callee,args,node=new Node;return expectKeyword("new"),callee=parseLeftHandSideExpression(),args=match("(")?parseArguments():[],node.finishNewExpression(callee,args)}function parseLeftHandSideExpressionAllowCall(){var expr,args,property,startToken,previousAllowIn=state.allowIn;for(startToken=lookahead,state.allowIn=!0,expr=matchKeyword("new")?parseNewExpression():parsePrimaryExpression();;)if(match("."))property=parseNonComputedMember(),expr=new WrappingNode(startToken).finishMemberExpression(".",expr,property);else if(match("("))args=parseArguments(),expr=new WrappingNode(startToken).finishCallExpression(expr,args);else{if(!match("["))break;property=parseComputedMember(),expr=new WrappingNode(startToken).finishMemberExpression("[",expr,property)}return state.allowIn=previousAllowIn,expr}function parseLeftHandSideExpression(){var expr,property,startToken;for(assert(state.allowIn,"callee of new expression always allow in keyword."),startToken=lookahead,expr=matchKeyword("new")?parseNewExpression():parsePrimaryExpression();;)if(match("["))property=parseComputedMember(),expr=new WrappingNode(startToken).finishMemberExpression("[",expr,property);else{if(!match("."))break;property=parseNonComputedMember(),expr=new WrappingNode(startToken).finishMemberExpression(".",expr,property)}return expr}function parsePostfixExpression(){var expr,token,startToken=lookahead;return expr=parseLeftHandSideExpressionAllowCall(),lookahead.type===Token.Punctuator&&(!match("++")&&!match("--")||peekLineTerminator()||(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)&&throwErrorTolerant({},Messages.StrictLHSPostfix),isLeftHandSide(expr)||throwErrorTolerant({},Messages.InvalidLHSInAssignment),token=lex(),expr=new WrappingNode(startToken).finishPostfixExpression(token.value,expr))),expr}function parseUnaryExpression(){var token,expr,startToken;return lookahead.type!==Token.Punctuator&&lookahead.type!==Token.Keyword?expr=parsePostfixExpression():match("++")||match("--")?(startToken=lookahead,token=lex(),expr=parseUnaryExpression(),strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)&&throwErrorTolerant({},Messages.StrictLHSPrefix),isLeftHandSide(expr)||throwErrorTolerant({},Messages.InvalidLHSInAssignment),expr=new WrappingNode(startToken).finishUnaryExpression(token.value,expr)):match("+")||match("-")||match("~")||match("!")?(startToken=lookahead,token=lex(),expr=parseUnaryExpression(),expr=new WrappingNode(startToken).finishUnaryExpression(token.value,expr)):matchKeyword("delete")||matchKeyword("void")||matchKeyword("typeof")?(startToken=lookahead,token=lex(),expr=parseUnaryExpression(),expr=new WrappingNode(startToken).finishUnaryExpression(token.value,expr),strict&&"delete"===expr.operator&&expr.argument.type===Syntax.Identifier&&throwErrorTolerant({},Messages.StrictDelete)):expr=parsePostfixExpression(),expr}function binaryPrecedence(token,allowIn){var prec=0;if(token.type!==Token.Punctuator&&token.type!==Token.Keyword)return 0;switch(token.value){case"||":prec=1;break;case"&&":prec=2;break;case"|":prec=3;break;case"^":prec=4;break;case"&":prec=5;break;case"==":case"!=":case"===":case"!==":prec=6;break;case"<":case">":case"<=":case">=":case"instanceof":prec=7;break;case"in":prec=allowIn?7:0;break;case"<<":case">>":case">>>":prec=8;break;case"+":case"-":prec=9;break;case"*":case"/":case"%":prec=11}return prec}function parseBinaryExpression(){var marker,markers,expr,token,prec,stack,right,operator,left,i;if(marker=lookahead,left=parseUnaryExpression(),left===PlaceHolders.ArrowParameterPlaceHolder)return left;if(token=lookahead,prec=binaryPrecedence(token,state.allowIn),0===prec)return left;for(token.prec=prec,lex(),markers=[marker,lookahead],right=parseUnaryExpression(),stack=[left,token,right];(prec=binaryPrecedence(lookahead,state.allowIn))>0;){for(;stack.length>2&&prec<=stack[stack.length-2].prec;)right=stack.pop(),operator=stack.pop().value,left=stack.pop(),markers.pop(),expr=new WrappingNode(markers[markers.length-1]).finishBinaryExpression(operator,left,right),stack.push(expr);token=lex(),token.prec=prec,stack.push(token),markers.push(lookahead),expr=parseUnaryExpression(),stack.push(expr)}for(i=stack.length-1,expr=stack[i],markers.pop();i>1;)expr=new WrappingNode(markers.pop()).finishBinaryExpression(stack[i-1].value,stack[i-2],expr),i-=2;return expr}function parseConditionalExpression(){var expr,previousAllowIn,consequent,alternate,startToken;return startToken=lookahead,expr=parseBinaryExpression(),expr===PlaceHolders.ArrowParameterPlaceHolder?expr:(match("?")&&(lex(),previousAllowIn=state.allowIn,state.allowIn=!0,consequent=parseAssignmentExpression(),state.allowIn=previousAllowIn,expect(":"),alternate=parseAssignmentExpression(),expr=new WrappingNode(startToken).finishConditionalExpression(expr,consequent,alternate)),expr)}function parseConciseBody(){return match("{")?parseFunctionSourceElements():parseAssignmentExpression()}function reinterpretAsCoverFormalsList(expressions){var i,len,param,params,defaults,defaultCount,options,rest;for(params=[],defaults=[],defaultCount=0,rest=null,options={paramSet:{}},i=0,len=expressions.length;len>i;i+=1)if(param=expressions[i],param.type===Syntax.Identifier)params.push(param),defaults.push(null),validateParam(options,param,param.name);else{if(param.type!==Syntax.AssignmentExpression)return null;params.push(param.left),defaults.push(param.right),++defaultCount,validateParam(options,param.left,param.left.name)}return options.message===Messages.StrictParamDupe&&throwError(strict?options.stricted:options.firstRestricted,options.message),0===defaultCount&&(defaults=[]),{params:params,defaults:defaults,rest:rest,stricted:options.stricted,firstRestricted:options.firstRestricted,message:options.message}}function parseArrowFunctionExpression(options,node){var previousStrict,body;return expect("=>"),previousStrict=strict,body=parseConciseBody(),strict&&options.firstRestricted&&throwError(options.firstRestricted,options.message),strict&&options.stricted&&throwErrorTolerant(options.stricted,options.message),strict=previousStrict,node.finishArrowFunctionExpression(options.params,options.defaults,body,body.type!==Syntax.BlockStatement)}function parseAssignmentExpression(){var oldParenthesisCount,token,expr,right,list,startToken;return oldParenthesisCount=state.parenthesisCount,startToken=lookahead,token=lookahead,expr=parseConditionalExpression(),expr!==PlaceHolders.ArrowParameterPlaceHolder&&!match("=>")||state.parenthesisCount!==oldParenthesisCount&&state.parenthesisCount!==oldParenthesisCount+1||(expr.type===Syntax.Identifier?list=reinterpretAsCoverFormalsList([expr]):expr.type===Syntax.AssignmentExpression?list=reinterpretAsCoverFormalsList([expr]):expr.type===Syntax.SequenceExpression?list=reinterpretAsCoverFormalsList(expr.expressions):expr===PlaceHolders.ArrowParameterPlaceHolder&&(list=reinterpretAsCoverFormalsList([])),!list)?(matchAssign()&&(isLeftHandSide(expr)||throwErrorTolerant({},Messages.InvalidLHSInAssignment),strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)&&throwErrorTolerant(token,Messages.StrictLHSAssignment),token=lex(),right=parseAssignmentExpression(),expr=new WrappingNode(startToken).finishAssignmentExpression(token.value,expr,right)),expr):parseArrowFunctionExpression(list,new WrappingNode(startToken))}function parseExpression(){var expr,expressions,startToken=lookahead;if(expr=parseAssignmentExpression(),match(",")){for(expressions=[expr];length>index&&match(",");)lex(),expressions.push(parseAssignmentExpression());expr=new WrappingNode(startToken).finishSequenceExpression(expressions)}return expr}function parseStatementList(){for(var statement,list=[];length>index&&!match("}")&&(statement=parseSourceElement(),"undefined"!=typeof statement);)list.push(statement);return list}function parseBlock(){var block,node=new Node;return expect("{"),block=parseStatementList(),expect("}"),node.finishBlockStatement(block)}function parseVariableIdentifier(){var token,node=new Node;return token=lex(),token.type!==Token.Identifier&&throwUnexpected(token),node.finishIdentifier(token.value)}function parseVariableDeclaration(kind){var id,init=null,node=new Node;return id=parseVariableIdentifier(),strict&&isRestrictedWord(id.name)&&throwErrorTolerant({},Messages.StrictVarName),"const"===kind?(expect("="),init=parseAssignmentExpression()):match("=")&&(lex(),init=parseAssignmentExpression()),node.finishVariableDeclarator(id,init)}function parseVariableDeclarationList(kind){var list=[];do{if(list.push(parseVariableDeclaration(kind)),!match(","))break;lex()}while(length>index);return list}function parseVariableStatement(node){var declarations;return expectKeyword("var"),declarations=parseVariableDeclarationList(),consumeSemicolon(),node.finishVariableDeclaration(declarations,"var")}function parseConstLetDeclaration(kind){var declarations,node=new Node;return expectKeyword(kind),declarations=parseVariableDeclarationList(kind),consumeSemicolon(),node.finishVariableDeclaration(declarations,kind)}function parseEmptyStatement(){var node=new Node;return expect(";"),node.finishEmptyStatement()}function parseExpressionStatement(node){var expr=parseExpression();return consumeSemicolon(),node.finishExpressionStatement(expr)}function parseIfStatement(node){var test,consequent,alternate;return expectKeyword("if"),expect("("),test=parseExpression(),expect(")"),consequent=parseStatement(),matchKeyword("else")?(lex(),alternate=parseStatement()):alternate=null,node.finishIfStatement(test,consequent,alternate)}function parseDoWhileStatement(node){var body,test,oldInIteration;return expectKeyword("do"),oldInIteration=state.inIteration,state.inIteration=!0,body=parseStatement(),state.inIteration=oldInIteration,expectKeyword("while"),expect("("),test=parseExpression(),expect(")"),match(";")&&lex(),node.finishDoWhileStatement(body,test)}function parseWhileStatement(node){var test,body,oldInIteration;return expectKeyword("while"),expect("("),test=parseExpression(),expect(")"),oldInIteration=state.inIteration,state.inIteration=!0,body=parseStatement(),state.inIteration=oldInIteration,node.finishWhileStatement(test,body)}function parseForVariableDeclaration(){var token,declarations,node=new Node;return token=lex(),declarations=parseVariableDeclarationList(),node.finishVariableDeclaration(declarations,token.value)}function parseForStatement(node){var init,test,update,left,right,body,oldInIteration,previousAllowIn=state.allowIn;return init=test=update=null,expectKeyword("for"),expect("("),match(";")?lex():(matchKeyword("var")||matchKeyword("let")?(state.allowIn=!1,init=parseForVariableDeclaration(),state.allowIn=previousAllowIn,1===init.declarations.length&&matchKeyword("in")&&(lex(),left=init,right=parseExpression(),init=null)):(state.allowIn=!1,init=parseExpression(),state.allowIn=previousAllowIn,matchKeyword("in")&&(isLeftHandSide(init)||throwErrorTolerant({},Messages.InvalidLHSInForIn),lex(),left=init,right=parseExpression(),init=null)),"undefined"==typeof left&&expect(";")),"undefined"==typeof left&&(match(";")||(test=parseExpression()),expect(";"),match(")")||(update=parseExpression())),expect(")"),oldInIteration=state.inIteration,state.inIteration=!0,body=parseStatement(),state.inIteration=oldInIteration,"undefined"==typeof left?node.finishForStatement(init,test,update,body):node.finishForInStatement(left,right,body)}function parseContinueStatement(node){var key,label=null;return expectKeyword("continue"),59===source.charCodeAt(index)?(lex(),state.inIteration||throwError({},Messages.IllegalContinue),node.finishContinueStatement(null)):peekLineTerminator()?(state.inIteration||throwError({},Messages.IllegalContinue),node.finishContinueStatement(null)):(lookahead.type===Token.Identifier&&(label=parseVariableIdentifier(),key="$"+label.name,Object.prototype.hasOwnProperty.call(state.labelSet,key)||throwError({},Messages.UnknownLabel,label.name)),consumeSemicolon(),null!==label||state.inIteration||throwError({},Messages.IllegalContinue),node.finishContinueStatement(label))}function parseBreakStatement(node){var key,label=null;return expectKeyword("break"),59===source.charCodeAt(index)?(lex(),state.inIteration||state.inSwitch||throwError({},Messages.IllegalBreak),node.finishBreakStatement(null)):peekLineTerminator()?(state.inIteration||state.inSwitch||throwError({},Messages.IllegalBreak),node.finishBreakStatement(null)):(lookahead.type===Token.Identifier&&(label=parseVariableIdentifier(),key="$"+label.name,Object.prototype.hasOwnProperty.call(state.labelSet,key)||throwError({},Messages.UnknownLabel,label.name)),consumeSemicolon(),null!==label||state.inIteration||state.inSwitch||throwError({},Messages.IllegalBreak),node.finishBreakStatement(label))}function parseReturnStatement(node){var argument=null;return expectKeyword("return"),state.inFunctionBody||throwErrorTolerant({},Messages.IllegalReturn),32===source.charCodeAt(index)&&isIdentifierStart(source.charCodeAt(index+1))?(argument=parseExpression(),consumeSemicolon(),node.finishReturnStatement(argument)):peekLineTerminator()?node.finishReturnStatement(null):(match(";")||match("}")||lookahead.type===Token.EOF||(argument=parseExpression()),consumeSemicolon(),node.finishReturnStatement(argument))}function parseWithStatement(node){var object,body;return strict&&(skipComment(),throwErrorTolerant({},Messages.StrictModeWith)),expectKeyword("with"),expect("("),object=parseExpression(),expect(")"),body=parseStatement(),node.finishWithStatement(object,body)}function parseSwitchCase(){var test,statement,consequent=[],node=new Node;for(matchKeyword("default")?(lex(),test=null):(expectKeyword("case"),test=parseExpression()),expect(":");length>index&&!(match("}")||matchKeyword("default")||matchKeyword("case"));)statement=parseStatement(),consequent.push(statement);return node.finishSwitchCase(test,consequent)}function parseSwitchStatement(node){var discriminant,cases,clause,oldInSwitch,defaultFound;if(expectKeyword("switch"),expect("("),discriminant=parseExpression(),expect(")"),expect("{"),cases=[],match("}"))return lex(),node.finishSwitchStatement(discriminant,cases);for(oldInSwitch=state.inSwitch,state.inSwitch=!0,defaultFound=!1;length>index&&!match("}");)clause=parseSwitchCase(),null===clause.test&&(defaultFound&&throwError({},Messages.MultipleDefaultsInSwitch),defaultFound=!0),cases.push(clause);return state.inSwitch=oldInSwitch,expect("}"),node.finishSwitchStatement(discriminant,cases)}function parseThrowStatement(node){var argument;return expectKeyword("throw"),peekLineTerminator()&&throwError({},Messages.NewlineAfterThrow),argument=parseExpression(),consumeSemicolon(),node.finishThrowStatement(argument)}function parseCatchClause(){var param,body,node=new Node;return expectKeyword("catch"),expect("("),match(")")&&throwUnexpected(lookahead),param=parseVariableIdentifier(),strict&&isRestrictedWord(param.name)&&throwErrorTolerant({},Messages.StrictCatchVariable),expect(")"),body=parseBlock(),node.finishCatchClause(param,body)}function parseTryStatement(node){var block,handlers=[],finalizer=null;return expectKeyword("try"),block=parseBlock(),matchKeyword("catch")&&handlers.push(parseCatchClause()),matchKeyword("finally")&&(lex(),finalizer=parseBlock()),0!==handlers.length||finalizer||throwError({},Messages.NoCatchOrFinally),node.finishTryStatement(block,[],handlers,finalizer)}function parseDebuggerStatement(node){return expectKeyword("debugger"),consumeSemicolon(),node.finishDebuggerStatement()}function parseStatement(){var expr,labeledBody,key,node,type=lookahead.type;if(type===Token.EOF&&throwUnexpected(lookahead),type===Token.Punctuator&&"{"===lookahead.value)return parseBlock();if(node=new Node,type===Token.Punctuator)switch(lookahead.value){case";":return parseEmptyStatement(node);case"(":return parseExpressionStatement(node)}else if(type===Token.Keyword)switch(lookahead.value){case"break":return parseBreakStatement(node);case"continue":return parseContinueStatement(node);case"debugger":return parseDebuggerStatement(node);case"do":return parseDoWhileStatement(node);case"for":return parseForStatement(node);case"function":return parseFunctionDeclaration(node);case"if":return parseIfStatement(node);case"return":return parseReturnStatement(node);case"switch":return parseSwitchStatement(node);case"throw":return parseThrowStatement(node);case"try":return parseTryStatement(node);case"var":return parseVariableStatement(node);case"while":return parseWhileStatement(node);case"with":return parseWithStatement(node)}return expr=parseExpression(),expr.type===Syntax.Identifier&&match(":")?(lex(),key="$"+expr.name,Object.prototype.hasOwnProperty.call(state.labelSet,key)&&throwError({},Messages.Redeclaration,"Label",expr.name),state.labelSet[key]=!0,labeledBody=parseStatement(),delete state.labelSet[key],node.finishLabeledStatement(expr,labeledBody)):(consumeSemicolon(),node.finishExpressionStatement(expr))}function parseFunctionSourceElements(){var sourceElement,token,directive,firstRestricted,oldLabelSet,oldInIteration,oldInSwitch,oldInFunctionBody,oldParenthesisCount,sourceElements=[],node=new Node;for(expect("{");length>index&&lookahead.type===Token.StringLiteral&&(token=lookahead,sourceElement=parseSourceElement(),sourceElements.push(sourceElement),sourceElement.expression.type===Syntax.Literal);)directive=source.slice(token.start+1,token.end-1),"use strict"===directive?(strict=!0,firstRestricted&&throwErrorTolerant(firstRestricted,Messages.StrictOctalLiteral)):!firstRestricted&&token.octal&&(firstRestricted=token);for(oldLabelSet=state.labelSet,oldInIteration=state.inIteration,oldInSwitch=state.inSwitch,oldInFunctionBody=state.inFunctionBody,oldParenthesisCount=state.parenthesizedCount,state.labelSet={},state.inIteration=!1,state.inSwitch=!1,state.inFunctionBody=!0,state.parenthesizedCount=0;length>index&&!match("}")&&(sourceElement=parseSourceElement(),"undefined"!=typeof sourceElement);)sourceElements.push(sourceElement);return expect("}"),state.labelSet=oldLabelSet,state.inIteration=oldInIteration,state.inSwitch=oldInSwitch,state.inFunctionBody=oldInFunctionBody,state.parenthesizedCount=oldParenthesisCount,node.finishBlockStatement(sourceElements)}function validateParam(options,param,name){var key="$"+name;strict?(isRestrictedWord(name)&&(options.stricted=param,options.message=Messages.StrictParamName),Object.prototype.hasOwnProperty.call(options.paramSet,key)&&(options.stricted=param,options.message=Messages.StrictParamDupe)):options.firstRestricted||(isRestrictedWord(name)?(options.firstRestricted=param,options.message=Messages.StrictParamName):isStrictModeReservedWord(name)?(options.firstRestricted=param,options.message=Messages.StrictReservedWord):Object.prototype.hasOwnProperty.call(options.paramSet,key)&&(options.firstRestricted=param,options.message=Messages.StrictParamDupe)),options.paramSet[key]=!0}function parseParam(options){var token,param,def;return token=lookahead,param=parseVariableIdentifier(),validateParam(options,token,token.value),match("=")&&(lex(),def=parseAssignmentExpression(),++options.defaultCount),options.params.push(param),options.defaults.push(def),!match(")")}function parseParams(firstRestricted){var options;if(options={params:[],defaultCount:0,defaults:[],firstRestricted:firstRestricted},expect("("),!match(")"))for(options.paramSet={};length>index&&parseParam(options);)expect(",");return expect(")"),0===options.defaultCount&&(options.defaults=[]),{params:options.params,defaults:options.defaults,stricted:options.stricted,firstRestricted:options.firstRestricted,message:options.message}}function parseFunctionDeclaration(){var id,body,token,stricted,tmp,firstRestricted,message,previousStrict,params=[],defaults=[],node=new Node;return expectKeyword("function"),token=lookahead,id=parseVariableIdentifier(),strict?isRestrictedWord(token.value)&&throwErrorTolerant(token,Messages.StrictFunctionName):isRestrictedWord(token.value)?(firstRestricted=token,message=Messages.StrictFunctionName):isStrictModeReservedWord(token.value)&&(firstRestricted=token,message=Messages.StrictReservedWord),tmp=parseParams(firstRestricted),params=tmp.params,defaults=tmp.defaults,stricted=tmp.stricted,firstRestricted=tmp.firstRestricted,tmp.message&&(message=tmp.message),previousStrict=strict,body=parseFunctionSourceElements(),strict&&firstRestricted&&throwError(firstRestricted,message),strict&&stricted&&throwErrorTolerant(stricted,message),strict=previousStrict,node.finishFunctionDeclaration(id,params,defaults,body)}function parseFunctionExpression(){var token,stricted,firstRestricted,message,tmp,body,previousStrict,id=null,params=[],defaults=[],node=new Node;return expectKeyword("function"),match("(")||(token=lookahead,id=parseVariableIdentifier(),strict?isRestrictedWord(token.value)&&throwErrorTolerant(token,Messages.StrictFunctionName):isRestrictedWord(token.value)?(firstRestricted=token,message=Messages.StrictFunctionName):isStrictModeReservedWord(token.value)&&(firstRestricted=token,message=Messages.StrictReservedWord)),tmp=parseParams(firstRestricted),params=tmp.params,defaults=tmp.defaults,stricted=tmp.stricted,firstRestricted=tmp.firstRestricted,tmp.message&&(message=tmp.message),previousStrict=strict,body=parseFunctionSourceElements(),strict&&firstRestricted&&throwError(firstRestricted,message),strict&&stricted&&throwErrorTolerant(stricted,message),strict=previousStrict,node.finishFunctionExpression(id,params,defaults,body)}function parseSourceElement(){if(lookahead.type===Token.Keyword)switch(lookahead.value){case"const":case"let":return parseConstLetDeclaration(lookahead.value);
case"function":return parseFunctionDeclaration();default:return parseStatement()}return lookahead.type!==Token.EOF?parseStatement():void 0}function parseSourceElements(){for(var sourceElement,token,directive,firstRestricted,sourceElements=[];length>index&&(token=lookahead,token.type===Token.StringLiteral)&&(sourceElement=parseSourceElement(),sourceElements.push(sourceElement),sourceElement.expression.type===Syntax.Literal);)directive=source.slice(token.start+1,token.end-1),"use strict"===directive?(strict=!0,firstRestricted&&throwErrorTolerant(firstRestricted,Messages.StrictOctalLiteral)):!firstRestricted&&token.octal&&(firstRestricted=token);for(;length>index&&(sourceElement=parseSourceElement(),"undefined"!=typeof sourceElement);)sourceElements.push(sourceElement);return sourceElements}function parseProgram(){var body,node;return skipComment(),peek(),node=new Node,strict=!1,body=parseSourceElements(),node.finishProgram(body)}function filterTokenLocation(){var i,entry,token,tokens=[];for(i=0;i<extra.tokens.length;++i)entry=extra.tokens[i],token={type:entry.type,value:entry.value},extra.range&&(token.range=entry.range),extra.loc&&(token.loc=entry.loc),tokens.push(token);extra.tokens=tokens}function tokenize(code,options){var toString,tokens;toString=String,"string"==typeof code||code instanceof String||(code=toString(code)),source=code,index=0,lineNumber=source.length>0?1:0,lineStart=0,length=source.length,lookahead=null,state={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},extra={},options=options||{},options.tokens=!0,extra.tokens=[],extra.tokenize=!0,extra.openParenToken=-1,extra.openCurlyToken=-1,extra.range="boolean"==typeof options.range&&options.range,extra.loc="boolean"==typeof options.loc&&options.loc,"boolean"==typeof options.comment&&options.comment&&(extra.comments=[]),"boolean"==typeof options.tolerant&&options.tolerant&&(extra.errors=[]);try{if(peek(),lookahead.type===Token.EOF)return extra.tokens;for(lex();lookahead.type!==Token.EOF;)try{lex()}catch(lexError){if(extra.errors){extra.errors.push(lexError);break}throw lexError}filterTokenLocation(),tokens=extra.tokens,"undefined"!=typeof extra.comments&&(tokens.comments=extra.comments),"undefined"!=typeof extra.errors&&(tokens.errors=extra.errors)}catch(e){throw e}finally{extra={}}return tokens}function parse(code,options){var program,toString;toString=String,"string"==typeof code||code instanceof String||(code=toString(code)),source=code,index=0,lineNumber=source.length>0?1:0,lineStart=0,length=source.length,lookahead=null,state={allowIn:!0,labelSet:{},parenthesisCount:0,inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},extra={},"undefined"!=typeof options&&(extra.range="boolean"==typeof options.range&&options.range,extra.loc="boolean"==typeof options.loc&&options.loc,extra.attachComment="boolean"==typeof options.attachComment&&options.attachComment,extra.loc&&null!==options.source&&void 0!==options.source&&(extra.source=toString(options.source)),"boolean"==typeof options.tokens&&options.tokens&&(extra.tokens=[]),"boolean"==typeof options.comment&&options.comment&&(extra.comments=[]),"boolean"==typeof options.tolerant&&options.tolerant&&(extra.errors=[]),extra.attachComment&&(extra.range=!0,extra.comments=[],extra.bottomRightStack=[],extra.trailingComments=[],extra.leadingComments=[]));try{program=parseProgram(),"undefined"!=typeof extra.comments&&(program.comments=extra.comments),"undefined"!=typeof extra.tokens&&(filterTokenLocation(),program.tokens=extra.tokens),"undefined"!=typeof extra.errors&&(program.errors=extra.errors)}catch(e){throw e}finally{extra={}}return program}var Token,TokenName,FnExprTokens,Syntax,PlaceHolders,PropertyKind,Messages,Regex,source,strict,index,lineNumber,lineStart,length,lookahead,state,extra;Token={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9},TokenName={},TokenName[Token.BooleanLiteral]="Boolean",TokenName[Token.EOF]="<end>",TokenName[Token.Identifier]="Identifier",TokenName[Token.Keyword]="Keyword",TokenName[Token.NullLiteral]="Null",TokenName[Token.NumericLiteral]="Numeric",TokenName[Token.Punctuator]="Punctuator",TokenName[Token.StringLiteral]="String",TokenName[Token.RegularExpression]="RegularExpression",FnExprTokens=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],Syntax={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",ArrowFunctionExpression:"ArrowFunctionExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"},PlaceHolders={ArrowParameterPlaceHolder:{type:"ArrowParameterPlaceHolder"}},PropertyKind={Data:1,Get:2,Set:4},Messages={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},Regex={NonAsciiIdentifierStart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢲऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]"),NonAsciiIdentifierPart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԯԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠ-ࢲࣤ-ॣ०-९ॱ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఀ-ఃఅ-ఌఎ-ఐఒ-నప-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಁ-ಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲഁ-ഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟ෦-෯ෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤞᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧ᪰-᪽ᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶ᳸᳹ᴀ-᷵᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚝꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꧠ-ꧾꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︭︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]")},WrappingNode.prototype=Node.prototype={processComment:function(){var lastChild,trailingComments,bottomRight=extra.bottomRightStack,last=bottomRight[bottomRight.length-1];if(!(this.type===Syntax.Program&&this.body.length>0)){if(extra.trailingComments.length>0?extra.trailingComments[0].range[0]>=this.range[1]?(trailingComments=extra.trailingComments,extra.trailingComments=[]):extra.trailingComments.length=0:last&&last.trailingComments&&last.trailingComments[0].range[0]>=this.range[1]&&(trailingComments=last.trailingComments,delete last.trailingComments),last)for(;last&&last.range[0]>=this.range[0];)lastChild=last,last=bottomRight.pop();lastChild?lastChild.leadingComments&&lastChild.leadingComments[lastChild.leadingComments.length-1].range[1]<=this.range[0]&&(this.leadingComments=lastChild.leadingComments,lastChild.leadingComments=void 0):extra.leadingComments.length>0&&extra.leadingComments[extra.leadingComments.length-1].range[1]<=this.range[0]&&(this.leadingComments=extra.leadingComments,extra.leadingComments=[]),trailingComments&&(this.trailingComments=trailingComments),bottomRight.push(this)}},finish:function(){extra.range&&(this.range[1]=index),extra.loc&&(this.loc.end=new Position,extra.source&&(this.loc.source=extra.source)),extra.attachComment&&this.processComment()},finishArrayExpression:function(elements){return this.type=Syntax.ArrayExpression,this.elements=elements,this.finish(),this},finishArrowFunctionExpression:function(params,defaults,body,expression){return this.type=Syntax.ArrowFunctionExpression,this.id=null,this.params=params,this.defaults=defaults,this.body=body,this.rest=null,this.generator=!1,this.expression=expression,this.finish(),this},finishAssignmentExpression:function(operator,left,right){return this.type=Syntax.AssignmentExpression,this.operator=operator,this.left=left,this.right=right,this.finish(),this},finishBinaryExpression:function(operator,left,right){return this.type="||"===operator||"&&"===operator?Syntax.LogicalExpression:Syntax.BinaryExpression,this.operator=operator,this.left=left,this.right=right,this.finish(),this},finishBlockStatement:function(body){return this.type=Syntax.BlockStatement,this.body=body,this.finish(),this},finishBreakStatement:function(label){return this.type=Syntax.BreakStatement,this.label=label,this.finish(),this},finishCallExpression:function(callee,args){return this.type=Syntax.CallExpression,this.callee=callee,this.arguments=args,this.finish(),this},finishCatchClause:function(param,body){return this.type=Syntax.CatchClause,this.param=param,this.body=body,this.finish(),this},finishConditionalExpression:function(test,consequent,alternate){return this.type=Syntax.ConditionalExpression,this.test=test,this.consequent=consequent,this.alternate=alternate,this.finish(),this},finishContinueStatement:function(label){return this.type=Syntax.ContinueStatement,this.label=label,this.finish(),this},finishDebuggerStatement:function(){return this.type=Syntax.DebuggerStatement,this.finish(),this},finishDoWhileStatement:function(body,test){return this.type=Syntax.DoWhileStatement,this.body=body,this.test=test,this.finish(),this},finishEmptyStatement:function(){return this.type=Syntax.EmptyStatement,this.finish(),this},finishExpressionStatement:function(expression){return this.type=Syntax.ExpressionStatement,this.expression=expression,this.finish(),this},finishForStatement:function(init,test,update,body){return this.type=Syntax.ForStatement,this.init=init,this.test=test,this.update=update,this.body=body,this.finish(),this},finishForInStatement:function(left,right,body){return this.type=Syntax.ForInStatement,this.left=left,this.right=right,this.body=body,this.each=!1,this.finish(),this},finishFunctionDeclaration:function(id,params,defaults,body){return this.type=Syntax.FunctionDeclaration,this.id=id,this.params=params,this.defaults=defaults,this.body=body,this.rest=null,this.generator=!1,this.expression=!1,this.finish(),this},finishFunctionExpression:function(id,params,defaults,body){return this.type=Syntax.FunctionExpression,this.id=id,this.params=params,this.defaults=defaults,this.body=body,this.rest=null,this.generator=!1,this.expression=!1,this.finish(),this},finishIdentifier:function(name){return this.type=Syntax.Identifier,this.name=name,this.finish(),this},finishIfStatement:function(test,consequent,alternate){return this.type=Syntax.IfStatement,this.test=test,this.consequent=consequent,this.alternate=alternate,this.finish(),this},finishLabeledStatement:function(label,body){return this.type=Syntax.LabeledStatement,this.label=label,this.body=body,this.finish(),this},finishLiteral:function(token){return this.type=Syntax.Literal,this.value=token.value,this.raw=source.slice(token.start,token.end),this.finish(),this},finishMemberExpression:function(accessor,object,property){return this.type=Syntax.MemberExpression,this.computed="["===accessor,this.object=object,this.property=property,this.finish(),this},finishNewExpression:function(callee,args){return this.type=Syntax.NewExpression,this.callee=callee,this.arguments=args,this.finish(),this},finishObjectExpression:function(properties){return this.type=Syntax.ObjectExpression,this.properties=properties,this.finish(),this},finishPostfixExpression:function(operator,argument){return this.type=Syntax.UpdateExpression,this.operator=operator,this.argument=argument,this.prefix=!1,this.finish(),this},finishProgram:function(body){return this.type=Syntax.Program,this.body=body,this.finish(),this},finishProperty:function(kind,key,value){return this.type=Syntax.Property,this.key=key,this.value=value,this.kind=kind,this.finish(),this},finishReturnStatement:function(argument){return this.type=Syntax.ReturnStatement,this.argument=argument,this.finish(),this},finishSequenceExpression:function(expressions){return this.type=Syntax.SequenceExpression,this.expressions=expressions,this.finish(),this},finishSwitchCase:function(test,consequent){return this.type=Syntax.SwitchCase,this.test=test,this.consequent=consequent,this.finish(),this},finishSwitchStatement:function(discriminant,cases){return this.type=Syntax.SwitchStatement,this.discriminant=discriminant,this.cases=cases,this.finish(),this},finishThisExpression:function(){return this.type=Syntax.ThisExpression,this.finish(),this},finishThrowStatement:function(argument){return this.type=Syntax.ThrowStatement,this.argument=argument,this.finish(),this},finishTryStatement:function(block,guardedHandlers,handlers,finalizer){return this.type=Syntax.TryStatement,this.block=block,this.guardedHandlers=guardedHandlers,this.handlers=handlers,this.finalizer=finalizer,this.finish(),this},finishUnaryExpression:function(operator,argument){return this.type="++"===operator||"--"===operator?Syntax.UpdateExpression:Syntax.UnaryExpression,this.operator=operator,this.argument=argument,this.prefix=!0,this.finish(),this},finishVariableDeclaration:function(declarations,kind){return this.type=Syntax.VariableDeclaration,this.declarations=declarations,this.kind=kind,this.finish(),this},finishVariableDeclarator:function(id,init){return this.type=Syntax.VariableDeclarator,this.id=id,this.init=init,this.finish(),this},finishWhileStatement:function(test,body){return this.type=Syntax.WhileStatement,this.test=test,this.body=body,this.finish(),this},finishWithStatement:function(object,body){return this.type=Syntax.WithStatement,this.object=object,this.body=body,this.finish(),this}},exports.version="2.0.0-dev",exports.tokenize=tokenize,exports.parse=parse,exports.Syntax=function(){var name,types={};"function"==typeof Object.create&&(types=Object.create(null));for(name in Syntax)Syntax.hasOwnProperty(name)&&(types[name]=Syntax[name]);return"function"==typeof Object.freeze&&Object.freeze(types),types}()})},$__modules__.Push=function(exports){function Push(mobileServicesClient){this._apns=null,this._gcm=null,this._registrationManager=null,Object.defineProperties(this,{apns:{get:function(){if(!this._apns){var name=_.format("MS-PushContainer-apns-{0}",mobileServicesClient.applicationUrl);this._registrationManager=new RegistrationManager(mobileServicesClient,"apns",name),this._apns=new apns(this)}return this._apns}},gcm:{get:function(){if(!this._gcm){var name=_.format("MS-PushContainer-gcm-{0}",mobileServicesClient.applicationUrl);this._registrationManager=new RegistrationManager(mobileServicesClient,"apns",name),this._gcm=new gcm(this)}return this._gcm}}})}function makeCoreRegistration(pushHandle,platform,tags){Validate.notNullOrEmpty(pushHandle,"pushHandle"),Validate.isString(pushHandle,"pushHandle"),"apns"==platform&&(pushHandle=pushHandle.toUpperCase());var registration={platform:platform,deviceId:pushHandle};return tags&&(Validate.isArray(tags,"tags"),registration.tags=tags),registration}var _=require("Extensions"),Validate=require("Validate"),RegistrationManager=(require("Platform"),require("RegistrationManager").RegistrationManager),apns=function(push){this._push=push},gcm=function(push){this._push=push};exports.Push=Push,Push.prototype._register=function(platform,pushHandle,tags){var registration=makeCoreRegistration(pushHandle,platform,tags);return this._registrationManager.upsertRegistration(registration)},Push.prototype._registerTemplate=function(platform,deviceToken,name,bodyTemplate,expiryTemplate,tags){Validate.notNullOrEmpty(name,"name"),Validate.notNullOrEmpty(bodyTemplate,"bodyTemplate");var templateAsString=bodyTemplate,registration=makeCoreRegistration(deviceToken,platform,tags);return _.isString(templateAsString)||(templateAsString=JSON.stringify(templateAsString)),registration.templateName=name,registration.templateBody=templateAsString,expiryTemplate&&(registration.expiry=expiryTemplate),this._registrationManager.upsertRegistration(registration)},Push.prototype._unregister=function(templateName){return Validate.notNullOrEmpty(templateName,"templateName"),this._registrationManager.deleteRegistrationWithName(templateName)},Push.prototype._unregisterAll=function(pushHandle){return Validate.notNullOrEmpty(pushHandle,"pushHandle"),this._registrationManager.deleteAllRegistrations(pushHandle)},apns.prototype.registerNative=function(deviceToken,tags){return this._push._register("apns",deviceToken,tags)},apns.prototype.registerTemplate=function(deviceToken,name,bodyTemplate,expiryTemplate,tags){return _.isNull(tags)&&!_.isNull(expiryTemplate)&&Array.isArray(expiryTemplate)&&(tags=expiryTemplate,expiryTemplate=null),this._push._registerTemplate("apns",deviceToken,name,bodyTemplate,expiryTemplate,tags)},apns.prototype.unregisterNative=function(){return this._push._unregister(RegistrationManager.NativeRegistrationName)},apns.prototype.unregisterTemplate=function(templateName){return this._push._unregister(templateName)},apns.prototype.unregisterAll=function(deviceToken){return this._push._unregisterAll(deviceToken)},gcm.prototype.registerNative=function(deviceId,tags){return this._push._register("gcm",deviceId,tags)},gcm.prototype.registerTemplate=function(deviceId,name,bodyTemplate,tags){return this._push._registerTemplate("gcm",deviceId,name,bodyTemplate,null,tags)},gcm.prototype.unregisterNative=function(){return this._push._unregister(RegistrationManager.NativeRegistrationName)},gcm.prototype.unregisterTemplate=function(templateName){return this._push._unregister(templateName)},gcm.prototype.unregisterAll=function(deviceId){return this._push._unregisterAll(deviceId)}},$__modules__.Platform=function(exports){function getBestTransport(){return bestAvailableTransport||(bestAvailableTransport=getBestProvider(knownTransports)),bestAvailableTransport}function getBestProvider(providers){for(var i=0;i<providers.length;i++)if(providers[i].supportsCurrentRuntime())return providers[i];throw new Error("Unsupported browser - no suitable providers are available.")}var _=require("Extensions"),Validate=require("Validate"),Promises=require("Promises"),Resources=require("Resources"),inMemorySettingStore={};try{var key="___z";localStorage.setItem(key,key),localStorage.removeItem(key),inMemorySettingStore=localStorage}catch(e){}var bestAvailableTransport=null,knownTransports=[require("DirectAjaxTransport"),require("IframeTransport")],knownLoginUis=[require("WebAuthBroker"),require("CordovaPopup"),require("BrowserPopup")],isoDateRegex=/^(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})(?:\.(\d*))?Z$/,dateSerializerOmitsDecimals=!JSON.stringify(new Date(100)).match(/\.100Z"$/);exports.async=function(func){return function(){var that=this,args=arguments;return new Promises.Promise(function(complete,error){var callback=function(err){_.isNull(err)?complete.apply(null,Array.prototype.slice.call(arguments,1)):error(err)};Array.prototype.push.call(args,callback);try{func.apply(that,args)}catch(ex){callback(_.createError(ex))}})}},exports.addToMobileServicesClientNamespace=function(declarations){var namespaceObject=global.WindowsAzure=global.WindowsAzure||{};for(var key in declarations)declarations.hasOwnProperty(key)&&(namespaceObject[key]=declarations[key])},exports.readSetting=function(name){return inMemorySettingStore[name]},exports.writeSetting=function(name,value){inMemorySettingStore[name]=value},exports.webRequest=function(request,callback){return getBestTransport().performRequest(request,callback)},exports.getUserAgent=function(){return null},exports.getOperatingSystemInfo=function(){return{name:"--",version:"--",architecture:"--"}},exports.getSdkInfo=function(){var isCordovaEnvironment=window&&window.cordova&&window.cordova.version;return{language:isCordovaEnvironment?"Cordova":"Web",fileVersion:$__fileVersion__}},exports.login=function(startUri,endUri,callback){var findProtocol=/^[a-z]+:/,requiredProtocol="https:";return startUri=startUri.replace(findProtocol,requiredProtocol),endUri=endUri.replace(findProtocol,requiredProtocol),getBestProvider(knownLoginUis).login(startUri,endUri,callback)},exports.toJson=function(value){return JSON.stringify(value,function(key,stringifiedValue){if(dateSerializerOmitsDecimals&&this&&_.isDate(this[key])){var msec=this[key].getMilliseconds(),msecString=String(msec+1e3).substring(1);return stringifiedValue.replace(isoDateRegex,function(all,datetime){return datetime+"."+msecString+"Z"})}return stringifiedValue})},exports.tryParseIsoDateString=function(text){Validate.isString(text);var matchedDate=isoDateRegex.exec(text);if(matchedDate){var dateWithoutFraction=matchedDate[1],fraction=matchedDate[2]||"0",milliseconds=Math.round(1e3*Number("0."+fraction));dateWithoutFraction=dateWithoutFraction.replace(/\-/g,"/").replace("T"," ");var ticks=Date.parse(dateWithoutFraction+" UTC");if(!isNaN(ticks))return new Date(ticks+milliseconds)}return null},exports.getResourceString=function(resourceName){return Resources["en-US"][resourceName]},exports.allowPlatformToMutateOriginal=function(original,updated){return updated}},$__modules__.DirectAjaxTransport=function(exports){exports.name="DirectAjaxTransport",exports.supportsCurrentRuntime=function(){return"undefined"!=typeof global.XMLHttpRequest&&"withCredentials"in new global.XMLHttpRequest},exports.performRequest=function(request,callback){var headers=request.headers||{},url=request.url.replace(/#.*$/,""),httpMethod=request.type?request.type.toUpperCase():"GET",xhr=new global.XMLHttpRequest;xhr.onreadystatechange=function(){4===xhr.readyState&&callback(null,xhr)},xhr.open(httpMethod,url);for(var key in headers)request.headers.hasOwnProperty(key)&&xhr.setRequestHeader(key,request.headers[key]);xhr.send(request.data)}},$__modules__.IframeTransport=function(exports){function fixupAjax(xhr){xhr&&1223===xhr.status&&(xhr.status=204)}function whenBridgeLoaded(originRoot,callback){var cacheEntry=loadBridgeFramePromises[originRoot];cacheEntry||(cacheEntry=loadBridgeFramePromises[originRoot]=new Promises.Promise(function(complete){var bridgeFrame=document.createElement("iframe"),callerOrigin=PostMessageExchange.getOriginRoot(window.location.href),handleBridgeLoaded=function(){complete(bridgeFrame)};bridgeFrame.addEventListener?bridgeFrame.addEventListener("load",handleBridgeLoaded,!1):bridgeFrame.attachEvent("onload",handleBridgeLoaded),bridgeFrame.src=originRoot+"/crossdomain/bridge?origin="+encodeURIComponent(callerOrigin),bridgeFrame.setAttribute("width",0),bridgeFrame.setAttribute("height",0),bridgeFrame.style.display="none",global.document.body.appendChild(bridgeFrame)})),cacheEntry.then(callback)}var Promises=require("Promises"),PostMessageExchange=require("PostMessageExchange"),loadBridgeFramePromises=[],messageExchange=PostMessageExchange.instance;exports.name="IframeTransport",exports.supportsCurrentRuntime=function(){return"undefined"!=typeof global.postMessage},exports.performRequest=function(request,callback){var originRoot=PostMessageExchange.getOriginRoot(request.url);whenBridgeLoaded(originRoot,function(bridgeFrame){var message={type:request.type,url:request.url,headers:request.headers,data:request.data};messageExchange.request(bridgeFrame.contentWindow,message,originRoot).then(function(reply){fixupAjax(reply),callback(null,reply)},function(error){callback(error,null)})})}},$__modules__.BrowserPopup=function(exports){function createIntermediateIframeForLogin(runtimeOrigin,completionOrigin){var frame=document.createElement("iframe");return frame.name="zumo-login-receiver",frame.src=runtimeOrigin+"/crossdomain/loginreceiver?completion_origin="+encodeURIComponent(completionOrigin),frame.setAttribute("width",0),frame.setAttribute("height",0),frame.style.display="none",document.body.appendChild(frame),frame}var PostMessageExchange=require("PostMessageExchange");exports.supportsCurrentRuntime=function(){return!0},exports.login=function(startUri,endUri,callback){var completionOrigin=PostMessageExchange.getOriginRoot(window.location.href),runtimeOrigin=PostMessageExchange.getOriginRoot(startUri),useIntermediateIframe=window.navigator.userAgent.indexOf("MSIE")>=0||window.navigator.userAgent.indexOf("Trident")>=0,intermediateIframe=useIntermediateIframe&&createIntermediateIframeForLogin(runtimeOrigin,completionOrigin),completionType=useIntermediateIframe?"iframe":"postMessage";if(startUri+=-1==startUri.indexOf("?")?"?":"&",startUri+="completion_type="+completionType+"&completion_origin="+encodeURIComponent(completionOrigin),!completionOrigin||0!==completionOrigin.indexOf("http:")&&0!==completionOrigin.indexOf("https:")){var error="Login is only supported from http:// or https:// URLs. Please host your page in a web server.";return void callback(error,null)}var loginWindow=window.open(startUri,"_blank","location=no"),complete=function(errorValue,oauthValue){window.clearInterval(checkForWindowClosedInterval),loginWindow.close(),window.removeEventListener?window.removeEventListener("message",handlePostMessage):window.detachEvent("onmessage",handlePostMessage),intermediateIframe&&intermediateIframe.parentNode.removeChild(intermediateIframe),callback(errorValue,oauthValue)},handlePostMessage=function(evt){var expectedSource=useIntermediateIframe?intermediateIframe.contentWindow:loginWindow;if(evt.source===expectedSource){var envelope;try{envelope=JSON.parse(evt.data)}catch(ex){return}envelope&&"LoginCompleted"===envelope.type&&(envelope.oauth||envelope.error)&&complete(envelope.error,envelope.oauth)}},checkForWindowClosedInterval=window.setInterval(function(){loginWindow&&loginWindow.closed===!0&&complete("canceled",null)},250);return window.addEventListener?window.addEventListener("message",handlePostMessage,!1):window.attachEvent("onmessage",handlePostMessage),{cancelCallback:function(){return complete("canceled",null),!0}}}},$__modules__.CordovaPopup=function(exports){function isRunUnderRippleEmulator(){return window.parent&&!!window.parent.ripple}function currentCordovaVersion(){return window.cordova&&window.cordova.version}function isSupportedCordovaVersion(){var versionParts=currentCordovaVersion().match(/^(\d+).(\d+)./);if(versionParts){var major=Number(versionParts[1]),minor=Number(versionParts[2]),required=requiredCordovaVersion;return major>required.major||major===required.major&&minor>=required.minor}return!1}function hasInAppBrowser(){return!window.open}function parseOAuthResultFromDoneUrl(url){var successMessage=extractMessageFromUrl(url,"#token="),errorMessage=extractMessageFromUrl(url,"#error=");return{oAuthToken:successMessage?JSON.parse(successMessage):null,error:errorMessage}}function extractMessageFromUrl(url,separator){var pos=url.indexOf(separator);return 0>pos?null:decodeURIComponent(url.substring(pos+separator.length))}function getSpinnerMarkup(){for(var vendorPrefix=("webkitTransform"in document.documentElement.style?"-webkit-":""),numSpokes=12,spokesMarkup="",i=0;numSpokes>i;i++)spokesMarkup+="<div style='-prefix-transform: rotateZ("+(180+360*i/numSpokes)+"deg);-prefix-animation-delay: "+.75*i/numSpokes+"s;'></div>";return["<!DOCTYPE html><html>","<head><meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1'></head>","<body><div id='spinner'>"+spokesMarkup+"</div>","<style type='text/css'>","    #spinner { position: absolute; top: 50%; left: 50%; -prefix-animation: spinner 10s linear infinite; }","    #spinner > div {","        background: #333; opacity: 0; position: absolute; top: 11px; left: -2px; width: 4px; height: 21px; border-radius: 2px;","        -prefix-transform-origin: 50% -11px; -prefix-animation: spinner-spoke 0.75s linear infinite;","    }","    @-prefix-keyframes spinner { 0% { -prefix-transform: rotateZ(0deg); } 100% { -prefix-transform: rotateZ(-360deg); } }","    @-prefix-keyframes spinner-spoke { 0% { opacity: 0; } 5% { opacity: 1; } 70% { opacity: 0; } 100% { opacity: 0; } }","</style>","</body></html>"].join("").replace(/-prefix-/g,vendorPrefix)}var requiredCordovaVersion={major:3,minor:0};
exports.supportsCurrentRuntime=function(){return!!currentCordovaVersion()&&!isRunUnderRippleEmulator()},exports.login=function(startUri,endUri,callback){var message,foundCordovaVersion=currentCordovaVersion();if(!isSupportedCordovaVersion(foundCordovaVersion))throw message="Not a supported version of Cordova. Detected: "+foundCordovaVersion+". Required: "+requiredCordovaVersion.major+"."+requiredCordovaVersion.minor,new Error(message);if(!hasInAppBrowser)throw message='A required plugin: "org.apache.cordova.inappbrowser" was not detected.',new Error(message);var redirectionScript="<script>location.href = unescape('"+window.escape(startUri)+"')</script>",startPage="data:text/html,"+encodeURIComponent(getSpinnerMarkup()+redirectionScript);setTimeout(function(){var loginWindow=window.open(startPage,"_blank","location=no"),flowHasFinished=!1,loadEventHandler=function(evt){if(!flowHasFinished&&0===evt.url.indexOf(endUri)){flowHasFinished=!0,setTimeout(function(){loginWindow.close()},500);var result=parseOAuthResultFromDoneUrl(evt.url);callback(result.error,result.oAuthToken)}};loginWindow.addEventListener("loadstart",loadEventHandler),loginWindow.addEventListener("loadstop",loadEventHandler),loginWindow.addEventListener("exit",function(){flowHasFinished||(flowHasFinished=!0,callback("UserCancelled",null))})},500)}},$__modules__.WebAuthBroker=function(exports){function isWebAuthBrokerAvailable(){return!!(window.Windows&&window.Windows.Security&&window.Windows.Security.Authentication&&window.Windows.Security.Authentication.Web&&window.Windows.Security.Authentication.Web.WebAuthenticationBroker)}exports.supportsCurrentRuntime=function(){return isWebAuthBrokerAvailable()},exports.login=function(startUri,endUri,callback){var windowsWebAuthBroker=Windows.Security.Authentication.Web.WebAuthenticationBroker,noneWebAuthOptions=Windows.Security.Authentication.Web.WebAuthenticationOptions.none,successWebAuthStatus=Windows.Security.Authentication.Web.WebAuthenticationStatus.success,activationKindWebAuthContinuation=Windows.ApplicationModel.Activation.ActivationKind.webAuthenticationBrokerContinuation,webAuthBrokerSuccessCallback=null,webAuthBrokerErrorCallback=null,webAuthBrokerContinuationCallback=null;if(webAuthBrokerSuccessCallback=function(result){var error=null,token=null;if(result.responseStatus!==successWebAuthStatus)error=result;else{var callbackEndUri=result.responseData,tokenAsJson=null,i=callbackEndUri.indexOf("#token=");if(i>0?tokenAsJson=decodeURIComponent(callbackEndUri.substring(i+7)):(i=callbackEndUri.indexOf("#error="),i>0&&(error=decodeURIComponent(callbackEndUri.substring(i+7)))),null!==tokenAsJson)try{token=JSON.parse(tokenAsJson)}catch(e){error=e}}callback(error,token)},webAuthBrokerErrorCallback=function(error){callback(error,null)},webAuthBrokerContinuationCallback=function(activationArgs){if(activationArgs.detail.kind===activationKindWebAuthContinuation){var result=activationArgs.detail.webAuthenticationResult;result.responseStatus==successWebAuthStatus?webAuthBrokerSuccessCallback(result):webAuthBrokerErrorCallback(result),WinJS.Application.removeEventListener("activated",webAuthBrokerContinuationCallback)}},endUri){var windowsStartUri=new Windows.Foundation.Uri(startUri),windowsEndUri=new Windows.Foundation.Uri(endUri);windowsWebAuthBroker.authenticateAndContinue?(WinJS.Application.addEventListener("activated",webAuthBrokerContinuationCallback,!0),windowsWebAuthBroker.authenticateAndContinue(windowsStartUri,windowsEndUri)):windowsWebAuthBroker.authenticateAsync(noneWebAuthOptions,windowsStartUri,windowsEndUri).done(webAuthBrokerSuccessCallback,webAuthBrokerErrorCallback)}else{var redirectUri=windowsWebAuthBroker.getCurrentApplicationCallbackUri().absoluteUri,startUriWithRedirect=startUri+"?sso_end_uri="+encodeURIComponent(redirectUri),windowsStartUriWithRedirect=new Windows.Foundation.Uri(startUriWithRedirect);windowsWebAuthBroker.authenticateAndContinue?(WinJS.Application.addEventListener("activated",webAuthBrokerContinuationCallback,!0),windowsWebAuthBroker.authenticateAndContinue(windowsStartUriWithRedirect)):windowsWebAuthBroker.authenticateAsync(noneWebAuthOptions,windowsStartUriWithRedirect).done(webAuthBrokerSuccessCallback,webAuthBrokerErrorCallback)}}},$__modules__.PostMessageExchange=function(exports){function PostMessageExchange(){var self=this;self._lastMessageId=0,self._hasListener=!1,self._pendingMessages={}}function getOriginRoot(url){var parsedUrl=parseUrl(url),portString=parsedUrl.port?parsedUrl.port.toString():null,isDefaultPort="http:"===parsedUrl.protocol&&"80"===portString||"https:"===parsedUrl.protocol&&"443"===portString,portSuffix=portString&&!isDefaultPort?":"+portString:"";return parsedUrl.protocol+"//"+parsedUrl.hostname+portSuffix}function parseUrl(url){var elem=global.document.createElement("a");return elem.href=url,elem}var Promises=require("Promises"),messageTimeoutDuration=3e5;PostMessageExchange.prototype.request=function(targetWindow,messageData,origin){var self=this,messageId=++self._lastMessageId,envelope={messageId:messageId,contents:messageData};return self._ensureHasListener(),new Promises.Promise(function(complete,error){self._pendingMessages[messageId]={messageId:messageId,complete:complete,error:error,targetWindow:targetWindow,origin:origin},self._pendingMessages[messageId].timeoutId=global.setTimeout(function(){var pendingMessage=self._pendingMessages[messageId];pendingMessage&&(delete self._pendingMessages[messageId],pendingMessage.error({status:0,statusText:"Timeout",responseText:null}))},messageTimeoutDuration),targetWindow.postMessage(JSON.stringify(envelope),origin)})},PostMessageExchange.prototype._ensureHasListener=function(){if(!this._hasListener){this._hasListener=!0;var self=this,boundHandleMessage=function(){self._handleMessage.apply(self,arguments)};window.addEventListener?window.addEventListener("message",boundHandleMessage,!1):window.attachEvent("onmessage",boundHandleMessage)}},PostMessageExchange.prototype._handleMessage=function(evt){var envelope=this._tryDeserializeMessage(evt.data),messageId=envelope&&envelope.messageId,pendingMessage=messageId&&this._pendingMessages[messageId],isValidReply=pendingMessage&&pendingMessage.targetWindow===evt.source&&pendingMessage.origin===getOriginRoot(evt.origin);isValidReply&&(global.clearTimeout(pendingMessage.timeoutId),delete this._pendingMessages[messageId],pendingMessage.complete(envelope.contents))},PostMessageExchange.prototype._tryDeserializeMessage=function(messageString){if(!messageString||"string"!=typeof messageString)return null;try{return JSON.parse(messageString)}catch(ex){return null}},exports.instance=new PostMessageExchange,exports.getOriginRoot=getOriginRoot},$__modules__.Promises=function(exports){!function(exports){"use strict";function Promise(init){this._callbackFrames=[],this._resolutionState=null,this._resolutionValueOrError=null,this._resolveSuccess=bind(this._resolveSuccess,this),this._resolveError=bind(this._resolveError,this),init&&init(this._resolveSuccess,this._resolveError)}var resolutionState={success:{},error:{}},bind=function(func,target){return function(){func.apply(target,arguments)}},isGenericPromise=function(obj){return obj&&"function"==typeof obj.then};Promise.prototype.then=function(success,error){var callbackFrame={success:success,error:error,chainedPromise:new Promise};return this._resolutionState?this._invokeCallback(callbackFrame):this._callbackFrames.push(callbackFrame),callbackFrame.chainedPromise},Promise.prototype._resolveSuccess=function(val){this._resolve(resolutionState.success,val)},Promise.prototype._resolveError=function(err){this._resolve(resolutionState.error,err)},Promise.prototype._resolve=function(state,valueOrError){if(!this._resolutionState){this._resolutionState=state,this._resolutionValueOrError=valueOrError;for(var i=0,j=this._callbackFrames.length;j>i;i++)this._invokeCallback(this._callbackFrames[i])}},Promise.prototype._invokeCallback=function(frame){var callbackToInvoke=this._resolutionState===resolutionState.success?frame.success:frame.error;"function"==typeof callbackToInvoke?setTimeout(bind(function(){var passthroughValue,passthroughState,callbackDidNotThrow=!0;try{passthroughValue=callbackToInvoke(this._resolutionValueOrError),passthroughState=resolutionState.success}catch(ex){callbackDidNotThrow=!1,passthroughValue=ex,passthroughState=resolutionState.error}callbackDidNotThrow&&isGenericPromise(passthroughValue)?passthroughValue.then(frame.chainedPromise._resolveSuccess,frame.chainedPromise._resolveError):frame.chainedPromise._resolve(passthroughState,passthroughValue)},this),1):frame.chainedPromise._resolve(this._resolutionState,this._resolutionValueOrError)},Promise.prototype.done=function(success,error){return void this.then(success,error).then(null,function(err){setTimeout(function(){throw new Error(err)},1)})},exports.Promise=Promise}(exports)},require("MobileServiceClient")}(this||exports);